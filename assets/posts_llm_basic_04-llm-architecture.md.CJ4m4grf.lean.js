import{_ as s,c as a,o as e,ah as l,j as Q,a as t}from"./chunks/framework.CvbyeFFO.js";const X1=JSON.parse('{"title":"大语言模型架构","description":"","frontmatter":{"title":"大语言模型架构","date":"2025-07-09T11:42:18.000Z","create":"2025-07-09T11:42:18.000Z","categories":["llm"],"tags":["decoder-only","Casual-LM"]},"headers":[],"relativePath":"posts/llm/basic/04-llm-architecture.md","filePath":"posts/llm/basic/04-llm-architecture.md","lastUpdated":1753200077000}'),o={name:"posts/llm/basic/04-llm-architecture.md"},r={class:"custom-block tip"},d={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},n={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.294ex",height:"1.025ex",role:"img",focusable:"false",viewBox:"0 -442 572 453","aria-hidden":"true"},m={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},i={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"0"},xmlns:"http://www.w3.org/2000/svg",width:"1.195ex",height:"1.833ex",role:"img",focusable:"false",viewBox:"0 -810 528 810","aria-hidden":"true"},H={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},h={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"0"},xmlns:"http://www.w3.org/2000/svg",width:"1.195ex",height:"1.568ex",role:"img",focusable:"false",viewBox:"0 -693 528 693","aria-hidden":"true"},p={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},g={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-2.819ex"},xmlns:"http://www.w3.org/2000/svg",width:"35.488ex",height:"6.73ex",role:"img",focusable:"false",viewBox:"0 -1728.7 15685.7 2974.6","aria-hidden":"true"},V={class:"custom-block note"},L={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},u={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"15.5ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 6850.9 1000","aria-hidden":"true"},w={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},c={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"9.25ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 4088.7 1000","aria-hidden":"true"},x={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},f={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-3.93ex"},xmlns:"http://www.w3.org/2000/svg",width:"70.635ex",height:"7.841ex",role:"img",focusable:"false",viewBox:"0 -1728.7 31220.8 3465.6","aria-hidden":"true"},M={class:"custom-block info"},y={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},k={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.439ex"},xmlns:"http://www.w3.org/2000/svg",width:"10.515ex",height:"1.977ex",role:"img",focusable:"false",viewBox:"0 -680 4647.8 874","aria-hidden":"true"},Z={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},b={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"5.464ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 2415 1000","aria-hidden":"true"},v={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},D={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.05ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.778ex",height:"1.645ex",role:"img",focusable:"false",viewBox:"0 -705 786 727","aria-hidden":"true"},_={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},A={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"4.833ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 2136 1000","aria-hidden":"true"},j={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},C={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-3.728ex"},xmlns:"http://www.w3.org/2000/svg",width:"34.658ex",height:"8.587ex",role:"img",focusable:"false",viewBox:"0 -2147.7 15318.7 3795.4","aria-hidden":"true"},E={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},S={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"4.833ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 2136 1000","aria-hidden":"true"},R={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},O={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"9.721ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 4296.5 1000","aria-hidden":"true"},P={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},B={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"5.464ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 2415 1000","aria-hidden":"true"},I={class:"custom-block info"},N={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},F={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.666ex"},xmlns:"http://www.w3.org/2000/svg",width:"7.532ex",height:"2.261ex",role:"img",focusable:"false",viewBox:"0 -705 3329 999.2","aria-hidden":"true"},G={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},X={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.05ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.778ex",height:"1.645ex",role:"img",focusable:"false",viewBox:"0 -705 786 727","aria-hidden":"true"},z={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},J={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-3.014ex"},xmlns:"http://www.w3.org/2000/svg",width:"34.234ex",height:"6.952ex",role:"img",focusable:"false",viewBox:"0 -1740.7 15131.5 3072.9","aria-hidden":"true"},q={class:"custom-block tip"},K={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},W={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.667ex"},xmlns:"http://www.w3.org/2000/svg",width:"23.431ex",height:"2.364ex",role:"img",focusable:"false",viewBox:"0 -750 10356.3 1045","aria-hidden":"true"},U={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},$={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.186ex"},xmlns:"http://www.w3.org/2000/svg",width:"4.023ex",height:"1.505ex",role:"img",focusable:"false",viewBox:"0 -583 1778 665","aria-hidden":"true"},Y={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},Q1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.357ex"},xmlns:"http://www.w3.org/2000/svg",width:"5.798ex",height:"1.902ex",role:"img",focusable:"false",viewBox:"0 -683 2562.8 840.8","aria-hidden":"true"},T1={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},t1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-5.368ex"},xmlns:"http://www.w3.org/2000/svg",width:"59.141ex",height:"11.866ex",role:"img",focusable:"false",viewBox:"0 -2872.5 26140.3 5245","aria-hidden":"true"},a1={class:"custom-block danger"},e1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},l1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.357ex",height:"1.025ex",role:"img",focusable:"false",viewBox:"0 -442 600 453","aria-hidden":"true"},s1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},o1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.179ex",height:"1.595ex",role:"img",focusable:"false",viewBox:"0 -694 521 705","aria-hidden":"true"},r1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},d1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"0.971ex",height:"1.595ex",role:"img",focusable:"false",viewBox:"0 -694 429 705","aria-hidden":"true"},n1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},m1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.798ex"},xmlns:"http://www.w3.org/2000/svg",width:"8.708ex",height:"2.8ex",role:"img",focusable:"false",viewBox:"0 -884.7 3848.9 1237.5","aria-hidden":"true"},i1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},H1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.023ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.176ex",height:"1.593ex",role:"img",focusable:"false",viewBox:"0 -694 520 704","aria-hidden":"true"},h1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},p1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"3.782ex",height:"1.595ex",role:"img",focusable:"false",viewBox:"0 -694 1671.4 705","aria-hidden":"true"},g1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},V1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.798ex"},xmlns:"http://www.w3.org/2000/svg",width:"4.237ex",height:"2.8ex",role:"img",focusable:"false",viewBox:"0 -884.7 1872.6 1237.5","aria-hidden":"true"},L1={class:"custom-block danger"},u1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},w1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.65ex"},xmlns:"http://www.w3.org/2000/svg",width:"9.555ex",height:"2.195ex",role:"img",focusable:"false",viewBox:"0 -683 4223.2 970.2","aria-hidden":"true"},c1={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},x1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-3.125ex"},xmlns:"http://www.w3.org/2000/svg",width:"32.35ex",height:"7.38ex",role:"img",focusable:"false",viewBox:"0 -1881.1 14298.6 3262.2","aria-hidden":"true"},f1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},M1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.357ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.192ex",height:"1.902ex",role:"img",focusable:"false",viewBox:"0 -683 969 840.8","aria-hidden":"true"},y1={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},k1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-2.779ex"},xmlns:"http://www.w3.org/2000/svg",width:"19.805ex",height:"5.815ex",role:"img",focusable:"false",viewBox:"0 -1342 8753.8 2570.2","aria-hidden":"true"},Z1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},b1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.464ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.848ex",height:"2.059ex",role:"img",focusable:"false",viewBox:"0 -705 817 910","aria-hidden":"true"},v1={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},D1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-2.779ex"},xmlns:"http://www.w3.org/2000/svg",width:"29.339ex",height:"5.815ex",role:"img",focusable:"false",viewBox:"0 -1342 12967.7 2570.2","aria-hidden":"true"},_1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},A1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.186ex"},xmlns:"http://www.w3.org/2000/svg",width:"8.96ex",height:"2.14ex",role:"img",focusable:"false",viewBox:"0 -864 3960.2 946","aria-hidden":"true"},j1={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},C1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-2.819ex"},xmlns:"http://www.w3.org/2000/svg",width:"24.675ex",height:"6.354ex",role:"img",focusable:"false",viewBox:"0 -1562.5 10906.5 2808.5","aria-hidden":"true"},E1={class:"custom-block note"},S1={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},R1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-1.577ex"},xmlns:"http://www.w3.org/2000/svg",width:"52.536ex",height:"4.676ex",role:"img",focusable:"false",viewBox:"0 -1370 23221 2067","aria-hidden":"true"};function O1(P1,T,B1,I1,N1,F1){return e(),a("div",null,[T[185]||(T[185]=l("",7)),Q("div",r,[T[15]||(T[15]=Q("div",{class:"custom-block-title"},"Encoder-Only / AutoEncoder LM",-1)),T[16]||(T[16]=Q("p",null,[t("🥅"),Q("strong",null,"建模目标")],-1)),Q("ul",null,[Q("li",null,[T[4]||(T[4]=t("BERT将序列")),Q("mjx-container",d,[(e(),a("svg",n,T[0]||(T[0]=[Q("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[Q("g",{"data-mml-node":"math"},[Q("g",{"data-mml-node":"mi"},[Q("path",{"data-c":"1D465",d:"M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z",style:{"stroke-width":"3"}})])])],-1)]))),T[1]||(T[1]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mi",null,"x")])],-1))]),T[5]||(T[5]=t("随机挑选15%Token变成")),T[6]||(T[6]=Q("code",null,"[MASK]",-1)),T[7]||(T[7]=t("得到噪声")),Q("mjx-container",m,[(e(),a("svg",i,T[2]||(T[2]=[l("",1)]))),T[3]||(T[3]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mover",null,[Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",{mathvariant:"normal"},"x")]),Q("mo",{stretchy:"false"},"^")])])])],-1))])]),Q("li",null,[T[10]||(T[10]=Q("strong",null,"期望根据上下文恢复/猜测出原始值",-1)),T[11]||(T[11]=t()),Q("mjx-container",H,[(e(),a("svg",h,T[8]||(T[8]=[l("",1)]))),T[9]||(T[9]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mover",null,[Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",{mathvariant:"normal"},"x")]),Q("mo",{stretchy:"false"},"¯")])])])],-1))]),T[12]||(T[12]=t("。"))])]),Q("mjx-container",p,[(e(),a("svg",g,T[13]||(T[13]=[l("",1)]))),T[14]||(T[14]=Q("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[Q("munder",null,[Q("mo",{"data-mjx-texclass":"OP"},"max"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"θ")])]),Q("mi",null,"log"),Q("mo",{"data-mjx-texclass":"NONE"},"⁡"),Q("msub",null,[Q("mi",null,"p"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"θ")])]),Q("mo",{stretchy:"false"},"("),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mover",null,[Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",{mathvariant:"normal"},"x")]),Q("mo",{stretchy:"false"},"¯")])]),Q("mo",{"data-mjx-texclass":"ORD",stretchy:"false"},"|"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mover",null,[Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",{mathvariant:"normal"},"x")]),Q("mo",{stretchy:"false"},"^")])]),Q("mo",{stretchy:"false"},")"),Q("mo",null,"≈"),Q("mstyle",{mathcolor:"red"},[Q("munderover",null,[Q("mo",{"data-mjx-texclass":"OP",movablelimits:"false"},"∑"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"t"),Q("mo",null,"="),Q("mn",null,"1")]),Q("mi",null,"T")]),Q("msub",null,[Q("mi",null,"m"),Q("mi",null,"t")]),Q("mi",null,"log"),Q("mo",{"data-mjx-texclass":"NONE"},"⁡"),Q("msub",null,[Q("mi",null,"p"),Q("mi",null,"θ")]),Q("mo",{stretchy:"false"},"("),Q("msub",null,[Q("mi",null,"x"),Q("mi",null,"t")]),Q("mo",{"data-mjx-texclass":"ORD",stretchy:"false"},"|"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mover",null,[Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",{mathvariant:"normal"},"x")]),Q("mo",{stretchy:"false"},"^")])]),Q("mo",{stretchy:"false"},")")])])],-1))]),T[17]||(T[17]=l("",2))]),T[186]||(T[186]=l("",6)),Q("div",V,[T[29]||(T[29]=l("",4)),Q("ul",null,[Q("li",null,[T[20]||(T[20]=t("给定文本序列")),Q("mjx-container",L,[(e(),a("svg",u,T[18]||(T[18]=[l("",1)]))),T[19]||(T[19]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mi",null,"x"),Q("mo",null,"="),Q("mo",{stretchy:"false"},"["),Q("msub",null,[Q("mi",null,"x"),Q("mn",null,"1")]),Q("mo",null,","),Q("mo",null,"⋯"),Q("mo",null,","),Q("msub",null,[Q("mi",null,"x"),Q("mi",null,"T")]),Q("mo",{stretchy:"false"},"]")])],-1))]),T[21]||(T[21]=t("，调整参数使得训练数据上的似然函数最大。"))]),Q("li",null,[Q("mjx-container",w,[(e(),a("svg",c,T[22]||(T[22]=[l("",1)]))),T[23]||(T[23]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("msub",null,[Q("mi",null,"h"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"θ")])]),Q("mo",{stretchy:"false"},"("),Q("msub",null,[Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",{mathvariant:"normal"},"x")]),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mn",null,"1"),Q("mo",null,":"),Q("mi",null,"t"),Q("mo",null,"−"),Q("mn",null,"1")])]),Q("mo",{stretchy:"false"},")")])],-1))]),T[24]||(T[24]=t(": Transformer(或RNN)")),T[25]||(T[25]=Q("strong",null,"在t时刻之前编码的隐状态",-1)),T[26]||(T[26]=t("，emb为词向量。"))])]),Q("mjx-container",x,[(e(),a("svg",f,T[27]||(T[27]=[l("",1)]))),T[28]||(T[28]=Q("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[Q("mstyle",{mathcolor:"blue"},[Q("munder",null,[Q("mo",{"data-mjx-texclass":"OP"},"max"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"θ")])]),Q("msub",null,[Q("mi",null,"p"),Q("mi",null,"θ")]),Q("mo",{stretchy:"false"},"("),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",{mathvariant:"normal"},"x")]),Q("mo",{stretchy:"false"},")"),Q("mo",null,"="),Q("mstyle",{mathcolor:"red"},[Q("munderover",null,[Q("mo",{"data-mjx-texclass":"OP",movablelimits:"false"},"∑"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"t"),Q("mo",null,"="),Q("mn",null,"1")]),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"T")])]),Q("mi",null,"log"),Q("mo",{"data-mjx-texclass":"NONE"},"⁡"),Q("msub",null,[Q("mi",null,"p"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"θ")])]),Q("mo",{stretchy:"false"},"("),Q("msub",null,[Q("mi",null,"x"),Q("mi",null,"t")]),Q("mo",{"data-mjx-texclass":"ORD",stretchy:"false"},"|"),Q("msub",null,[Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",{mathvariant:"normal"},"x")]),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mn",null,"1"),Q("mo",null,":"),Q("mi",null,"t"),Q("mo",null,"−"),Q("mn",null,"1")])]),Q("mo",{stretchy:"false"},")")]),Q("mo",null,"="),Q("munderover",null,[Q("mo",{"data-mjx-texclass":"OP",movablelimits:"false"},"∑"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"t"),Q("mo",null,"="),Q("mn",null,"1")]),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"T")])]),Q("mi",null,"log"),Q("mo",{"data-mjx-texclass":"NONE"},"⁡"),Q("mfrac",null,[Q("mrow",null,[Q("mi",null,"exp"),Q("mo",{"data-mjx-texclass":"NONE"},"⁡"),Q("mrow",{"data-mjx-texclass":"INNER"},[Q("mo",{"data-mjx-texclass":"OPEN"},"("),Q("msub",null,[Q("mi",null,"h"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"θ")])]),Q("mo",{stretchy:"false"},"("),Q("msub",null,[Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",{mathvariant:"normal"},"x")]),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mn",null,"1"),Q("mo",null,":"),Q("mi",null,"t"),Q("mo",null,"−"),Q("mn",null,"1")])]),Q("msup",null,[Q("mo",{stretchy:"false"},")"),Q("mi",null,"T")]),Q("mo",null,"⋅"),Q("mtext",null,"emb"),Q("mo",{stretchy:"false"},"("),Q("msub",null,[Q("mi",null,"x"),Q("mi",null,"t")]),Q("mo",{stretchy:"false"},")"),Q("mo",{"data-mjx-texclass":"CLOSE"},")")])]),Q("mrow",null,[Q("munder",null,[Q("mo",{"data-mjx-texclass":"OP",movablelimits:"false"},"∑"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("msup",null,[Q("mi",null,"x"),Q("mi",{"data-mjx-alternate":"1"},"′")])])]),Q("mi",null,"exp"),Q("mo",{"data-mjx-texclass":"NONE"},"⁡"),Q("mrow",{"data-mjx-texclass":"INNER"},[Q("mo",{"data-mjx-texclass":"OPEN"},"("),Q("msub",null,[Q("mi",null,"h"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"θ")])]),Q("mo",{stretchy:"false"},"("),Q("msub",null,[Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",{mathvariant:"normal"},"x")]),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mn",null,"1"),Q("mo",null,":"),Q("mi",null,"t"),Q("mo",null,"−"),Q("mn",null,"1")])]),Q("msup",null,[Q("mo",{stretchy:"false"},")"),Q("mi",null,"T")]),Q("mo",null,"⋅"),Q("mtext",null,"emb"),Q("mo",{stretchy:"false"},"("),Q("msup",null,[Q("mi",null,"x"),Q("mi",{"data-mjx-alternate":"1"},"′")]),Q("mo",{stretchy:"false"},")"),Q("mo",{"data-mjx-texclass":"CLOSE"},")")])])])])])],-1))]),T[30]||(T[30]=Q("p",null,[Q("strong",null,"优缺点")],-1)),T[31]||(T[31]=Q("ul",null,[Q("li",null,"优点：天然符合下游任务。见下文吧。")],-1))]),T[187]||(T[187]=l("",18)),Q("div",M,[T[75]||(T[75]=Q("div",{class:"custom-block-title"},"MoE 层",-1)),T[76]||(T[76]=Q("p",null,[Q("strong",null,"1. 专家+门控网络")],-1)),Q("ul",null,[Q("li",null,[T[39]||(T[39]=t("💥 ")),T[40]||(T[40]=Q("strong",null,"n个专家网络",-1)),T[41]||(T[41]=t("(")),T[42]||(T[42]=Q("code",null,"稀疏MoE层",-1)),T[43]||(T[43]=t(")：")),Q("mjx-container",y,[(e(),a("svg",k,T[32]||(T[32]=[l("",1)]))),T[33]||(T[33]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("msub",null,[Q("mi",null,"E"),Q("mn",null,"1")]),Q("mo",null,","),Q("mo",null,"⋯"),Q("mo",null,","),Q("msub",null,[Q("mi",null,"E"),Q("mi",null,"n")])])],-1))]),T[44]||(T[44]=t("。 ")),Q("ul",null,[T[37]||(T[37]=Q("li",null,"每个专家是一个独立的子网络模块，可以是FFN、Transformer等等。",-1)),Q("li",null,[T[36]||(T[36]=t("保持输入输出大小、结构一致。输出")),Q("mjx-container",Z,[(e(),a("svg",b,T[34]||(T[34]=[l("",1)]))),T[35]||(T[35]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("msub",null,[Q("mi",null,"E"),Q("mi",null,"i")]),Q("mo",{stretchy:"false"},"("),Q("mi",null,"x"),Q("mo",{stretchy:"false"},")")])],-1))])]),T[38]||(T[38]=Q("li",null,[t("⭐"),Q("mark",null,"代替了Transformer中的FFN层"),t("。")],-1))])]),Q("li",null,[T[55]||(T[55]=t("💥")),T[56]||(T[56]=Q("strong",null,"1个门控网络",-1)),Q("mjx-container",v,[(e(),a("svg",D,T[45]||(T[45]=[Q("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[Q("g",{"data-mml-node":"math"},[Q("g",{"data-mml-node":"mi"},[Q("path",{"data-c":"1D43A",d:"M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z",style:{"stroke-width":"3"}})])])],-1)]))),T[46]||(T[46]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mi",null,"G")])],-1))]),T[57]||(T[57]=t(" (")),T[58]||(T[58]=Q("code",null,"路由网络",-1)),T[59]||(T[59]=t(") ")),Q("ul",null,[Q("li",null,[T[49]||(T[49]=Q("strong",null,"输出各专家权重",-1)),T[50]||(T[50]=t("，是一个稀疏n维向量")),Q("mjx-container",_,[(e(),a("svg",A,T[47]||(T[47]=[l("",1)]))),T[48]||(T[48]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mi",null,"G"),Q("mo",{stretchy:"false"},"("),Q("mi",null,"x"),Q("mo",{stretchy:"false"},")")])],-1))]),T[51]||(T[51]=t("。如")),T[52]||(T[52]=Q("code",null,"[0.0,0.8,0.0,0.2,0.0]",-1)),T[53]||(T[53]=t(" , n=5个专家"))]),T[54]||(T[54]=Q("li",null,[Q("mark",null,"决定哪些token倍发送到哪个专家"),t("。")],-1))])]),T[60]||(T[60]=Q("li",null,[Q("strong",null,"MoE层输出"),t("：为所有专家加权的和。 "),Q("ul",null,[Q("li",null,[t("⚠️"),Q("mark",null,"后续主流是topk个专家加权求和"),t("，并非所有专家。")])])],-1))]),Q("mjx-container",j,[(e(),a("svg",C,T[61]||(T[61]=[l("",1)]))),T[62]||(T[62]=Q("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[Q("mstyle",{mathcolor:"blue"},[Q("mtable",{columnalign:"left",columnspacing:"1em",rowspacing:"4pt"},[Q("mtr",null,[Q("mtd",null,[Q("mi",null,"y"),Q("mo",null,"="),Q("mi",null,"M"),Q("mi",null,"o"),Q("mi",null,"e"),Q("mo",{stretchy:"false"},"("),Q("mi",null,"x"),Q("mo",{stretchy:"false"},")"),Q("mo",null,"="),Q("munderover",null,[Q("mo",{"data-mjx-texclass":"OP",movablelimits:"false"},"∑"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mn",null,"1")]),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"n")])]),Q("mstyle",{mathcolor:"red"},[Q("mi",null,"G"),Q("mo",{stretchy:"false"},"("),Q("mi",null,"x"),Q("msub",null,[Q("mo",{stretchy:"false"},")"),Q("mi",null,"i")]),Q("mo",null,"⋅"),Q("msub",null,[Q("mi",null,"E"),Q("mi",null,"i")]),Q("mo",{stretchy:"false"},"("),Q("mi",null,"x"),Q("mo",{stretchy:"false"},")")])])]),Q("mtr",null,[Q("mtd",null,[Q("mi",null,"G"),Q("mo",{stretchy:"false"},"("),Q("mi",null,"x"),Q("mo",{stretchy:"false"},")"),Q("mo",null,"="),Q("mtext",null,"TopK"),Q("mo",{stretchy:"false"},"("),Q("mtext",null,"softmax"),Q("mo",{stretchy:"false"},"("),Q("mi",null,"x"),Q("mo",null,"⋅"),Q("msub",null,[Q("mi",null,"W"),Q("mi",null,"g")]),Q("mo",null,"+"),Q("mi",null,"ϵ"),Q("mo",{stretchy:"false"},")"),Q("mo",{stretchy:"false"},")")])])])])])],-1))]),T[77]||(T[77]=Q("p",null,[Q("strong",null,"2. 稀疏性优点")],-1)),Q("ul",null,[Q("li",null,[Q("mjx-container",E,[(e(),a("svg",S,T[63]||(T[63]=[l("",1)]))),T[64]||(T[64]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mi",null,"G"),Q("mo",{stretchy:"false"},"("),Q("mi",null,"x"),Q("mo",{stretchy:"false"},")")])],-1))]),T[73]||(T[73]=Q("strong",null,"输出的稀疏性可以节省计算量",-1)),T[74]||(T[74]=t("🔋 ")),Q("ul",null,[Q("li",null,[Q("mark",null,[T[69]||(T[69]=t("当")),Q("mjx-container",R,[(e(),a("svg",O,T[65]||(T[65]=[l("",1)]))),T[66]||(T[66]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mi",null,"G"),Q("mo",{stretchy:"false"},"("),Q("mi",null,"x"),Q("msub",null,[Q("mo",{stretchy:"false"},")"),Q("mi",null,"i")]),Q("mo",null,"="),Q("mn",null,"0")])],-1))]),T[70]||(T[70]=t("时，则无需计算")),Q("mjx-container",P,[(e(),a("svg",B,T[67]||(T[67]=[l("",1)]))),T[68]||(T[68]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("msub",null,[Q("mi",null,"E"),Q("mi",null,"i")]),Q("mo",{stretchy:"false"},"("),Q("mi",null,"x"),Q("mo",{stretchy:"false"},")")])],-1))])])]),T[71]||(T[71]=Q("li",null,[t("实验中有数以千计的MoE，"),Q("strong",null,"但每个样本只会用到少量专家"),t(" 👍")],-1)),T[72]||(T[72]=Q("li",null,[t("专家数量特别大，可能需要"),Q("code",null,"层次化MoE")],-1))])])])]),T[188]||(T[188]=Q("img",{src:"https://wdndev.github.io/llm_interview_note/02.%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E6%9E%B6%E6%9E%84/1.MoE%E8%AE%BA%E6%96%87/image/image_udZNHrE3rb.png",style:{display:"block",margin:"auto"},width:"80%"},null,-1)),T[189]||(T[189]=Q("p",null,[Q("strong",null,"Switch Transformer"),t("：使用稀疏的"),Q("code",null,"Switch FFN"),t("替换原来"),Q("code",null,"Dense FFN"),t("。")],-1)),T[190]||(T[190]=Q("img",{src:"https://wdndev.github.io/llm_interview_note/02.%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E6%9E%B6%E6%9E%84/3.LLM%20MoE%20%EF%BC%9ASwitch%20Transformers/image/image_tuuC2Qgzr-.png",style:{display:"block",margin:"auto"},width:"80%"},null,-1)),T[191]||(T[191]=Q("p",null,[Q("strong",null,"2、层次化MoE")],-1)),Q("div",I,[T[89]||(T[89]=Q("div",{class:"custom-block-title"},"层次化MoE",-1)),T[90]||(T[90]=Q("p",null,[t("专家数量很多时，使用"),Q("strong",null,"2级层次MoE来降低分支因子"),t("。")],-1)),Q("ul",null,[Q("li",null,[T[80]||(T[80]=Q("strong",null,"1个主选通网络",-1)),Q("mjx-container",N,[(e(),a("svg",F,T[78]||(T[78]=[l("",1)]))),T[79]||(T[79]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("msub",null,[Q("mi",null,"G"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mtext",null,"primary")])])])],-1))]),T[81]||(T[81]=t("：先选择一组专家组，共有a组"))]),Q("li",null,[T[84]||(T[84]=Q("strong",null,"a个次选通网络",-1)),Q("mjx-container",G,[(e(),a("svg",X,T[82]||(T[82]=[Q("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[Q("g",{"data-mml-node":"math"},[Q("g",{"data-mml-node":"mi"},[Q("path",{"data-c":"1D43A",d:"M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z",style:{"stroke-width":"3"}})])])],-1)]))),T[83]||(T[83]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mi",null,"G")])],-1))]),T[85]||(T[85]=t("：在某组内从b个中选一个专家"))]),T[86]||(T[86]=Q("li",null,[Q("strong",null,"a*b个专家")],-1))]),Q("mjx-container",z,[(e(),a("svg",J,T[87]||(T[87]=[l("",1)]))),T[88]||(T[88]=Q("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[Q("mstyle",{mathcolor:"blue"},[Q("mi",null,"y"),Q("mo",null,"="),Q("munderover",null,[Q("mo",{"data-mjx-texclass":"OP",movablelimits:"false"},"∑"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"i"),Q("mo",null,"="),Q("mn",null,"1")]),Q("mi",null,"a")]),Q("munderover",null,[Q("mo",{"data-mjx-texclass":"OP",movablelimits:"false"},"∑"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"j"),Q("mo",null,"="),Q("mn",null,"1")]),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"b")])]),Q("msub",null,[Q("mi",null,"G"),Q("mi",null,"p")]),Q("mo",{stretchy:"false"},"("),Q("mi",null,"x"),Q("msub",null,[Q("mo",{stretchy:"false"},")"),Q("mi",null,"i")]),Q("mo",null,"⋅"),Q("msub",null,[Q("mi",null,"G"),Q("mi",null,"i")]),Q("mo",{stretchy:"false"},"("),Q("mi",null,"x"),Q("msub",null,[Q("mo",{stretchy:"false"},")"),Q("mi",null,"j")]),Q("mo",null,"⋅"),Q("msub",null,[Q("mi",null,"E"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"i"),Q("mo",null,","),Q("mi",null,"j")])]),Q("mo",{stretchy:"false"},"("),Q("mi",null,"x"),Q("mo",{stretchy:"false"},")")])])],-1))])]),T[192]||(T[192]=Q("p",null,[Q("strong",null,"3、门控网络G")],-1)),Q("div",q,[T[112]||(T[112]=Q("div",{class:"custom-block-title"},"TopK策略",-1)),T[113]||(T[113]=Q("p",null,[Q("strong",null,"1、Softmax Gating (朴素想法)")],-1)),T[114]||(T[114]=Q("ul",null,[Q("li",null,"矩阵乘以输入，再过Softmax。是非稀疏的门控网络。")],-1)),Q("mjx-container",K,[(e(),a("svg",W,T[91]||(T[91]=[l("",1)]))),T[92]||(T[92]=Q("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[Q("mi",null,"G"),Q("mo",{stretchy:"false"},"("),Q("mi",null,"x"),Q("mo",{stretchy:"false"},")"),Q("mo",null,"="),Q("mtext",null,"softmax"),Q("mo",{stretchy:"false"},"("),Q("mi",null,"x"),Q("mo",null,"⋅"),Q("msub",null,[Q("mi",null,"W"),Q("mi",null,"g")]),Q("mo",{stretchy:"false"},")")])],-1))]),T[115]||(T[115]=Q("p",null,[Q("strong",null,"2、Noise Top-k Gating")],-1)),Q("ul",null,[Q("li",null,[T[107]||(T[107]=t("在softmax基础上增加稀疏性和噪声，")),T[108]||(T[108]=Q("mark",null,"仅选择topk个专家",-1)),T[109]||(T[109]=t("。 ")),Q("ul",null,[Q("li",null,[T[95]||(T[95]=t("⭐")),T[96]||(T[96]=Q("strong",null,"保留前k个值",-1)),T[97]||(T[97]=t("，其余设置为")),Q("mjx-container",U,[(e(),a("svg",$,T[93]||(T[93]=[l("",1)]))),T[94]||(T[94]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mo",null,"−"),Q("mi",{mathvariant:"normal"},"∞")])],-1))]),T[98]||(T[98]=t("：")),T[99]||(T[99]=Q("strong",null,"稀疏性为了节省资源",-1)),T[100]||(T[100]=t("。"))]),T[106]||(T[106]=Q("li",null,[Q("strong",null,"可调高斯噪声"),t("："),Q("strong",null,"帮助负载均衡"),t("。")],-1)),Q("li",null,[Q("strong",null,[T[103]||(T[103]=t("每个分量的噪音量可通过训练权重")),Q("mjx-container",Y,[(e(),a("svg",Q1,T[101]||(T[101]=[l("",1)]))),T[102]||(T[102]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("msub",null,[Q("mi",null,"W"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mtext",null,"noise")])])])],-1))]),T[104]||(T[104]=t("来控制"))]),T[105]||(T[105]=t("。"))])])])]),Q("mjx-container",T1,[(e(),a("svg",t1,T[110]||(T[110]=[l("",1)]))),T[111]||(T[111]=Q("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[Q("mstyle",{mathcolor:"blue"},[Q("mtable",{columnalign:"left",columnspacing:"1em",rowspacing:"4pt"},[Q("mtr",null,[Q("mtd",null,[Q("mi",null,"G"),Q("mo",{stretchy:"false"},"("),Q("mi",null,"x"),Q("mo",{stretchy:"false"},")"),Q("mo",null,"="),Q("mtext",null,"softmax"),Q("mo",{stretchy:"false"},"("),Q("mstyle",{mathcolor:"red"},[Q("mtext",null,"KeepTopk"),Q("mo",{stretchy:"false"},"("),Q("mi",null,"H"),Q("mo",{stretchy:"false"},"("),Q("mi",null,"x"),Q("mo",{stretchy:"false"},")"),Q("mo",null,","),Q("mi",null,"k"),Q("mo",{stretchy:"false"},")")]),Q("mo",{stretchy:"false"},")")])]),Q("mtr",null,[Q("mtd",null,[Q("mi",null,"H"),Q("mo",{stretchy:"false"},"("),Q("mi",null,"x"),Q("msub",null,[Q("mo",{stretchy:"false"},")"),Q("mi",null,"i")]),Q("mo",null,"="),Q("mo",{stretchy:"false"},"("),Q("mi",null,"x"),Q("mo",null,"⋅"),Q("msub",null,[Q("mi",null,"W"),Q("mi",null,"g")]),Q("msub",null,[Q("mo",{stretchy:"false"},")"),Q("mi",null,"i")]),Q("mo",null,"+"),Q("mstyle",{mathcolor:"red"},[Q("mtext",null,"StandardNorm"),Q("mo",{stretchy:"false"},"("),Q("mo",{stretchy:"false"},")"),Q("mo",null,"⋅"),Q("mtext",null,"Softplus"),Q("mo",{stretchy:"false"},"("),Q("mo",{stretchy:"false"},"("),Q("mi",null,"x"),Q("mo",null,"⋅"),Q("msub",null,[Q("mi",null,"W"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mtext",null,"noies")])]),Q("msub",null,[Q("mo",{stretchy:"false"},")"),Q("mi",null,"i")]),Q("mo",{stretchy:"false"},")")])])]),Q("mtr",null,[Q("mtd",null,[Q("mstyle",{mathcolor:"red"},[Q("mtext",null,"KeepTopk"),Q("mo",{stretchy:"false"},"("),Q("mi",null,"v"),Q("mo",null,","),Q("mi",null,"k"),Q("msub",null,[Q("mo",{stretchy:"false"},")"),Q("mi",null,"i")]),Q("mo",null,"="),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mo",{fence:"false",stretchy:"false"},"{"),Q("mtable",{columnspacing:"1em",rowspacing:"4pt"},[Q("mtr",null,[Q("mtd",null,[Q("msub",null,[Q("mi",null,"v"),Q("mi",null,"i")])]),Q("mtd",null,[Q("mtext",null,"if"),Q("mstyle",{scriptlevel:"0"},[Q("mspace",{width:"0.278em"})]),Q("msub",null,[Q("mi",null,"v"),Q("mi",null,"i")]),Q("mo",null,"∈"),Q("mi",null,"t"),Q("mi",null,"o"),Q("msub",null,[Q("mi",null,"p"),Q("mi",null,"k")])])]),Q("mtr",null,[Q("mtd",null,[Q("mo",null,"−"),Q("mi",{mathvariant:"normal"},"∞")]),Q("mtd",null,[Q("mtext",null,"otherwise")])])])])])])])])])])],-1))])]),T[193]||(T[193]=Q("h3",{id:"批量减小及专家平衡问题",tabindex:"-1"},[t("批量减小及专家平衡问题 "),Q("a",{class:"header-anchor",href:"#批量减小及专家平衡问题","aria-label":'Permalink to "批量减小及专家平衡问题"'},"​")],-1)),Q("div",a1,[T[146]||(T[146]=Q("div",{class:"custom-block-title"},"MoE 批量减小问题",-1)),T[147]||(T[147]=Q("p",null,[Q("strong",null,"批量减小问题")],-1)),Q("ul",null,[Q("li",null,[T[129]||(T[129]=t("低效问题：")),T[130]||(T[130]=Q("strong",null,"专家数量增加导致单专家处理样本变少",-1)),T[131]||(T[131]=t(" ‼️。 ")),Q("ul",null,[Q("li",null,[Q("mjx-container",e1,[(e(),a("svg",l1,T[116]||(T[116]=[Q("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[Q("g",{"data-mml-node":"math"},[Q("g",{"data-mml-node":"mi"},[Q("path",{"data-c":"1D45B",d:"M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z",style:{"stroke-width":"3"}})])])],-1)]))),T[117]||(T[117]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mi",null,"n")])],-1))]),T[124]||(T[124]=t("个专家选")),Q("mjx-container",s1,[(e(),a("svg",o1,T[118]||(T[118]=[Q("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[Q("g",{"data-mml-node":"math"},[Q("g",{"data-mml-node":"mi"},[Q("path",{"data-c":"1D458",d:"M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z",style:{"stroke-width":"3"}})])])],-1)]))),T[119]||(T[119]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mi",null,"k")])],-1))]),T[125]||(T[125]=t("个，")),Q("mjx-container",r1,[(e(),a("svg",d1,T[120]||(T[120]=[Q("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[Q("g",{"data-mml-node":"math"},[Q("g",{"data-mml-node":"mi"},[Q("path",{"data-c":"1D44F",d:"M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z",style:{"stroke-width":"3"}})])])],-1)]))),T[121]||(T[121]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mi",null,"b")])],-1))]),T[126]||(T[126]=t("个样本，每个专家处理")),Q("mjx-container",n1,[(e(),a("svg",m1,T[122]||(T[122]=[l("",1)]))),T[123]||(T[123]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mfrac",null,[Q("mrow",null,[Q("mi",null,"b"),Q("mo",null,"⋅"),Q("mi",null,"k")]),Q("mi",null,"n")]),Q("mo",null,"<<"),Q("mi",null,"b")])],-1))]),T[127]||(T[127]=t("个样本，非常低效。"))]),T[128]||(T[128]=Q("li",null,"如果提高b，但受内存限制。",-1))])]),Q("li",null,[T[145]||(T[145]=t("解决方法 ")),Q("ul",null,[Q("li",null,[T[141]||(T[141]=Q("strong",null,"混合数据并行",-1)),T[142]||(T[142]=t("（复制完整模型到多设备）、模型并行（拆分模型参数到不同设备），")),T[143]||(T[143]=Q("strong",null,"变相扩大b",-1)),Q("ul",null,[Q("li",null,[T[138]||(T[138]=t("如果")),Q("mjx-container",i1,[(e(),a("svg",H1,T[132]||(T[132]=[Q("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[Q("g",{"data-mml-node":"math"},[Q("g",{"data-mml-node":"mi"},[Q("path",{"data-c":"1D451",d:"M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z",style:{"stroke-width":"3"}})])])],-1)]))),T[133]||(T[133]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mi",null,"d")])],-1))]),T[139]||(T[139]=t("个设备，有效批次")),Q("mjx-container",h1,[(e(),a("svg",p1,T[134]||(T[134]=[l("",1)]))),T[135]||(T[135]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mi",null,"b"),Q("mo",null,"⋅"),Q("mi",null,"d")])],-1))]),T[140]||(T[140]=t("，每个专家 处理样本：")),Q("mjx-container",g1,[(e(),a("svg",V1,T[136]||(T[136]=[l("",1)]))),T[137]||(T[137]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mfrac",null,[Q("mrow",null,[Q("mi",null,"k"),Q("mo",null,"⋅"),Q("mi",null,"b"),Q("mo",null,"⋅"),Q("mi",null,"d")]),Q("mi",null,"n")])])],-1))])])])]),T[144]||(T[144]=Q("li",null,"增加循环MoE的批大小",-1))])])])]),Q("div",L1,[T[176]||(T[176]=l("",4)),Q("ul",null,[Q("li",null,[T[150]||(T[150]=t("软性约束：定义专家重要性损失")),Q("mjx-container",u1,[(e(),a("svg",w1,T[148]||(T[148]=[l("",1)]))),T[149]||(T[149]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("msub",null,[Q("mi",null,"L"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mtext",null,"importance")])])])],-1))]),T[151]||(T[151]=t("，在一个batch上门控网络的和。 ")),T[152]||(T[152]=Q("ul",null,[Q("li",null,"鼓励所有专家有相同的重要度，但专家仍可能收到差异很大的样本。")],-1))])]),Q("mjx-container",c1,[(e(),a("svg",x1,T[153]||(T[153]=[l("",1)]))),T[154]||(T[154]=Q("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[Q("mtable",{columnalign:"left",columnspacing:"1em",rowspacing:"4pt"},[Q("mtr",null,[Q("mtd",null,[Q("mtext",null,"Importance"),Q("mo",{stretchy:"false"},"("),Q("mi",null,"X"),Q("mo",{stretchy:"false"},")"),Q("mo",null,"="),Q("munder",null,[Q("mo",{"data-mjx-texclass":"OP",movablelimits:"false"},"∑"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"x"),Q("mo",null,"∈"),Q("mi",null,"X")])]),Q("mi",null,"G"),Q("mo",{stretchy:"false"},"("),Q("mi",null,"X"),Q("mo",{stretchy:"false"},")")])]),Q("mtr",null,[Q("mtd",null,[Q("mi",null,"L"),Q("mo",{stretchy:"false"},"("),Q("mi",null,"X"),Q("mo",{stretchy:"false"},")"),Q("mo",null,"="),Q("mi",null,"λ"),Q("mo",null,"⋅"),Q("mi",null,"C"),Q("mi",null,"V"),Q("mo",{stretchy:"false"},"("),Q("mtext",null,"Importance"),Q("mo",{stretchy:"false"},"("),Q("mi",null,"X"),Q("mo",{stretchy:"false"},")"),Q("msup",null,[Q("mo",{stretchy:"false"},")"),Q("mn",null,"2")])])])])])],-1))]),T[177]||(T[177]=Q("p",null,[Q("strong",null,"解决方法2：不同的负载均衡loss"),t(" (谷歌Switch Transformers)")],-1)),Q("ul",null,[T[159]||(T[159]=Q("li",null,[Q("p",null,"符号：n专家，T个token的batch B")],-1)),Q("li",null,[Q("p",null,[T[157]||(T[157]=Q("strong",null,"所有token路由到专家i的概率",-1)),T[158]||(T[158]=t("，")),Q("mjx-container",f1,[(e(),a("svg",M1,T[155]||(T[155]=[l("",1)]))),T[156]||(T[156]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("msub",null,[Q("mi",null,"P"),Q("mi",null,"i")])])],-1))])])])]),Q("mjx-container",y1,[(e(),a("svg",k1,T[160]||(T[160]=[l("",1)]))),T[161]||(T[161]=Q("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[Q("msub",null,[Q("mi",null,"P"),Q("mi",null,"i")]),Q("mo",{stretchy:"false"},"("),Q("mi",null,"x"),Q("mo",{stretchy:"false"},")"),Q("mo",null,"="),Q("mfrac",null,[Q("mn",null,"1"),Q("mi",null,"T")]),Q("munder",null,[Q("mo",{"data-mjx-texclass":"OP",movablelimits:"false"},"∑"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"x"),Q("mo",null,"∈"),Q("mi",null,"B")])]),Q("msub",null,[Q("mi",null,"p"),Q("mi",null,"i")]),Q("mo",{stretchy:"false"},"("),Q("mi",null,"x"),Q("mo",{stretchy:"false"},")")])],-1))]),Q("ul",null,[Q("li",null,[T[164]||(T[164]=Q("strong",null,"batch中分配给i的token占比",-1)),T[165]||(T[165]=t(", ")),Q("mjx-container",Z1,[(e(),a("svg",b1,T[162]||(T[162]=[l("",1)]))),T[163]||(T[163]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("msub",null,[Q("mi",null,"f"),Q("mi",null,"i")])])],-1))])])]),Q("mjx-container",v1,[(e(),a("svg",D1,T[166]||(T[166]=[l("",1)]))),T[167]||(T[167]=Q("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[Q("msub",null,[Q("mi",null,"f"),Q("mi",null,"i")]),Q("mo",null,"="),Q("mfrac",null,[Q("mn",null,"1"),Q("mi",null,"T")]),Q("munder",null,[Q("mo",{"data-mjx-texclass":"OP",movablelimits:"false"},"∑"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"x"),Q("mo",null,"∈"),Q("mi",null,"B")])]),Q("mo",{fence:"false",stretchy:"false"},"{"),Q("mtext",null,"argmax"),Q("mstyle",{scriptlevel:"0"},[Q("mspace",{width:"0.278em"})]),Q("mi",null,"p"),Q("mo",{stretchy:"false"},"("),Q("mi",null,"x"),Q("mo",{stretchy:"false"},")"),Q("mo",null,"="),Q("mi",null,"i"),Q("mo",{fence:"false",stretchy:"false"},"}")])],-1))]),Q("ul",null,[Q("li",null,[T[172]||(T[172]=Q("strong",null,"辅助loss",-1)),T[173]||(T[173]=t("，乘以专家数量。 ")),Q("ul",null,[Q("li",null,[T[170]||(T[170]=t("其中")),Q("mjx-container",_1,[(e(),a("svg",A1,T[168]||(T[168]=[l("",1)]))),T[169]||(T[169]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mi",null,"α"),Q("mo",null,"="),Q("msup",null,[Q("mn",null,"10"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mo",null,"−"),Q("mn",null,"2")])])])],-1))]),T[171]||(T[171]=t("是个超参数，足够大保证负载均衡，足够小，不影响主要的交叉熵训练。"))])])])]),Q("mjx-container",j1,[(e(),a("svg",C1,T[174]||(T[174]=[l("",1)]))),T[175]||(T[175]=Q("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[Q("msub",null,[Q("mtext",null,"loss"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mtext",null,"aux")])]),Q("mo",null,"="),Q("mstyle",{mathcolor:"red"},[Q("mi",null,"α"),Q("mo",null,"⋅"),Q("mi",null,"n"),Q("mo",null,"⋅"),Q("munderover",null,[Q("mo",{"data-mjx-texclass":"OP",movablelimits:"false"},"∑"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"i"),Q("mo",null,"="),Q("mn",null,"1")]),Q("mi",null,"n")]),Q("msub",null,[Q("mi",null,"f"),Q("mi",null,"i")]),Q("mo",null,"⋅"),Q("msub",null,[Q("mi",null,"P"),Q("mi",null,"i")])])])],-1))]),T[178]||(T[178]=Q("ul",null,[Q("li",null,[t("loss优点："),Q("strong",null,"鼓励均匀路由"),t("。")])],-1))]),T[194]||(T[194]=l("",3)),Q("div",E1,[T[181]||(T[181]=Q("div",{class:"custom-block-title"},"专家容量及容量因子",-1)),T[182]||(T[182]=Q("p",null,[Q("strong",null,"专家容量/容量因子")],-1)),T[183]||(T[183]=Q("ul",null,[Q("li",null,"背景：门路由动态性根据输入数据动态把token分配给不同专家，要求模型灵活处理数据分布。"),Q("li",null,[t("定义："),Q("strong",null,"每个专家在模型中处理的token数"),t("，n为专家数，capacity factor为容量因子(>1)，")])],-1)),Q("mjx-container",S1,[(e(),a("svg",R1,T[179]||(T[179]=[l("",1)]))),T[180]||(T[180]=Q("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[Q("mtext",null,"Expert Capacity"),Q("mo",null,"="),Q("mfrac",null,[Q("mtext",null,"tokens per batch"),Q("mi",null,"n")]),Q("mo",null,"⋅"),Q("mtext",null,"capacity factor")])],-1))]),T[184]||(T[184]=l("",1))]),T[195]||(T[195]=Q("img",{src:"https://wdndev.github.io/llm_interview_note/02.%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E6%9E%B6%E6%9E%84/3.LLM%20MoE%20%EF%BC%9ASwitch%20Transformers/image/image_NLod4PlUXs.png",style:{display:"block",margin:"auto"},width:"80%"},null,-1))])}const z1=s(o,[["render",O1]]);export{X1 as __pageData,z1 as default};

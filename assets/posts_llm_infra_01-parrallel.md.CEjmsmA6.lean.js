import{_ as s,c as T,o as e,j as t,a2 as l,a}from"./chunks/framework.CJy6NSJ1.js";const E2=JSON.parse('{"title":"分布式并行策略","description":"","frontmatter":{"title":"分布式并行策略","date":"2025-07-17T16:26:31.000Z","create":"2025-07-17T16:26:31.000Z","categories":["infra"],"tags":["data parrallel","pipeline pararrlel","F-then-B","1F1B","Gpipe","PipeDream","PipeDream-Flush","Tensor Parrallel","行并行","列并行","1D Parralel","多维并行","3D并行","序列并行","混合并行","DP+PP+TP","MoE并行"]},"headers":[],"relativePath":"posts/llm/infra/01-parrallel.md","filePath":"posts/llm/infra/01-parrallel.md","lastUpdated":null}'),o={name:"posts/llm/infra/01-parrallel.md"},n={class:"custom-block note"},r={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},m={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.186ex"},xmlns:"http://www.w3.org/2000/svg",width:"8.368ex",height:"1.805ex",role:"img",focusable:"false",viewBox:"0 -716 3698.6 798","aria-hidden":"true"},d={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},i={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.439ex"},xmlns:"http://www.w3.org/2000/svg",width:"10.818ex",height:"2.009ex",role:"img",focusable:"false",viewBox:"0 -694 4781.4 888","aria-hidden":"true"},g={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},p={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"5.203ex",height:"2.452ex",role:"img",focusable:"false",viewBox:"0 -833.9 2299.6 1083.9","aria-hidden":"true"},h={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},u={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.294ex",height:"1.025ex",role:"img",focusable:"false",viewBox:"0 -442 572 453","aria-hidden":"true"},H={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},w={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.62ex",height:"1.027ex",role:"img",focusable:"false",viewBox:"0 -443 716 454","aria-hidden":"true"},c={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},x={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"3.208ex",height:"1.441ex",role:"img",focusable:"false",viewBox:"0 -626 1418 637","aria-hidden":"true"},L={class:"custom-block important"},f={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},k={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-3.733ex"},xmlns:"http://www.w3.org/2000/svg",width:"44.739ex",height:"8.597ex",role:"img",focusable:"false",viewBox:"0 -2150 19774.6 3800","aria-hidden":"true"},y={class:"custom-block tip"},V={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},b={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.798ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.955ex",height:"2.755ex",role:"img",focusable:"false",viewBox:"0 -864.9 864.3 1217.7","aria-hidden":"true"},M={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},v={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"19.559ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 8645.3 1000","aria-hidden":"true"},Z={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},E={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"19.664ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 8691.4 1000","aria-hidden":"true"},B={class:"custom-block important"},D={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},A={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.186ex"},xmlns:"http://www.w3.org/2000/svg",width:"8.368ex",height:"1.805ex",role:"img",focusable:"false",viewBox:"0 -716 3698.6 798","aria-hidden":"true"},P={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},_={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-2.149ex"},xmlns:"http://www.w3.org/2000/svg",width:"5.074ex",height:"5.43ex",role:"img",focusable:"false",viewBox:"0 -1450 2242.6 2400","aria-hidden":"true"},C={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},S={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.339ex"},xmlns:"http://www.w3.org/2000/svg",width:"10.865ex",height:"1.959ex",role:"img",focusable:"false",viewBox:"0 -716 4802.2 866","aria-hidden":"true"},j={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},F={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.339ex"},xmlns:"http://www.w3.org/2000/svg",width:"10.865ex",height:"1.959ex",role:"img",focusable:"false",viewBox:"0 -716 4802.2 866","aria-hidden":"true"},G={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},R={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-5.676ex"},xmlns:"http://www.w3.org/2000/svg",width:"66.57ex",height:"8.956ex",role:"img",focusable:"false",viewBox:"0 -1450 29424 3958.8","aria-hidden":"true"},I={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},U={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"8.889ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 3929.1 1000","aria-hidden":"true"},N={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},z={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.339ex"},xmlns:"http://www.w3.org/2000/svg",width:"9.931ex",height:"1.959ex",role:"img",focusable:"false",viewBox:"0 -716 4389.7 866","aria-hidden":"true"},q={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},O={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.339ex"},xmlns:"http://www.w3.org/2000/svg",width:"9.931ex",height:"1.959ex",role:"img",focusable:"false",viewBox:"0 -716 4389.7 866","aria-hidden":"true"},X={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},J={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-4.092ex"},xmlns:"http://www.w3.org/2000/svg",width:"50.363ex",height:"5.789ex",role:"img",focusable:"false",viewBox:"0 -750 22260.5 2558.8","aria-hidden":"true"},Y={class:"custom-block important"},W={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},K={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.339ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.302ex",height:"1.885ex",role:"img",focusable:"false",viewBox:"0 -683 1017.6 833","aria-hidden":"true"},$={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},t2={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.339ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.302ex",height:"1.885ex",role:"img",focusable:"false",viewBox:"0 -683 1017.6 833","aria-hidden":"true"},Q2={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},a2={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.339ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.533ex",height:"1.885ex",role:"img",focusable:"false",viewBox:"0 -683 1119.6 833","aria-hidden":"true"},l2={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},T2={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.339ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.533ex",height:"1.885ex",role:"img",focusable:"false",viewBox:"0 -683 1119.6 833","aria-hidden":"true"},e2={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},s2={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.817ex"},xmlns:"http://www.w3.org/2000/svg",width:"3.058ex",height:"2.852ex",role:"img",focusable:"false",viewBox:"0 -899.6 1351.5 1260.7","aria-hidden":"true"},o2={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},n2={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-1.022ex"},xmlns:"http://www.w3.org/2000/svg",width:"3.924ex",height:"3.057ex",role:"img",focusable:"false",viewBox:"0 -899.6 1734.4 1351.2","aria-hidden":"true"},r2={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},m2={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-1.022ex"},xmlns:"http://www.w3.org/2000/svg",width:"3.924ex",height:"3.057ex",role:"img",focusable:"false",viewBox:"0 -899.6 1734.4 1351.2","aria-hidden":"true"},d2={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},i2={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.817ex"},xmlns:"http://www.w3.org/2000/svg",width:"3.264ex",height:"2.852ex",role:"img",focusable:"false",viewBox:"0 -899.6 1442.7 1260.7","aria-hidden":"true"},g2={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},p2={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-5.676ex"},xmlns:"http://www.w3.org/2000/svg",width:"56.417ex",height:"8.956ex",role:"img",focusable:"false",viewBox:"0 -1450 24936.4 3958.8","aria-hidden":"true"},h2={class:"custom-block important"},u2={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},H2={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.439ex"},xmlns:"http://www.w3.org/2000/svg",width:"11.243ex",height:"2.009ex",role:"img",focusable:"false",viewBox:"0 -694 4969.4 888","aria-hidden":"true"},w2={class:"custom-block tip"},c2={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},x2={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.357ex",height:"1.025ex",role:"img",focusable:"false",viewBox:"0 -442 600 453","aria-hidden":"true"},L2={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},f2={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"5.203ex",height:"2.452ex",role:"img",focusable:"false",viewBox:"0 -833.9 2299.6 1083.9","aria-hidden":"true"};function k2(y2,Q,V2,b2,M2,v2){return e(),T("div",null,[Q[193]||(Q[193]=t("h2",{id:"总结",tabindex:"-1"},[a("总结 "),t("a",{class:"header-anchor",href:"#总结","aria-label":'Permalink to "总结"'},"​")],-1)),Q[194]||(Q[194]=t("h3",{id:"分布式并行策略总结",tabindex:"-1"},[a("分布式并行策略总结 "),t("a",{class:"header-anchor",href:"#分布式并行策略总结","aria-label":'Permalink to "分布式并行策略总结"'},"​")],-1)),t("div",n,[Q[23]||(Q[23]=l("",6)),t("ul",null,[t("li",null,[Q[2]||(Q[2]=a("模型按")),Q[3]||(Q[3]=t("strong",null,"层内参数",-1)),Q[4]||(Q[4]=a("/")),Q[5]||(Q[5]=t("strong",null,"Tensor",-1)),Q[6]||(Q[6]=a("划分，每个设备")),Q[7]||(Q[7]=t("strong",null,"各自计算",-1)),Q[8]||(Q[8]=a("一部分，最终再汇总，有通信开销。")),t("mjx-container",r,[(e(),T("svg",m,Q[0]||(Q[0]=[l("",1)]))),Q[1]||(Q[1]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"Y"),t("mo",null,"="),t("mi",null,"X"),t("mi",null,"A")])],-1))])]),Q[14]||(Q[14]=t("li",null,[t("code",null,"行并行"),a("：对模型参数按行划分，输入X需按列划分。"),t("code",null,"列并行"),a("：对模型参数按列划分。以及"),t("strong",null,"MLP/Attention实践"),a("。")],-1)),Q[15]||(Q[15]=t("li",null,[t("code",null,"1D并行"),a("：按1个维度划分，显存占用大，通信成本高；")],-1)),Q[16]||(Q[16]=t("li",null,[t("code",null,"2D并行"),a("：把input和weight沿2个维度划分，降低显存占用；但通信高。")],-1)),t("li",null,[Q[11]||(Q[11]=t("code",null,"2.5D/3D并行",-1)),Q[12]||(Q[12]=a("：使用多个处理器降低通信，")),t("mjx-container",d,[(e(),T("svg",i,Q[9]||(Q[9]=[l("",1)]))),Q[10]||(Q[10]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"p"),t("mo",null,"="),t("mi",null,"q"),t("mo",null,"⋅"),t("mi",null,"d"),t("mo",null,"⋅"),t("mi",null,"d")])],-1))]),Q[13]||(Q[13]=a("。"))])]),Q[24]||(Q[24]=t("p",null,[t("strong",null,"4. 序列并行")],-1)),t("ul",null,[t("li",null,[Q[19]||(Q[19]=a("输入长度为n，self-attention内存需求是")),t("mjx-container",g,[(e(),T("svg",p,Q[17]||(Q[17]=[l("",1)]))),Q[18]||(Q[18]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"o"),t("mo",{stretchy:"false"},"("),t("msup",null,[t("mi",null,"n"),t("mn",null,"2")]),t("mo",{stretchy:"false"},")")])],-1))]),Q[20]||(Q[20]=a("；长序列数据增加activations等中间数据存储，显存高，限制训练能力"))]),Q[21]||(Q[21]=t("li",null,[t("code",null,"Clossal-AI"),a("：输入长度分割成多块；")],-1)),Q[22]||(Q[22]=t("li",null,[t("code",null,"Megatron-LM"),a("：把LayerNorm和Dropout的输入，按输出长度维度进行切分；其计算和激活值分配给不同设备，降低显存。")],-1))]),Q[25]||(Q[25]=l("",4))]),Q[195]||(Q[195]=l("",4)),t("p",null,[Q[32]||(Q[32]=a("数据")),t("mjx-container",h,[(e(),T("svg",u,Q[26]||(Q[26]=[t("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[t("g",{"data-mml-node":"math"},[t("g",{"data-mml-node":"mi"},[t("path",{"data-c":"1D465",d:"M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z",style:{"stroke-width":"3"}})])])],-1)]))),Q[27]||(Q[27]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"x")])],-1))]),Q[33]||(Q[33]=a("、模型")),t("mjx-container",H,[(e(),T("svg",w,Q[28]||(Q[28]=[t("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[t("g",{"data-mml-node":"math"},[t("g",{"data-mml-node":"mi"},[t("path",{"data-c":"1D464",d:"M580 385Q580 406 599 424T641 443Q659 443 674 425T690 368Q690 339 671 253Q656 197 644 161T609 80T554 12T482 -11Q438 -11 404 5T355 48Q354 47 352 44Q311 -11 252 -11Q226 -11 202 -5T155 14T118 53T104 116Q104 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Q21 293 29 315T52 366T96 418T161 441Q204 441 227 416T250 358Q250 340 217 250T184 111Q184 65 205 46T258 26Q301 26 334 87L339 96V119Q339 122 339 128T340 136T341 143T342 152T345 165T348 182T354 206T362 238T373 281Q402 395 406 404Q419 431 449 431Q468 431 475 421T483 402Q483 389 454 274T422 142Q420 131 420 107V100Q420 85 423 71T442 42T487 26Q558 26 600 148Q609 171 620 213T632 273Q632 306 619 325T593 357T580 385Z",style:{"stroke-width":"3"}})])])],-1)]))),Q[29]||(Q[29]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"w")])],-1))]),Q[34]||(Q[34]=a("、结果")),t("mjx-container",c,[(e(),T("svg",x,Q[30]||(Q[30]=[l("",1)]))),Q[31]||(Q[31]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"o"),t("mi",null,"u"),t("mi",null,"t")])],-1))]),Q[35]||(Q[35]=a(" 不并行示意图："))]),Q[196]||(Q[196]=l("",37)),t("div",L,[Q[42]||(Q[42]=t("div",{class:"custom-block-title"},"1. 朴素流水线并行",-1)),Q[43]||(Q[43]=t("p",null,[t("strong",null,"朴素流水线并行")],-1)),t("ul",null,[Q[40]||(Q[40]=t("li",null,[t("p",null,"核心思想"),t("ul",null,[t("li",null,[a("💥"),t("strong",null,"把模型按层间切分成多个Stage(部分)，每个Stage分配给一个GPU"),a("。")]),t("li",null,"在每个Stage的边界处进行通信"),t("li",null,[a("并行策略："),t("strong",null,"F-then-B")])])],-1)),t("li",null,[Q[38]||(Q[38]=t("p",null,"例子",-1)),Q[39]||(Q[39]=t("ul",null,[t("li",null,"前向：GPU1计算中间结果传给GPU2，GPU2计算模型最终结果"),t("li",null,"反向：GPU2计算loss，梯度输出传回GPU1，GPU1完成更新")],-1)),t("mjx-container",f,[(e(),T("svg",k,Q[36]||(Q[36]=[l("",1)]))),Q[37]||(Q[37]=t("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[t("mstyle",{mathcolor:"blue"},[t("mtable",{columnalign:"left",columnspacing:"1em",rowspacing:"4pt"},[t("mtr",null,[t("mtd",null,[t("mtext",null,"网络目标:")]),t("mtd",null,[t("mtext",null,"output"),t("mo",null,"="),t("mi",null,"L"),t("mn",null,"4"),t("mo",{stretchy:"false"},"("),t("mi",null,"L"),t("mn",null,"3"),t("mo",{stretchy:"false"},"("),t("mi",null,"L"),t("mn",null,"2"),t("mo",{stretchy:"false"},"("),t("mi",null,"L"),t("mn",null,"1"),t("mo",{stretchy:"false"},"("),t("mi",null,"i"),t("mi",null,"n"),t("mi",null,"p"),t("mi",null,"u"),t("mi",null,"t"),t("mo",{stretchy:"false"},")"),t("mo",{stretchy:"false"},")"),t("mo",{stretchy:"false"},")"),t("mo",{stretchy:"false"},")")])]),t("mtr",null,[t("mtd",null,[t("mtext",null,"GPU1:")]),t("mtd",null,[t("mi",null,"i"),t("mi",null,"n"),t("mi",null,"s"),t("mo",null,"="),t("mi",null,"L"),t("mn",null,"2"),t("mo",{stretchy:"false"},"("),t("mi",null,"L"),t("mn",null,"1"),t("mo",{stretchy:"false"},"("),t("mi",null,"i"),t("mi",null,"n"),t("mi",null,"p"),t("mi",null,"u"),t("mi",null,"t"),t("mo",{stretchy:"false"},")"),t("mo",{stretchy:"false"},")")])]),t("mtr",null,[t("mtd",null,[t("mtext",null,"GPU2:")]),t("mtd",null,[t("mi",null,"o"),t("mi",null,"u"),t("mi",null,"t"),t("mi",null,"p"),t("mi",null,"u"),t("mi",null,"t"),t("mo",null,"="),t("mi",null,"L"),t("mn",null,"4"),t("mo",{stretchy:"false"},"("),t("mi",null,"L"),t("mn",null,"3"),t("mo",{stretchy:"false"},"("),t("mi",null,"i"),t("mi",null,"n"),t("mi",null,"s"),t("mo",{stretchy:"false"},")"),t("mo",{stretchy:"false"},")")])])])])])],-1))])]),Q[41]||(Q[41]=l("",1))])]),Q[197]||(Q[197]=l("",21)),t("div",y,[Q[65]||(Q[65]=t("div",{class:"custom-block-title"},"Tensor并行",-1)),t("ul",null,[t("li",null,[Q[52]||(Q[52]=t("p",null,[t("strong",null,"思想")],-1)),t("ul",null,[t("li",null,[Q[46]||(Q[46]=a("把Tensor")),Q[47]||(Q[47]=t("strong",null,"沿特定维度切分成n块",-1)),Q[48]||(Q[48]=a("💡，每个设备")),Q[49]||(Q[49]=t("strong",null,"只持",-1)),t("mjx-container",V,[(e(),T("svg",b,Q[44]||(Q[44]=[l("",1)]))),Q[45]||(Q[45]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mstyle",{mathcolor:"blue"},[t("mfrac",null,[t("mn",null,"1"),t("mi",null,"n")])])])],-1))])]),Q[50]||(Q[50]=t("li",null,[a("每个设备"),t("strong",null,"各自计算一部分"),a("🔑，再通过"),t("strong",null,"通信串联"),a("起完整结果。")],-1)),Q[51]||(Q[51]=t("li",null,"同时不影响图的计算正确性。",-1))])]),t("li",null,[Q[62]||(Q[62]=t("p",null,[t("strong",null,"例子"),a(),t("code",null,"C=AB计算")],-1)),t("ul",null,[t("li",null,[t("mjx-container",M,[(e(),T("svg",v,Q[53]||(Q[53]=[l("",1)]))),Q[54]||(Q[54]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mstyle",{mathcolor:"blue"},[t("mi",null,"B"),t("mo",null,"="),t("mo",{stretchy:"false"},"["),t("msub",null,[t("mi",null,"B"),t("mn",null,"0")]),t("mstyle",{scriptlevel:"0"},[t("mspace",{width:"0.278em"})]),t("msub",null,[t("mi",null,"B"),t("mn",null,"1")]),t("mstyle",{scriptlevel:"0"},[t("mspace",{width:"0.278em"})]),t("mo",null,"⋯"),t("mstyle",{scriptlevel:"0"},[t("mspace",{width:"0.278em"})]),t("msub",null,[t("mi",null,"B"),t("mi",null,"n")]),t("mo",{stretchy:"false"},"]")])])],-1))])]),t("li",null,[Q[57]||(Q[57]=a("每个")),Q[58]||(Q[58]=t("strong",null,"设备各自计算",-1)),t("mjx-container",Z,[(e(),T("svg",E,Q[55]||(Q[55]=[l("",1)]))),Q[56]||(Q[56]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mstyle",{mathcolor:"blue"},[t("mo",{stretchy:"false"},"["),t("mi",null,"A"),t("msub",null,[t("mi",null,"B"),t("mn",null,"0")]),t("mo",null,","),t("mi",null,"A"),t("msub",null,[t("mi",null,"B"),t("mn",null,"1")]),t("mo",null,","),t("mo",null,"⋯"),t("mi",null,"A"),t("msub",null,[t("mi",null,"B"),t("mi",null,"n")]),t("mo",{stretchy:"false"},"]")])])],-1))]),Q[59]||(Q[59]=a("，最后")),Q[60]||(Q[60]=t("strong",null,"再通信广播合并起来",-1)),Q[61]||(Q[61]=a("。"))])])]),Q[63]||(Q[63]=t("li",null,[t("p",null,[t("strong",null,"优点"),a("：节省了"),t("mark",null,"多设备间的梯度AllReduce"),a(" 🔑")])],-1)),Q[64]||(Q[64]=t("li",null,[t("p",null,[t("strong",null,"缺点"),a("：带来额外的"),t("mark",null,"通信开销"),a("⚠️ (每个设备做广播通信)")])],-1))])]),Q[198]||(Q[198]=t("img",{src:"https://docs.oneflow.org/master/parallelism/imgs/matmul_model_paralelism.png",style:{display:"block",margin:"auto"},width:"80%"},null,-1)),Q[199]||(Q[199]=t("img",{src:"https://wdndev.github.io/llm_interview_note/04.%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%AD%E7%BB%83/4.%E5%BC%A0%E9%87%8F%E5%B9%B6%E8%A1%8C/image/image_99Ji-kbokD.png",style:{display:"block",margin:"auto"},width:"50%"},null,-1)),Q[200]||(Q[200]=t("h3",{id:"张量并行方式-行并行和列并行",tabindex:"-1"},[a("张量并行方式(行并行和列并行) "),t("a",{class:"header-anchor",href:"#张量并行方式-行并行和列并行","aria-label":'Permalink to "张量并行方式(行并行和列并行)"'},"​")],-1)),t("div",B,[Q[111]||(Q[111]=t("div",{class:"custom-block-title"},"行并行和列并行",-1)),Q[112]||(Q[112]=t("p",null,[a("📕"),t("strong",null,"核心")],-1)),t("ul",null,[t("li",null,[Q[68]||(Q[68]=t("code",null,"X是输入",-1)),Q[69]||(Q[69]=a("，")),Q[70]||(Q[70]=t("code",null,"A是模型",-1)),Q[71]||(Q[71]=a("， ")),t("mjx-container",D,[(e(),T("svg",A,Q[66]||(Q[66]=[l("",1)]))),Q[67]||(Q[67]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mstyle",{mathcolor:"blue"},[t("mi",null,"Y"),t("mo",null,"="),t("mi",null,"X"),t("mi",null,"A")])])],-1))]),Q[72]||(Q[72]=a("，")),Q[73]||(Q[73]=t("code",null,"Y是模型输出",-1)),Q[74]||(Q[74]=a("。"))]),Q[75]||(Q[75]=t("li",null,[a("把模型切割成"),t("mark",null,"2部分"),a("，放在"),t("mark",null,"不同的GPU"),a("上进行运算。")],-1))]),Q[113]||(Q[113]=t("p",null,[a("🐱"),t("strong",null,"行并行")],-1)),t("ul",null,[t("li",null,[Q[78]||(Q[78]=a("模型权重A")),Q[79]||(Q[79]=t("strong",null,"按行切分",-1)),Q[80]||(Q[80]=a("成2部分：")),t("mjx-container",P,[(e(),T("svg",_,Q[76]||(Q[76]=[l("",1)]))),Q[77]||(Q[77]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mstyle",{mathcolor:"blue"},[t("mrow",{"data-mjx-texclass":"INNER"},[t("mo",{"data-mjx-texclass":"OPEN"},"["),t("mtable",{columnspacing:"1em",rowspacing:"4pt"},[t("mtr",null,[t("mtd",null,[t("msub",null,[t("mi",null,"A"),t("mn",null,"1")])])]),t("mtr",null,[t("mtd",null,[t("msub",null,[t("mi",null,"A"),t("mn",null,"2")])])])]),t("mo",{"data-mjx-texclass":"CLOSE"},"]")])])])],-1))]),Q[81]||(Q[81]=t("ul",null,[t("li",null,[a("为"),t("strong",null,"保矩阵运算"),a("，需要把"),t("strong",null,"X按列分割"),a("成2部分，X是列数需要和A的行数相等。")])],-1))]),t("li",null,[Q[91]||(Q[91]=a("计算示例 ")),t("ul",null,[t("li",null,[Q[86]||(Q[86]=t("code",null,"GPU0",-1)),Q[87]||(Q[87]=a("：")),t("mjx-container",C,[(e(),T("svg",S,Q[82]||(Q[82]=[l("",1)]))),Q[83]||(Q[83]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"X"),t("mn",null,"1")]),t("msub",null,[t("mi",null,"A"),t("mn",null,"1")]),t("mo",null,"="),t("msub",null,[t("mi",null,"Y"),t("mn",null,"1")])])],-1))]),Q[88]||(Q[88]=a("， ")),Q[89]||(Q[89]=t("code",null,"GPU1",-1)),Q[90]||(Q[90]=a("：")),t("mjx-container",j,[(e(),T("svg",F,Q[84]||(Q[84]=[l("",1)]))),Q[85]||(Q[85]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"X"),t("mn",null,"2")]),t("msub",null,[t("mi",null,"A"),t("mn",null,"2")]),t("mo",null,"="),t("msub",null,[t("mi",null,"Y"),t("mn",null,"2")])])],-1))])])])])]),t("mjx-container",G,[(e(),T("svg",R,Q[92]||(Q[92]=[l("",1)]))),Q[93]||(Q[93]=t("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[t("mstyle",{mathcolor:"blue"},[t("mi",null,"X"),t("mi",null,"A"),t("mo",null,"="),t("mstyle",{mathcolor:"red"},[t("mi",null,"X"),t("mo",null,"⋅"),t("munder",null,[t("mrow",{"data-mjx-texclass":"OP"},[t("munder",null,[t("mrow",{"data-mjx-texclass":"INNER"},[t("mo",{"data-mjx-texclass":"OPEN"},"["),t("mtable",{columnspacing:"1em",rowspacing:"4pt"},[t("mtr",null,[t("mtd",null,[t("msub",null,[t("mi",null,"A"),t("mn",null,"1")])])]),t("mtr",null,[t("mtd",null,[t("msub",null,[t("mi",null,"A"),t("mn",null,"2")])])])]),t("mo",{"data-mjx-texclass":"CLOSE"},"]")]),t("mo",null,"⏟")])]),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{mathvariant:"normal"},"按"),t("mi",{mathvariant:"normal"},"行"),t("mi",{mathvariant:"normal"},"切"),t("mi",{mathvariant:"normal"},"分")])]),t("mo",null,"="),t("munder",null,[t("mrow",{"data-mjx-texclass":"OP"},[t("munder",null,[t("mrow",null,[t("mo",{stretchy:"false"},"["),t("msub",null,[t("mi",null,"X"),t("mn",null,"1")]),t("mstyle",{scriptlevel:"0"},[t("mspace",{width:"0.278em"})]),t("mstyle",{scriptlevel:"0"},[t("mspace",{width:"0.278em"})]),t("msub",null,[t("mi",null,"X"),t("mn",null,"2")]),t("mo",{stretchy:"false"},"]")]),t("mo",null,"⏟")])]),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{mathvariant:"normal"},"为"),t("mi",{mathvariant:"normal"},"保"),t("mi",{mathvariant:"normal"},"证"),t("mi",{mathvariant:"normal"},"运"),t("mi",{mathvariant:"normal"},"算")])]),t("mo",null,"⋅"),t("mrow",{"data-mjx-texclass":"INNER"},[t("mo",{"data-mjx-texclass":"OPEN"},"["),t("mtable",{columnspacing:"1em",rowspacing:"4pt"},[t("mtr",null,[t("mtd",null,[t("msub",null,[t("mi",null,"A"),t("mn",null,"1")])])]),t("mtr",null,[t("mtd",null,[t("msub",null,[t("mi",null,"A"),t("mn",null,"2")])])])]),t("mo",{"data-mjx-texclass":"CLOSE"},"]")])]),t("mo",null,"="),t("msub",null,[t("mi",null,"X"),t("mn",null,"1")]),t("msub",null,[t("mi",null,"A"),t("mn",null,"1")]),t("mo",null,"+"),t("msub",null,[t("mi",null,"X"),t("mn",null,"2")]),t("msub",null,[t("mi",null,"A"),t("mn",null,"2")]),t("mo",null,"="),t("mstyle",{mathcolor:"red"},[t("msub",null,[t("mi",null,"Y"),t("mn",null,"1")]),t("mo",null,"+"),t("msub",null,[t("mi",null,"Y"),t("mn",null,"2")])]),t("mo",null,"="),t("mi",null,"Y")])])],-1))]),Q[114]||(Q[114]=t("p",null,[a("🐕"),t("strong",null,"列并行")],-1)),t("ul",null,[t("li",null,[Q[96]||(Q[96]=a("模型权重A")),Q[97]||(Q[97]=t("strong",null,"按列切分",-1)),Q[98]||(Q[98]=a("成2部分：")),t("mjx-container",I,[(e(),T("svg",U,Q[94]||(Q[94]=[l("",1)]))),Q[95]||(Q[95]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mstyle",{mathcolor:"blue"},[t("mrow",{"data-mjx-texclass":"INNER"},[t("mo",{"data-mjx-texclass":"OPEN"},"["),t("mtable",{columnspacing:"1em",rowspacing:"4pt"},[t("mtr",null,[t("mtd",null,[t("msub",null,[t("mi",null,"A"),t("mn",null,"1")])]),t("mtd",null,[t("msub",null,[t("mi",null,"A"),t("mn",null,"2")])])])]),t("mo",{"data-mjx-texclass":"CLOSE"},"]")])])])],-1))])]),t("li",null,[Q[108]||(Q[108]=a("计算示例 ")),t("ul",null,[t("li",null,[Q[103]||(Q[103]=t("code",null,"GPU0",-1)),Q[104]||(Q[104]=a("：")),t("mjx-container",N,[(e(),T("svg",z,Q[99]||(Q[99]=[l("",1)]))),Q[100]||(Q[100]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"X"),t("msub",null,[t("mi",null,"A"),t("mn",null,"1")]),t("mo",null,"="),t("msub",null,[t("mi",null,"Y"),t("mn",null,"1")])])],-1))]),Q[105]||(Q[105]=a("， ")),Q[106]||(Q[106]=t("code",null,"GPU1",-1)),Q[107]||(Q[107]=a("：")),t("mjx-container",q,[(e(),T("svg",O,Q[101]||(Q[101]=[l("",1)]))),Q[102]||(Q[102]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"X"),t("msub",null,[t("mi",null,"A"),t("mn",null,"2")]),t("mo",null,"="),t("msub",null,[t("mi",null,"Y"),t("mn",null,"2")])])],-1))])])])])]),t("mjx-container",X,[(e(),T("svg",J,Q[109]||(Q[109]=[l("",1)]))),Q[110]||(Q[110]=t("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[t("mstyle",{mathcolor:"blue"},[t("mi",null,"X"),t("mi",null,"A"),t("mo",null,"="),t("mo",{stretchy:"false"},"["),t("mi",null,"X"),t("mo",{stretchy:"false"},"]"),t("mstyle",{mathcolor:"red"},[t("munder",null,[t("mrow",{"data-mjx-texclass":"OP"},[t("munder",null,[t("mrow",{"data-mjx-texclass":"INNER"},[t("mo",{"data-mjx-texclass":"OPEN"},"["),t("mtable",{columnspacing:"1em",rowspacing:"4pt"},[t("mtr",null,[t("mtd",null,[t("msub",null,[t("mi",null,"A"),t("mn",null,"1")])]),t("mtd",null,[t("msub",null,[t("mi",null,"A"),t("mn",null,"2")])])])]),t("mo",{"data-mjx-texclass":"CLOSE"},"]")]),t("mo",null,"⏟")])]),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{mathvariant:"normal"},"按"),t("mi",{mathvariant:"normal"},"列"),t("mi",{mathvariant:"normal"},"切"),t("mi",{mathvariant:"normal"},"分")])])]),t("mo",null,"="),t("mrow",{"data-mjx-texclass":"INNER"},[t("mo",{"data-mjx-texclass":"OPEN"},"["),t("mtable",{columnspacing:"1em",rowspacing:"4pt"},[t("mtr",null,[t("mtd",null,[t("mi",null,"X"),t("msub",null,[t("mi",null,"A"),t("mn",null,"1")])]),t("mtd",null,[t("mi",null,"X"),t("msub",null,[t("mi",null,"A"),t("mn",null,"2")])])])]),t("mo",{"data-mjx-texclass":"CLOSE"},"]")]),t("mo",null,"="),t("mstyle",{mathcolor:"red"},[t("mrow",{"data-mjx-texclass":"INNER"},[t("mo",{"data-mjx-texclass":"OPEN"},"["),t("mtable",{columnspacing:"1em",rowspacing:"4pt"},[t("mtr",null,[t("mtd",null,[t("msub",null,[t("mi",null,"Y"),t("mn",null,"1")])]),t("mtd",null,[t("msub",null,[t("mi",null,"Y"),t("mn",null,"2")])])])]),t("mo",{"data-mjx-texclass":"CLOSE"},"]")])]),t("mo",null,"="),t("mi",null,"Y")])])],-1))])]),Q[201]||(Q[201]=l("",7)),t("div",Y,[Q[168]||(Q[168]=l("",4)),t("ul",null,[Q[167]||(Q[167]=t("li",null,[t("p",null,"结构：线性层A+GeLU+线性层B。")],-1)),t("li",null,[Q[166]||(Q[166]=t("p",null,"输入是X，过程是：",-1)),t("ul",null,[t("li",null,[Q[119]||(Q[119]=a("先")),Q[120]||(Q[120]=t("strong",null,"对A列切割",-1)),Q[121]||(Q[121]=a("：先把X")),Q[122]||(Q[122]=t("strong",null,"拷贝到2块GPU",-1)),Q[123]||(Q[123]=a("上，计算得到")),t("mjx-container",W,[(e(),T("svg",K,Q[115]||(Q[115]=[l("",1)]))),Q[116]||(Q[116]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"Y"),t("mn",null,"1")])])],-1))]),Q[124]||(Q[124]=a("和")),t("mjx-container",$,[(e(),T("svg",t2,Q[117]||(Q[117]=[l("",1)]))),Q[118]||(Q[118]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"Y"),t("mn",null,"2")])])],-1))]),Q[125]||(Q[125]=a("，")),Q[126]||(Q[126]=t("code",null,"过激活函数后",-1)),Q[127]||(Q[127]=a("，作为B的输入。"))]),t("li",null,[Q[132]||(Q[132]=a("再")),Q[133]||(Q[133]=t("strong",null,"对B行切割",-1)),Q[134]||(Q[134]=a("：计算得到")),t("mjx-container",Q2,[(e(),T("svg",a2,Q[128]||(Q[128]=[l("",1)]))),Q[129]||(Q[129]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"Z"),t("mn",null,"1")])])],-1))]),Q[135]||(Q[135]=a("和")),t("mjx-container",l2,[(e(),T("svg",T2,Q[130]||(Q[130]=[l("",1)]))),Q[131]||(Q[131]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"Z"),t("mn",null,"2")])])],-1))]),Q[136]||(Q[136]=a("，")),Q[137]||(Q[137]=t("mark",null,"做1次AllReduce",-1)),Q[138]||(Q[138]=a("，")),Q[139]||(Q[139]=t("strong",null,"相加结果",-1)),Q[140]||(Q[140]=a("得到Z⭐。"))]),t("li",null,[Q[143]||(Q[143]=t("strong",null,"B反向传播",-1)),Q[144]||(Q[144]=a("：把")),t("mjx-container",e2,[(e(),T("svg",s2,Q[141]||(Q[141]=[l("",1)]))),Q[142]||(Q[142]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mfrac",null,[t("mrow",null,[t("mi",null,"∂"),t("mi",null,"L")]),t("mrow",null,[t("mi",null,"∂"),t("mi",null,"Z")])])])],-1))]),Q[145]||(Q[145]=a("传到")),Q[146]||(Q[146]=t("strong",null,"2块GPU",-1)),Q[147]||(Q[147]=a("上，")),Q[148]||(Q[148]=t("strong",null,"各自完成",-1)),Q[149]||(Q[149]=a("梯度计算"))]),t("li",null,[Q[156]||(Q[156]=t("strong",null,"A反向传播",-1)),Q[157]||(Q[157]=a("：")),Q[158]||(Q[158]=t("strong",null,"各自求得",-1)),t("mjx-container",o2,[(e(),T("svg",n2,Q[150]||(Q[150]=[l("",1)]))),Q[151]||(Q[151]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mfrac",null,[t("mrow",null,[t("mi",null,"∂"),t("mi",null,"L")]),t("mrow",null,[t("mi",null,"∂"),t("msub",null,[t("mi",null,"X"),t("mn",null,"1")])])])])],-1))]),Q[159]||(Q[159]=a("、")),t("mjx-container",r2,[(e(),T("svg",m2,Q[152]||(Q[152]=[l("",1)]))),Q[153]||(Q[153]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mfrac",null,[t("mrow",null,[t("mi",null,"∂"),t("mi",null,"L")]),t("mrow",null,[t("mi",null,"∂"),t("msub",null,[t("mi",null,"X"),t("mn",null,"2")])])])])],-1))]),Q[160]||(Q[160]=a("后，")),Q[161]||(Q[161]=t("mark",null,"做1次AllReduce",-1)),Q[162]||(Q[162]=a("，相加得到")),t("mjx-container",d2,[(e(),T("svg",i2,Q[154]||(Q[154]=[l("",1)]))),Q[155]||(Q[155]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mstyle",{mathcolor:"red"},[t("mfrac",null,[t("mrow",null,[t("mi",null,"∂"),t("mi",null,"L")]),t("mrow",null,[t("mi",null,"∂"),t("mi",null,"X")])])])])],-1))]),Q[163]||(Q[163]=a("。"))])]),t("mjx-container",g2,[(e(),T("svg",p2,Q[164]||(Q[164]=[l("",1)]))),Q[165]||(Q[165]=t("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[t("mstyle",{mathcolor:"blue"},[t("mi",null,"X"),t("mi",null,"A"),t("mstyle",{scriptlevel:"0"},[t("mspace",{width:"1em"})]),t("mo",{stretchy:"false"},"→"),t("mstyle",{scriptlevel:"0"},[t("mspace",{width:"1em"})]),t("mstyle",{mathcolor:"red"},[t("munder",null,[t("mrow",{"data-mjx-texclass":"OP"},[t("munder",null,[t("mtable",{columnalign:"left left left",columnspacing:"1em",rowspacing:"4pt"},[t("mtr",null,[t("mtd",null,[t("mi",null,"X"),t("msub",null,[t("mi",null,"A"),t("mn",null,"1")])]),t("mtd",null,[t("mo",null,"=")]),t("mtd",null,[t("msub",null,[t("mi",null,"Y"),t("mn",null,"1")])])]),t("mtr",null,[t("mtd",null,[t("mi",null,"X"),t("msub",null,[t("mi",null,"A"),t("mn",null,"2")])]),t("mtd",null,[t("mo",null,"=")]),t("mtd",null,[t("msub",null,[t("mi",null,"Y"),t("mn",null,"2")])])])]),t("mo",null,"⏟")])]),t("mrow",{"data-mjx-texclass":"ORD"},[t("mtext",null,"对A列切割")])])]),t("mstyle",{scriptlevel:"0"},[t("mspace",{width:"1em"})]),t("mo",{stretchy:"false"},"→"),t("mstyle",{scriptlevel:"0"},[t("mspace",{width:"1em"})]),t("mstyle",{mathcolor:"red"},[t("munder",null,[t("mrow",{"data-mjx-texclass":"OP"},[t("munder",null,[t("mtable",{columnalign:"left left left",columnspacing:"1em",rowspacing:"4pt"},[t("mtr",null,[t("mtd",null,[t("msub",null,[t("mi",null,"Y"),t("mn",null,"1")]),t("msub",null,[t("mi",null,"B"),t("mn",null,"1")])]),t("mtd",null,[t("mo",null,"=")]),t("mtd",null,[t("msub",null,[t("mi",null,"Z"),t("mn",null,"1")])])]),t("mtr",null,[t("mtd",null,[t("msub",null,[t("mi",null,"Y"),t("mn",null,"2")]),t("msub",null,[t("mi",null,"B"),t("mn",null,"2")])]),t("mtd",null,[t("mo",null,"=")]),t("mtd",null,[t("msub",null,[t("mi",null,"Z"),t("mn",null,"2")])])])]),t("mo",null,"⏟")])]),t("mrow",{"data-mjx-texclass":"ORD"},[t("mtext",null,"对B行切割")])])]),t("mstyle",{scriptlevel:"0"},[t("mspace",{width:"1em"})]),t("mo",{stretchy:"false"},"→"),t("mstyle",{scriptlevel:"0"},[t("mspace",{width:"1em"})]),t("mi",null,"Z")])])],-1))])])]),Q[169]||(Q[169]=l("",2))]),Q[202]||(Q[202]=l("",9)),t("div",h2,[Q[180]||(Q[180]=l("",6)),t("ul",null,[t("li",null,[Q[172]||(Q[172]=a("核心： 在")),Q[173]||(Q[173]=t("code",null,"2D-SUMMA基础",-1)),Q[174]||(Q[174]=a("上，使")),Q[175]||(Q[175]=t("strong",null,"用更多设备(P个处理器)来减少通信",-1)),Q[176]||(Q[176]=a("。")),t("mjx-container",u2,[(e(),T("svg",H2,Q[170]||(Q[170]=[l("",1)]))),Q[171]||(Q[171]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mstyle",{mathcolor:"blue"},[t("mi",null,"P"),t("mo",null,"="),t("mi",null,"q"),t("mo",null,"⋅"),t("mi",null,"q"),t("mo",null,"⋅"),t("mi",null,"d")])])],-1))]),Q[177]||(Q[177]=a(" 个处理器。 ")),Q[178]||(Q[178]=t("ul",null,[t("li",null,"d=1时：2D并行"),t("li",null,"d=q时，3D并行")],-1))]),Q[179]||(Q[179]=t("li",null,"优点：降低了通信",-1))]),Q[181]||(Q[181]=t("p",null,[t("strong",null,"3D 并行")],-1))]),Q[203]||(Q[203]=t("p",null,"Pytorch",-1)),Q[204]||(Q[204]=t("h2",{id:"序列并行",tabindex:"-1"},[a("序列并行 "),t("a",{class:"header-anchor",href:"#序列并行","aria-label":'Permalink to "序列并行"'},"​")],-1)),Q[205]||(Q[205]=t("h3",{id:"基本思路",tabindex:"-1"},[a("基本思路 "),t("a",{class:"header-anchor",href:"#基本思路","aria-label":'Permalink to "基本思路"'},"​")],-1)),t("div",w2,[Q[190]||(Q[190]=t("div",{class:"custom-block-title"},"提示",-1)),Q[191]||(Q[191]=t("p",null,[t("strong",null,"背景")],-1)),t("ul",null,[t("li",null,[Q[188]||(Q[188]=a("传统self-attention的")),t("strong",null,[Q[186]||(Q[186]=a("内存需求是输入长度")),t("mjx-container",c2,[(e(),T("svg",x2,Q[182]||(Q[182]=[t("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[t("g",{"data-mml-node":"math"},[t("g",{"data-mml-node":"mi"},[t("path",{"data-c":"1D45B",d:"M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z",style:{"stroke-width":"3"}})])])],-1)]))),Q[183]||(Q[183]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"n")])],-1))]),Q[187]||(Q[187]=a("的2次方")),t("mjx-container",L2,[(e(),T("svg",f2,Q[184]||(Q[184]=[l("",1)]))),Q[185]||(Q[185]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"o"),t("mo",{stretchy:"false"},"("),t("msup",null,[t("mi",null,"n"),t("mn",null,"2")]),t("mo",{stretchy:"false"},")")])],-1))])])]),Q[189]||(Q[189]=t("li",null,[a("😓"),t("code",null,"长序列数据"),a("会增加"),t("strong",null,"中间activations的内存使用量"),a("，限制了设备的"),t("strong",null,"训练能力"),a("。")],-1))]),Q[192]||(Q[192]=l("",4))]),Q[206]||(Q[206]=l("",27))])}const B2=s(o,[["render",k2]]);export{E2 as __pageData,B2 as default};

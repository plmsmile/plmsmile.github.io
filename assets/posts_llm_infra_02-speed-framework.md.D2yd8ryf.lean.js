import{_ as s,c as e,o as a,ah as T,j as t,a as Q}from"./chunks/framework.CvbyeFFO.js";const C1=JSON.parse('{"title":"分布式训练框架","description":"","frontmatter":{"title":"分布式训练框架","date":"2025-07-17T19:30:29.000Z","create":"2025-07-17T19:30:29.000Z","categories":["llm-infra"],"tags":["浮点数","有偏指数","FP32","FP16","BF16","梯度溢出","舍入误差","动态损失缩放","混合精度优化","FP32权重备份","模型显存分析","参数","梯度","优化器","激活值","DeepSpeed","ZeRO-DP","Zero1","Zero2","Zero3","Zero-Offload"]},"headers":[],"relativePath":"posts/llm/infra/02-speed-framework.md","filePath":"posts/llm/infra/02-speed-framework.md","lastUpdated":1761231250000}'),o={name:"posts/llm/infra/02-speed-framework.md"},n={class:"custom-block important"},r={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},i={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.186ex"},xmlns:"http://www.w3.org/2000/svg",width:"8.22ex",height:"2.072ex",role:"img",focusable:"false",viewBox:"0 -833.9 3633.4 915.9","aria-hidden":"true"},d={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},m={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.186ex"},xmlns:"http://www.w3.org/2000/svg",width:"10.574ex",height:"2.072ex",role:"img",focusable:"false",viewBox:"0 -833.9 4673.8 915.9","aria-hidden":"true"},p={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},g={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.186ex"},xmlns:"http://www.w3.org/2000/svg",width:"13.34ex",height:"2.072ex",role:"img",focusable:"false",viewBox:"0 -833.9 5896.2 915.9","aria-hidden":"true"},u={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},h={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.186ex"},xmlns:"http://www.w3.org/2000/svg",width:"10.574ex",height:"2.072ex",role:"img",focusable:"false",viewBox:"0 -833.9 4673.8 915.9","aria-hidden":"true"},x={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},w={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"0"},xmlns:"http://www.w3.org/2000/svg",width:"3.364ex",height:"1.885ex",role:"img",focusable:"false",viewBox:"0 -833.2 1486.7 833.2","aria-hidden":"true"},H={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},f={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.186ex"},xmlns:"http://www.w3.org/2000/svg",width:"37.023ex",height:"2.072ex",role:"img",focusable:"false",viewBox:"0 -833.9 16364.3 915.9","aria-hidden":"true"},V={class:"custom-block tip"},L={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},c={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"0"},xmlns:"http://www.w3.org/2000/svg",width:"4.163ex",height:"1.887ex",role:"img",focusable:"false",viewBox:"0 -833.9 1840.2 833.9","aria-hidden":"true"},k={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},y={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.186ex"},xmlns:"http://www.w3.org/2000/svg",width:"10.293ex",height:"2.09ex",role:"img",focusable:"false",viewBox:"0 -841.7 4549.4 923.7","aria-hidden":"true"},b={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},M={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"0"},xmlns:"http://www.w3.org/2000/svg",width:"3.364ex",height:"1.885ex",role:"img",focusable:"false",viewBox:"0 -833.2 1486.7 833.2","aria-hidden":"true"},v={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},Z={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"0"},xmlns:"http://www.w3.org/2000/svg",width:"4.163ex",height:"1.904ex",role:"img",focusable:"false",viewBox:"0 -841.7 1840.2 841.7","aria-hidden":"true"},_={class:"custom-block info"},D={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},A={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"0"},xmlns:"http://www.w3.org/2000/svg",width:"4.163ex",height:"1.904ex",role:"img",focusable:"false",viewBox:"0 -841.7 1840.2 841.7","aria-hidden":"true"},P={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},S={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"0"},xmlns:"http://www.w3.org/2000/svg",width:"2.152ex",height:"1.932ex",role:"img",focusable:"false",viewBox:"0 -853.7 951.4 853.7","aria-hidden":"true"},C={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},j={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"0"},xmlns:"http://www.w3.org/2000/svg",width:"2.152ex",height:"1.932ex",role:"img",focusable:"false",viewBox:"0 -853.7 951.4 853.7","aria-hidden":"true"},B={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},E={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"0"},xmlns:"http://www.w3.org/2000/svg",width:"2.919ex",height:"1.904ex",role:"img",focusable:"false",viewBox:"0 -841.7 1290.1 841.7","aria-hidden":"true"},R={class:"custom-block danger"},I={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},z={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"0"},xmlns:"http://www.w3.org/2000/svg",width:"1.76ex",height:"1.545ex",role:"img",focusable:"false",viewBox:"0 -683 778 683","aria-hidden":"true"},N={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},O={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.489ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.229ex",height:"1.486ex",role:"img",focusable:"false",viewBox:"0 -441 543 657","aria-hidden":"true"},F={tabindex:"0",class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},G={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-2.149ex"},xmlns:"http://www.w3.org/2000/svg",width:"58.686ex",height:"5.43ex",role:"img",focusable:"false",viewBox:"0 -1450 25939.3 2400","aria-hidden":"true"},J={class:"custom-block caution"},U={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},X={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.667ex"},xmlns:"http://www.w3.org/2000/svg",width:"13.546ex",height:"2.213ex",role:"img",focusable:"false",viewBox:"0 -683 5987.4 978","aria-hidden":"true"},q={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},$={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.357ex"},xmlns:"http://www.w3.org/2000/svg",width:"3.166ex",height:"1.902ex",role:"img",focusable:"false",viewBox:"0 -683 1399.6 840.8","aria-hidden":"true"},W={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},K={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.667ex"},xmlns:"http://www.w3.org/2000/svg",width:"5.174ex",height:"2.213ex",role:"img",focusable:"false",viewBox:"0 -683 2287 978","aria-hidden":"true"},Y={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},t1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.667ex"},xmlns:"http://www.w3.org/2000/svg",width:"7.224ex",height:"2.213ex",role:"img",focusable:"false",viewBox:"0 -683 3192.8 978","aria-hidden":"true"},l1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},Q1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.357ex"},xmlns:"http://www.w3.org/2000/svg",width:"3.166ex",height:"1.902ex",role:"img",focusable:"false",viewBox:"0 -683 1399.6 840.8","aria-hidden":"true"},T1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},e1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.781ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.416ex",height:"2.737ex",role:"img",focusable:"false",viewBox:"0 -864.9 1067.9 1209.9","aria-hidden":"true"},a1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},s1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.781ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.416ex",height:"2.737ex",role:"img",focusable:"false",viewBox:"0 -864.9 1067.9 1209.9","aria-hidden":"true"},o1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},n1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.781ex"},xmlns:"http://www.w3.org/2000/svg",width:"16.018ex",height:"2.737ex",role:"img",focusable:"false",viewBox:"0 -864.9 7079.9 1209.9","aria-hidden":"true"},r1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},i1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.667ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.403ex",height:"2.213ex",role:"img",focusable:"false",viewBox:"0 -683 1062.3 978","aria-hidden":"true"},d1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},m1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.781ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.416ex",height:"2.737ex",role:"img",focusable:"false",viewBox:"0 -864.9 1067.9 1209.9","aria-hidden":"true"},p1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},g1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.781ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.416ex",height:"2.737ex",role:"img",focusable:"false",viewBox:"0 -864.9 1067.9 1209.9","aria-hidden":"true"},u1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},h1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.781ex"},xmlns:"http://www.w3.org/2000/svg",width:"21.984ex",height:"2.737ex",role:"img",focusable:"false",viewBox:"0 -864.9 9716.8 1209.9","aria-hidden":"true"},x1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},w1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.65ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.445ex",height:"2.195ex",role:"img",focusable:"false",viewBox:"0 -683 1080.7 970.2","aria-hidden":"true"},H1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},f1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.781ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.416ex",height:"2.737ex",role:"img",focusable:"false",viewBox:"0 -864.9 1067.9 1209.9","aria-hidden":"true"},V1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},L1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.781ex"},xmlns:"http://www.w3.org/2000/svg",width:"22.948ex",height:"2.737ex",role:"img",focusable:"false",viewBox:"0 -864.9 10143.1 1209.9","aria-hidden":"true"},c1={class:"custom-block tip"},k1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},y1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.781ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.416ex",height:"2.737ex",role:"img",focusable:"false",viewBox:"0 -864.9 1067.9 1209.9","aria-hidden":"true"},b1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},M1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.781ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.416ex",height:"2.737ex",role:"img",focusable:"false",viewBox:"0 -864.9 1067.9 1209.9","aria-hidden":"true"};function v1(Z1,l,_1,D1,A1,P1){return a(),e("div",null,[l[221]||(l[221]=T("",5)),t("div",n,[l[38]||(l[38]=t("div",{class:"custom-block-title"},"浮点数(三要素+FP64+FP32)",-1)),l[39]||(l[39]=t("p",null,[t("strong",null,"1. 浮点数三要素"),Q("🐦")],-1)),t("ul",null,[l[37]||(l[37]=t("li",null,[t("strong",null,"符号为S"),Q("：0正，1负")],-1)),t("li",null,[l[21]||(l[21]=t("strong",null,"指数位E",-1)),l[22]||(l[22]=Q("：实际")),l[23]||(l[23]=t("strong",null,"有偏指数",-1)),l[24]||(l[24]=Q("=")),l[25]||(l[25]=t("code",null,"存储指数值-偏移量",-1)),l[26]||(l[26]=Q(" ⭐，2位底 ")),t("ul",null,[l[19]||(l[19]=t("li",null,[Q("为何需要有偏置指数："),t("strong",null,"指数需要有正有负"),Q("，减去偏置值就能变有符号整数，做范围平衡")],-1)),t("li",null,[l[11]||(l[11]=Q("偏置值如何计算：")),t("strong",null,[t("mjx-container",r,[(a(),e("svg",i,l[0]||(l[0]=[T("",1)]))),l[1]||(l[1]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msup",null,[t("mn",null,"2"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"n"),t("mo",null,"−"),t("mn",null,"1")])]),t("mo",null,"−"),t("mn",null,"1")])],-1))])]),l[12]||(l[12]=Q("，IEEE754")),l[13]||(l[13]=t("strong",null,"规定该位置值位0，大于其是正数，小于其是负数",-1)),t("ul",null,[t("li",null,[l[4]||(l[4]=Q("FP32：")),t("mjx-container",d,[(a(),e("svg",m,l[2]||(l[2]=[T("",1)]))),l[3]||(l[3]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msup",null,[t("mn",null,"2"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mn",null,"8"),t("mo",null,"−"),t("mn",null,"1")])]),t("mo",null,"="),t("mn",null,"127")])],-1))])]),t("li",null,[l[7]||(l[7]=Q("FP16：")),t("mjx-container",p,[(a(),e("svg",g,l[5]||(l[5]=[T("",1)]))),l[6]||(l[6]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msup",null,[t("mn",null,"2"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mn",null,"5"),t("mo",null,"−"),t("mn",null,"1")])]),t("mo",null,"−"),t("mn",null,"1"),t("mo",null,"="),t("mn",null,"15")])],-1))])]),t("li",null,[l[10]||(l[10]=Q("BF16：")),t("mjx-container",u,[(a(),e("svg",h,l[8]||(l[8]=[T("",1)]))),l[9]||(l[9]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msup",null,[t("mn",null,"2"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mn",null,"8"),t("mo",null,"−"),t("mn",null,"1")])]),t("mo",null,"="),t("mn",null,"127")])],-1))])])])]),t("li",null,[l[16]||(l[16]=Q("如，FP32是127，指数部分是01111100，实际指数：")),l[17]||(l[17]=t("code",null,"124-127=-3",-1)),l[18]||(l[18]=Q("，即")),t("mjx-container",x,[(a(),e("svg",w,l[14]||(l[14]=[T("",1)]))),l[15]||(l[15]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mstyle",{mathcolor:"red"},[t("msup",null,[t("mn",null,"2"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mo",null,"−"),t("mn",null,"3")])])])])],-1))])]),l[20]||(l[20]=T("",2))])]),t("li",null,[l[31]||(l[31]=t("strong",null,"尾数位M",-1)),l[32]||(l[32]=Q("：有效数字，")),l[33]||(l[33]=t("code",null,"精度",-1)),l[34]||(l[34]=Q("；实际尾数=")),l[35]||(l[35]=t("code",null,"1+尾数部分",-1)),l[36]||(l[36]=Q("， ")),t("ul",null,[l[30]||(l[30]=t("li",null,"因为标准设计从首位从1开始，不足的需要小数点右移。",-1)),t("li",null,[l[29]||(l[29]=Q("比如尾数部分是11000..，实际尾数=")),t("mjx-container",H,[(a(),e("svg",f,l[27]||(l[27]=[T("",1)]))),l[28]||(l[28]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mn",null,"1"),t("mo",null,"+"),t("msup",null,[t("mn",null,"2"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mo",null,"−"),t("mn",null,"1")])]),t("mo",null,"+"),t("msup",null,[t("mn",null,"2"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mo",null,"−"),t("mn",null,"2")])]),t("mo",null,"="),t("mn",null,"1"),t("mo",null,"+"),t("mn",null,"0.5"),t("mo",null,"+"),t("mn",null,"0.25"),t("mo",null,"="),t("mn",null,"1.75")])],-1))])])])])]),l[40]||(l[40]=t("p",null,[t("strong",null,"2. 单精度+双精度FP32/FP64"),Q("🐔")],-1)),l[41]||(l[41]=t("ul",null,[t("li",null,[Q("双精度，FP64：共64位，"),t("code",null,"1 + 11 + 52"),Q("。8个字节。")]),t("li",null,[t("strong",null,"单精度，FP32"),Q("：共32位，"),t("code",null,"1 + 8 + 23"),Q("，指数位8位。4个字节。")])],-1))]),t("div",V,[l[68]||(l[68]=t("div",{class:"custom-block-title"},"FP16+BF16",-1)),l[69]||(l[69]=t("p",null,[t("strong",null,"3. 半精度FP16"),Q("🐱 🚀")],-1)),t("ul",null,[l[66]||(l[66]=T("",2)),t("li",null,[l[65]||(l[65]=t("strong",null,"缺点",-1)),t("ul",null,[l[64]||(l[64]=t("li",null,[t("code",null,"数值下溢或上溢问题"),Q("：数值仅"),t("code",null,"5位"),Q("范围有限 "),t("ul",null,[t("li",null,[Q("训练"),t("strong",null,"后期梯度很小"),Q("，乘以学习率后会更小")])])],-1)),t("li",null,[l[60]||(l[60]=t("code",null,"精度较低+舍入误差问题",-1)),l[61]||(l[61]=Q("：尾数位仅")),l[62]||(l[62]=t("code",null,"10",-1)),l[63]||(l[63]=Q("位 ")),t("ul",null,[t("li",null,[l[51]||(l[51]=Q("🔑FP16")),t("strong",null,[l[44]||(l[44]=Q("最小间隔为")),t("mjx-container",L,[(a(),e("svg",c,l[42]||(l[42]=[T("",1)]))),l[43]||(l[43]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msup",null,[t("mn",null,"2"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mo",null,"−"),t("mn",null,"13")])])])],-1))])]),l[52]||(l[52]=Q("，")),l[53]||(l[53]=t("strong",null,"权重+梯度",-1)),l[54]||(l[54]=Q("=")),t("mjx-container",k,[(a(),e("svg",y,l[45]||(l[45]=[T("",1)]))),l[46]||(l[46]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mstyle",{mathcolor:"blue"},[t("msup",null,[t("mn",null,"2"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mo",null,"−"),t("mn",null,"3")])]),t("mo",null,"+"),t("msup",null,[t("mn",null,"2"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mo",null,"−"),t("mn",null,"14")])])])])],-1))]),l[55]||(l[55]=Q("，")),l[56]||(l[56]=t("strong",null,"仍然等于",-1)),t("mjx-container",b,[(a(),e("svg",M,l[47]||(l[47]=[T("",1)]))),l[48]||(l[48]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mstyle",{mathcolor:"blue"},[t("msup",null,[t("mn",null,"2"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mo",null,"−"),t("mn",null,"3")])])])])],-1))]),l[57]||(l[57]=Q("，")),l[58]||(l[58]=t("strong",null,"表达不了",-1)),t("mjx-container",v,[(a(),e("svg",Z,l[49]||(l[49]=[T("",1)]))),l[50]||(l[50]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mstyle",{mathcolor:"blue"},[t("msup",null,[t("mn",null,"2"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mo",null,"−"),t("mn",null,"14")])])])])],-1))])]),l[59]||(l[59]=t("li",null,[t("strong",null,"梯度消失了"),Q("‼️")],-1))])])])]),l[67]||(l[67]=t("li",null,[Q("解法 "),t("ul",null,[t("li",null,[t("code",null,"动态损失缩放"),Q("(Dynamic Loss Scaling)")]),t("li",null,[t("code",null,"混合精度优化"),Q("(Mixed Precision Optimizer)等")])])],-1))]),l[70]||(l[70]=T("",2))]),l[222]||(l[222]=T("",13)),t("div",_,[l[104]||(l[104]=T("",6)),t("ul",null,[t("li",null,[l[79]||(l[79]=Q("背景 ")),t("ul",null,[l[78]||(l[78]=t("li",null,[Q("解决fp16带来的"),t("code",null,"梯度下溢出问题"),Q("，保留loss关键信息")],-1)),t("li",null,[l[73]||(l[73]=Q("训练")),l[74]||(l[74]=t("strong",null,"后期梯度特别小",-1)),l[75]||(l[75]=Q("：67%梯度 < ")),t("mjx-container",D,[(a(),e("svg",A,l[71]||(l[71]=[T("",1)]))),l[72]||(l[72]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msup",null,[t("mn",null,"2"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mo",null,"−"),t("mn",null,"24")])])])],-1))]),l[76]||(l[76]=Q("，")),l[77]||(l[77]=t("code",null,"如果用fp16，则全为0",-1))])])]),t("li",null,[l[94]||(l[94]=Q("方法 ")),t("ul",null,[l[93]||(l[93]=t("li",null,[t("strong",null,"对loss进行scale"),Q("，"),t("strong",null,"链式法则"),Q("原理，会传导到每个梯度，"),t("strong",null,"梯度平移到fp16区间"),Q("。")],-1)),t("li",null,[l[84]||(l[84]=t("code",null,"Scale UP",-1)),l[85]||(l[85]=Q("：")),t("strong",null,[l[82]||(l[82]=Q("loss增大")),t("mjx-container",P,[(a(),e("svg",S,l[80]||(l[80]=[T("",1)]))),l[81]||(l[81]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msup",null,[t("mn",null,"2"),t("mi",null,"k")])])],-1))]),l[83]||(l[83]=Q("倍"))]),l[86]||(l[86]=Q("；"))]),t("li",null,[l[91]||(l[91]=t("code",null,"Scale Down",-1)),l[92]||(l[92]=Q("：")),t("strong",null,[l[89]||(l[89]=Q("权重梯度缩小")),t("mjx-container",C,[(a(),e("svg",j,l[87]||(l[87]=[T("",1)]))),l[88]||(l[88]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msup",null,[t("mn",null,"2"),t("mi",null,"k")])])],-1))]),l[90]||(l[90]=Q("倍"))])])])]),t("li",null,[l[103]||(l[103]=t("strong",null,"Dynamic Loss Scale",-1)),t("ul",null,[t("li",null,[l[98]||(l[98]=t("strong",null,"前期",-1)),l[99]||(l[99]=Q("：使用")),t("strong",null,[l[97]||(l[97]=Q("大缩放因子")),t("mjx-container",B,[(a(),e("svg",E,l[95]||(l[95]=[T("",1)]))),l[96]||(l[96]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msup",null,[t("mn",null,"2"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mn",null,"24")])])])],-1))])]),l[100]||(l[100]=Q("，判断是否梯度溢出 ")),l[101]||(l[101]=t("ul",null,[t("li",null,"无梯度溢出：不调整缩放因子，继续迭代"),t("li",null,[t("strong",null,"有梯度溢出"),Q("："),t("strong",null,"缩放因子减半"),Q("，重新确认缩放因子情况，直到不溢出")])],-1))]),l[102]||(l[102]=t("li",null,[t("strong",null,"后期"),Q("：loss稳定、梯度幅度变小，可以使用更"),t("strong",null,"高缩放因子防止数据再次下溢"),Q("。")],-1))])])]),l[105]||(l[105]=T("",6))]),l[223]||(l[223]=T("",5)),t("div",R,[l[122]||(l[122]=t("div",{class:"custom-block-title"},"模型显存占用(混合梯度)",-1)),t("p",null,[l[108]||(l[108]=t("strong",null,"具体显存占用项",-1)),l[109]||(l[109]=Q(" (模型参数为m或")),t("mjx-container",I,[(a(),e("svg",z,l[106]||(l[106]=[t("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[t("g",{"data-mml-node":"math"},[t("g",{"data-mml-node":"mi"},[t("path",{"data-c":"3A8",d:"M340 622Q338 623 335 625T331 629T325 631T314 634T298 635T274 636T239 637H212V683H224Q248 680 389 680T554 683H566V637H539Q479 637 464 635T439 622L438 407Q438 192 439 192Q443 193 449 195T474 207T507 232T536 276T557 344Q560 365 562 417T573 493Q587 536 620 544Q627 546 671 546H715L722 540V515Q714 509 708 509Q680 505 671 476T658 392T644 307Q599 177 451 153L438 151V106L439 61Q446 54 451 52T476 48T539 46H566V0H554Q530 3 389 3T224 0H212V46H239Q259 46 273 46T298 47T314 48T325 51T331 54T335 57T340 61V151Q126 178 117 406Q115 503 69 509Q55 509 55 526Q55 541 59 543T86 546H107H120Q150 546 161 543T184 528Q198 514 204 493Q212 472 213 420T226 316T272 230Q287 216 303 207T330 194L339 192Q340 192 340 407V622Z",style:{"stroke-width":"3"}})])])],-1)]))),l[107]||(l[107]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",{mathvariant:"normal"},"Ψ")])],-1))]),l[110]||(l[110]=Q(")"))]),t("ul",null,[l[119]||(l[119]=T("",3)),t("li",null,[l[118]||(l[118]=t("p",null,[t("strong",null,"激活值"),Q("(Activation)")],-1)),t("ul",null,[l[116]||(l[116]=t("li",null,[Q("激活在训练中会"),t("code",null,"占用大量显存"),Q("‼️ "),t("ul",null,[t("li",null,[Q("可通过"),t("code",null,"激活checkpoint"),Q("或"),t("code",null,"重计算"),Q("来降低，但仍然很大。")])])],-1)),t("li",null,[l[113]||(l[113]=t("strong",null,"s序列长度，b是micro_batchsize",-1)),l[114]||(l[114]=Q("，h是hidden_size，a是attention头数，L是Transformer层数，")),t("mjx-container",N,[(a(),e("svg",O,l[111]||(l[111]=[t("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[t("g",{"data-mml-node":"math"},[t("g",{"data-mml-node":"mi"},[t("path",{"data-c":"1D6FE",d:"M31 249Q11 249 11 258Q11 275 26 304T66 365T129 418T206 441Q233 441 239 440Q287 429 318 386T371 255Q385 195 385 170Q385 166 386 166L398 193Q418 244 443 300T486 391T508 430Q510 431 524 431H537Q543 425 543 422Q543 418 522 378T463 251T391 71Q385 55 378 6T357 -100Q341 -165 330 -190T303 -216Q286 -216 286 -188Q286 -138 340 32L346 51L347 69Q348 79 348 100Q348 257 291 317Q251 355 196 355Q148 355 108 329T51 260Q49 251 47 251Q45 249 31 249Z",style:{"stroke-width":"3"}})])])],-1)]))),l[112]||(l[112]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"γ")])],-1))]),l[115]||(l[115]=Q("是系数，"))]),l[117]||(l[117]=t("li",null,[Q("Megatron及"),t("a",{href:"https://help.aliyun.com/zh/pai/getting-started/estimation-of-the-required-video-memory-for-the-model#a331f8d1ba95l",target:"_blank",rel:"noreferrer"},"阿里云计算公式"),Q("：")],-1))])])]),t("mjx-container",F,[(a(),e("svg",G,l[120]||(l[120]=[T("",1)]))),l[121]||(l[121]=t("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[t("mstyle",{mathcolor:"blue"},[t("mtable",{columnalign:"left",columnspacing:"1em",rowspacing:"4pt"},[t("mtr",null,[t("mtd",null,[t("mtext",null,"activation 显存计算")]),t("mtd",null,[t("mo",null,"="),t("mi",null,"s"),t("mo",null,"∗"),t("mi",null,"b"),t("mo",null,"∗"),t("mi",null,"h"),t("mo",null,"∗"),t("mo",{stretchy:"false"},"("),t("mn",null,"34"),t("mo",null,"+"),t("mn",null,"5"),t("mo",null,"∗"),t("mi",null,"a"),t("mo",null,"∗"),t("mi",null,"s"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mo",null,"/")]),t("mi",null,"h"),t("mo",{stretchy:"false"},")"),t("mo",null,"∗"),t("mi",null,"L"),t("mo",null,"∗"),t("mi",null,"γ")])]),t("mtr",null,[t("mtd",null,[t("mtext",null,"激活缓存后显存计算")]),t("mtd",null,[t("mo",null,"="),t("mstyle",{mathcolor:"red"},[t("mi",null,"s"),t("mo",null,"∗"),t("mi",null,"b"),t("mo",null,"∗"),t("mi",null,"h"),t("mo",null,"∗"),t("mi",null,"L"),t("mo",null,"∗"),t("mi",{mathvariant:"normal"},"精"),t("mi",{mathvariant:"normal"},"度"),t("mstyle",{scriptlevel:"0"},[t("mspace",{width:"1em"})]),t("mo",{stretchy:"false"},"("),t("mi",{mathvariant:"normal"},"一"),t("mi",{mathvariant:"normal"},"般"),t("mi",{mathvariant:"normal"},"为"),t("mn",null,"2"),t("mo",{stretchy:"false"},")")])])])])])])],-1))]),l[123]||(l[123]=T("",3))]),l[224]||(l[224]=T("",8)),t("div",J,[l[208]||(l[208]=t("div",{class:"custom-block-title"},"ZeRO-DP",-1)),l[209]||(l[209]=t("p",null,[t("strong",null,"核心思想")],-1)),t("ul",null,[l[137]||(l[137]=t("li",null,[t("p",null,[Q("普通DDP模型，但"),t("strong",null,"每张卡只存一部分"),Q("优化器"),t("code",null,"状态os、梯度g、参数p"),Q("。")])],-1)),t("li",null,[t("p",null,[l[132]||(l[132]=Q("ZeRO-DP： ")),t("mjx-container",U,[(a(),e("svg",X,l[124]||(l[124]=[T("",1)]))),l[125]||(l[125]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mstyle",{mathcolor:"blue"},[t("msub",null,[t("mi",null,"P"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"o"),t("mi",null,"s")])]),t("mo",null,"+"),t("msub",null,[t("mi",null,"P"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"g")])]),t("mo",null,"+"),t("msub",null,[t("mi",null,"P"),t("mi",null,"p")])])])],-1))]),l[133]||(l[133]=Q(" 3种分片，")),t("mjx-container",q,[(a(),e("svg",$,l[126]||(l[126]=[T("",1)]))),l[127]||(l[127]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"P"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"o"),t("mi",null,"s")])])])],-1))]),l[134]||(l[134]=Q("对应ZeRO-1，")),t("mjx-container",W,[(a(),e("svg",K,l[128]||(l[128]=[T("",1)]))),l[129]||(l[129]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"P"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"o"),t("mi",null,"s"),t("mo",null,"+"),t("mi",null,"g")])])])],-1))]),l[135]||(l[135]=Q("对应ZeRO-2，")),t("mjx-container",Y,[(a(),e("svg",t1,l[130]||(l[130]=[T("",1)]))),l[131]||(l[131]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"P"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"o"),t("mi",null,"s"),t("mo",null,"+"),t("mi",null,"g"),t("mo",null,"+"),t("mi",null,"p")])])])],-1))]),l[136]||(l[136]=Q("对应ZeRO3。"))])])]),t("p",null,[t("strong",null,[l[140]||(l[140]=Q("ZeRO1：+优化器状态划分 ")),t("mjx-container",l1,[(a(),e("svg",Q1,l[138]||(l[138]=[T("",1)]))),l[139]||(l[139]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"P"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"o"),t("mi",null,"s")])])])],-1))])])]),t("ul",null,[t("li",null,[l[157]||(l[157]=Q("核心思想 ")),t("ul",null,[t("li",null,[l[145]||(l[145]=t("code",null,"对优化器状态os做划分",-1)),l[146]||(l[146]=Q("，")),t("strong",null,[l[143]||(l[143]=Q("每卡只持有")),t("mjx-container",T1,[(a(),e("svg",e1,l[141]||(l[141]=[T("",1)]))),l[142]||(l[142]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mfrac",null,[t("mn",null,"1"),t("mi",null,"N")])])],-1))]),l[144]||(l[144]=Q("的os"))]),l[147]||(l[147]=Q("，g和p存完整。"))]),t("li",null,[l[152]||(l[152]=Q("每卡")),t("strong",null,[l[150]||(l[150]=Q("仅更新")),t("mjx-container",a1,[(a(),e("svg",s1,l[148]||(l[148]=[T("",1)]))),l[149]||(l[149]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mfrac",null,[t("mn",null,"1"),t("mi",null,"N")])])],-1))]),l[151]||(l[151]=Q("参数"))]),l[153]||(l[153]=Q("，并")),l[154]||(l[154]=t("strong",null,"广播告知",-1)),l[155]||(l[155]=Q("新参数"))]),l[156]||(l[156]=T("",2))])]),t("li",null,[l[164]||(l[164]=Q("显存占用 ")),t("ul",null,[t("li",null,[l[160]||(l[160]=t("code",null,"4m+12m",-1)),l[161]||(l[161]=Q(" -> ")),t("strong",null,[t("mjx-container",o1,[(a(),e("svg",n1,l[158]||(l[158]=[T("",1)]))),l[159]||(l[159]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mn",null,"4"),t("mi",null,"m"),t("mo",null,"+"),t("mfrac",null,[t("mrow",null,[t("mn",null,"12"),t("mi",null,"m")]),t("mi",null,"N")]),t("mo",null,"≈"),t("mn",null,"4"),t("mi",null,"m")])],-1))])]),l[162]||(l[162]=Q("，为标准的")),l[163]||(l[163]=t("code",null,"1/4",-1))])])])]),t("p",null,[t("strong",null,[l[167]||(l[167]=Q("ZeRO2：+梯度划分 ")),t("mjx-container",r1,[(a(),e("svg",i1,l[165]||(l[165]=[T("",1)]))),l[166]||(l[166]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"P"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"g")])])])],-1))])])]),t("ul",null,[t("li",null,[l[180]||(l[180]=Q("核心思想 ")),t("ul",null,[t("li",null,[l[172]||(l[172]=Q("优化器os已划分；")),l[173]||(l[173]=t("code",null,"对梯度g做划分",-1)),l[174]||(l[174]=Q("，每卡")),t("strong",null,[l[170]||(l[170]=Q("持有")),t("mjx-container",d1,[(a(),e("svg",m1,l[168]||(l[168]=[T("",1)]))),l[169]||(l[169]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mfrac",null,[t("mn",null,"1"),t("mi",null,"N")])])],-1))]),l[171]||(l[171]=Q("梯度"))])]),t("li",null,[l[177]||(l[177]=Q("各卡单独更新")),t("mjx-container",p1,[(a(),e("svg",g1,l[175]||(l[175]=[T("",1)]))),l[176]||(l[176]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mfrac",null,[t("mn",null,"1"),t("mi",null,"N")])])],-1))]),l[178]||(l[178]=Q("参数，并广播告知。"))]),l[179]||(l[179]=t("li",null,"梯度reduce到各rank，无需allredcue，节省开销",-1))])]),t("li",null,[l[187]||(l[187]=Q("显存占用 ")),t("ul",null,[t("li",null,[l[183]||(l[183]=t("code",null,"4m+12m",-1)),l[184]||(l[184]=Q(" -> ")),t("strong",null,[t("mjx-container",u1,[(a(),e("svg",h1,l[181]||(l[181]=[T("",1)]))),l[182]||(l[182]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mn",null,"2"),t("mi",null,"m"),t("mo",null,"+"),t("mfrac",null,[t("mrow",null,[t("mn",null,"2"),t("mi",null,"m")]),t("mi",null,"N")]),t("mo",null,"+"),t("mfrac",null,[t("mrow",null,[t("mn",null,"12"),t("mi",null,"m")]),t("mi",null,"N")]),t("mo",null,"≈"),t("mn",null,"2"),t("mi",null,"m")])],-1))])]),l[185]||(l[185]=Q("，为标准的")),l[186]||(l[186]=t("code",null,"1/8",-1))])])])]),t("p",null,[t("strong",null,[l[190]||(l[190]=Q("ZeRO3：+参数划分 ")),t("mjx-container",x1,[(a(),e("svg",w1,l[188]||(l[188]=[T("",1)]))),l[189]||(l[189]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"P"),t("mi",null,"p")])])],-1))])])]),t("ul",null,[t("li",null,[l[200]||(l[200]=Q("核心思想 ")),t("ul",null,[t("li",null,[l[195]||(l[195]=Q("优化器os已切分；梯度g已切分；")),l[196]||(l[196]=t("code",null,"对参数p做切分",-1)),l[197]||(l[197]=Q("，每卡")),t("strong",null,[l[193]||(l[193]=Q("持有")),t("mjx-container",H1,[(a(),e("svg",f1,l[191]||(l[191]=[T("",1)]))),l[192]||(l[192]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mfrac",null,[t("mn",null,"1"),t("mi",null,"N")])])],-1))]),l[194]||(l[194]=Q("参数"))]),l[198]||(l[198]=Q("。"))]),l[199]||(l[199]=t("li",null,"确保能被单个GPU存放下",-1))])]),t("li",null,[l[207]||(l[207]=Q("显存占用 ")),t("ul",null,[t("li",null,[l[203]||(l[203]=t("code",null,"4m+12m",-1)),l[204]||(l[204]=Q(" -> ")),t("strong",null,[t("mjx-container",V1,[(a(),e("svg",L1,l[201]||(l[201]=[T("",1)]))),l[202]||(l[202]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mfrac",null,[t("mrow",null,[t("mn",null,"2"),t("mi",null,"m")]),t("mi",null,"N")]),t("mo",null,"+"),t("mfrac",null,[t("mrow",null,[t("mn",null,"2"),t("mi",null,"m")]),t("mi",null,"N")]),t("mo",null,"+"),t("mfrac",null,[t("mrow",null,[t("mn",null,"12"),t("mi",null,"m")]),t("mi",null,"N")]),t("mo",null,"="),t("mfrac",null,[t("mrow",null,[t("mn",null,"16"),t("mi",null,"m")]),t("mi",null,"N")])])],-1))])]),l[205]||(l[205]=Q("，N比较大时，")),l[206]||(l[206]=t("code",null,"趋近于0",-1))])])])])]),l[225]||(l[225]=t("img",{src:"https://wdndev.github.io/llm_interview_note/04.%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%AD%E7%BB%83/deepspeed%E4%BB%8B%E7%BB%8D/image/image_UKoVaOXc-2.png",style:{display:"block",margin:"auto"},width:"80%"},null,-1)),l[226]||(l[226]=t("h3",{id:"zero-offload-策略",tabindex:"-1"},[Q("Zero-Offload 策略 "),t("a",{class:"header-anchor",href:"#zero-offload-策略","aria-label":'Permalink to "Zero-Offload 策略"'},"​")],-1)),t("div",c1,[l[220]||(l[220]=T("",4)),t("ul",null,[l[219]||(l[219]=T("",3)),t("li",null,[l[218]||(l[218]=Q("多卡场景 ")),t("ul",null,[t("li",null,[l[212]||(l[212]=Q("利用ZeRO-2，把")),t("mjx-container",k1,[(a(),e("svg",y1,l[210]||(l[210]=[T("",1)]))),l[211]||(l[211]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mfrac",null,[t("mn",null,"1"),t("mi",null,"N")])])],-1))]),l[213]||(l[213]=Q("的优化器状态os和梯度p都offload到内存，在CPU上做参数更新"))]),t("li",null,[l[216]||(l[216]=Q("每张卡至少对应1个CPU进程，每个CPU进程只负责")),t("mjx-container",b1,[(a(),e("svg",M1,l[214]||(l[214]=[T("",1)]))),l[215]||(l[215]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mfrac",null,[t("mn",null,"1"),t("mi",null,"N")])])],-1))]),l[217]||(l[217]=Q("的计算。"))])])])])]),l[227]||(l[227]=t("img",{src:"https://pic4.zhimg.com/v2-b9f59b045c1629983fb3e94e692bc457_1440w.jpg",style:{display:"block",margin:"auto"},width:"80%"},null,-1)),l[228]||(l[228]=t("img",{src:"https://pic3.zhimg.com/v2-57ab3768637af499bda329bbecb1ce1a_1440w.jpg",style:{display:"block",margin:"auto"},width:"80%"},null,-1)),l[229]||(l[229]=t("img",{src:"https://pic1.zhimg.com/v2-fe50a06119ca19954e6fee767cafb028_1440w.jpg",style:{display:"block",margin:"auto"},width:"80%"},null,-1))])}const j1=s(o,[["render",v1]]);export{C1 as __pageData,j1 as default};

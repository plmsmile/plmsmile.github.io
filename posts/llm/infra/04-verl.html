<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Verl | ğŸ“š plmblog</title>
    <meta name="description" content="è®°å½•ä¸€äº›å­¦ä¹ ç¬”è®°ã€‚">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/assets/style.pkV7-7c2.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.Cf0bhsmK.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.D0qeWSAg.js">
    <link rel="modulepreload" href="/assets/chunks/framework.CvbyeFFO.js">
    <link rel="modulepreload" href="/assets/posts_llm_infra_04-verl.md.Bq6mdbhL.lean.js">
    <link rel="icon" href="/plm.png">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-cecb633e><!--[--><!--]--><!--[--><span tabindex="-1" data-v-c979f278></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-c979f278>Skip to content</a><!--]--><!----><header class="VPNav" data-v-cecb633e data-v-0ad68676><div class="VPNavBar" data-v-0ad68676 data-v-ce71e4ef><div class="wrapper" data-v-ce71e4ef><div class="container" data-v-ce71e4ef><div class="title" data-v-ce71e4ef><div class="VPNavBarTitle has-sidebar" data-v-ce71e4ef data-v-7e906684><a class="title" href="/" data-v-7e906684><!--[--><!--]--><!----><span data-v-7e906684>ğŸ“š plmblog</span><!--[--><!--]--></a></div></div><div class="content" data-v-ce71e4ef><div class="content-body" data-v-ce71e4ef><!--[--><!--]--><div class="VPNavBarSearch search" data-v-ce71e4ef><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-ce71e4ef data-v-e0cd9371><span id="main-nav-aria-label" class="visually-hidden" data-v-e0cd9371> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-e0cd9371 data-v-4aa19863><!--[--><span data-v-4aa19863>é¦–é¡µ</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-e0cd9371 data-v-ffaaba87><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-ffaaba87><span class="text" data-v-ffaaba87><!----><span data-v-ffaaba87>ğŸ²LLM</span><span class="vpi-chevron-down text-icon" data-v-ffaaba87></span></span></button><div class="menu" data-v-ffaaba87><div class="VPMenu" data-v-ffaaba87 data-v-798b97ca><div class="items" data-v-798b97ca><!--[--><!--[--><div class="VPMenuGroup" data-v-798b97ca data-v-a2651156><p class="title" data-v-a2651156>Basic</p><!--[--><!--[--><div class="VPMenuLink" data-v-a2651156 data-v-dc987abe><a class="VPLink link" href="/posts/llm/basic/01-lm-define-information-theory.html" data-v-dc987abe><!--[--><span data-v-dc987abe>ğŸ¦‹åŸºç¡€çŸ¥è¯†</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-a2651156 data-v-dc987abe><a class="VPLink link" href="/posts/llm/infra/01-parrallel.html" data-v-dc987abe><!--[--><span data-v-dc987abe>ğŸ› åŸºå»ºæ¡†æ¶</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-798b97ca data-v-a2651156><p class="title" data-v-a2651156>å¼ºåŒ–å­¦ä¹ </p><!--[--><!--[--><div class="VPMenuLink" data-v-a2651156 data-v-dc987abe><a class="VPLink link" href="/posts/llm/rl/theory/01-reinforce-learning.html" data-v-dc987abe><!--[--><span data-v-dc987abe>ğŸ“RLç†è®ºåŸºç¡€</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-a2651156 data-v-dc987abe><a class="VPLink link" href="/posts/llm/rl/rlhf.html" data-v-dc987abe><!--[--><span data-v-dc987abe>ğŸš˜RLHF</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-a2651156 data-v-dc987abe><a class="VPLink link" href="/posts/llm/rl/o1llm.html" data-v-dc987abe><!--[--><span data-v-dc987abe>ğŸš¢æ¨ç†æ¨¡å‹</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-a2651156 data-v-dc987abe><a class="VPLink link" href="/posts/llm/agent/rl/02-agent-tool.html" data-v-dc987abe><!--[--><span data-v-dc987abe>ğŸš„Agent-RL</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-798b97ca data-v-a2651156><p class="title" data-v-a2651156>Agent</p><!--[--><!--[--><div class="VPMenuLink" data-v-a2651156 data-v-dc987abe><a class="VPLink link" href="/posts/llm/agent/basic.html" data-v-dc987abe><!--[--><span data-v-dc987abe>ğŸ¤–æ¦‚å¿µåŠåº”ç”¨</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-798b97ca data-v-a2651156><p class="title" data-v-a2651156>è¡Œä¸šæ–¹å‘</p><!--[--><!--[--><div class="VPMenuLink" data-v-a2651156 data-v-dc987abe><a class="VPLink link" href="/posts/llm/industry/mainllm/01-kimi-series.html" data-v-dc987abe><!--[--><span data-v-dc987abe>ğŸš€ä¸»æµæ¨¡å‹</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-e0cd9371 data-v-ffaaba87><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-ffaaba87><span class="text" data-v-ffaaba87><!----><span data-v-ffaaba87>ğŸ“™æ—§æ–‡ç« </span><span class="vpi-chevron-down text-icon" data-v-ffaaba87></span></span></button><div class="menu" data-v-ffaaba87><div class="VPMenu" data-v-ffaaba87 data-v-798b97ca><div class="items" data-v-798b97ca><!--[--><!--[--><div class="VPMenuGroup" data-v-798b97ca data-v-a2651156><p class="title" data-v-a2651156>ğŸ“NLP</p><!--[--><!--[--><div class="VPMenuLink" data-v-a2651156 data-v-dc987abe><a class="VPLink link" href="/posts/olds/nlp.html" data-v-dc987abe><!--[--><span data-v-dc987abe>è‡ªç„¶è¯­è¨€å¤„ç†</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-798b97ca data-v-a2651156><p class="title" data-v-a2651156>ğŸ‘åŸºç¡€çŸ¥è¯†</p><!--[--><!--[--><div class="VPMenuLink" data-v-a2651156 data-v-dc987abe><a class="VPLink link" href="/posts/olds/dl.html" data-v-dc987abe><!--[--><span data-v-dc987abe>æ·±åº¦å­¦ä¹ </span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-a2651156 data-v-dc987abe><a class="VPLink link" href="/posts/olds/rl.html" data-v-dc987abe><!--[--><span data-v-dc987abe>å¼ºåŒ–å­¦ä¹ </span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-a2651156 data-v-dc987abe><a class="VPLink link" href="/posts/olds/ml.html" data-v-dc987abe><!--[--><span data-v-dc987abe>æœºå™¨å­¦ä¹ </span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-798b97ca data-v-a2651156><p class="title" data-v-a2651156>ğŸç®—æ³•</p><!--[--><!--[--><div class="VPMenuLink" data-v-a2651156 data-v-dc987abe><a class="VPLink link" href="/posts/olds/algo/" data-v-dc987abe><!--[--><span data-v-dc987abe>ç®—æ³•é¢˜</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-a2651156 data-v-dc987abe><a class="VPLink link" href="/posts/olds/bigdata/" data-v-dc987abe><!--[--><span data-v-dc987abe>å¤§æ•°æ®</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-798b97ca data-v-a2651156><p class="title" data-v-a2651156>ğŸ’å…¶ä»–</p><!--[--><!--[--><div class="VPMenuLink" data-v-a2651156 data-v-dc987abe><a class="VPLink link" href="/posts/olds/env/" data-v-dc987abe><!--[--><span data-v-dc987abe>ç¯å¢ƒæ­å»º</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-a2651156 data-v-dc987abe><a class="VPLink link" href="/posts/olds/other/" data-v-dc987abe><!--[--><span data-v-dc987abe>å…¶ä»–</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-e0cd9371 data-v-ffaaba87><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-ffaaba87><span class="text" data-v-ffaaba87><!----><span data-v-ffaaba87>ç»éªŒ</span><span class="vpi-chevron-down text-icon" data-v-ffaaba87></span></span></button><div class="menu" data-v-ffaaba87><div class="VPMenu" data-v-ffaaba87 data-v-798b97ca><div class="items" data-v-798b97ca><!--[--><!--[--><div class="VPMenuGroup" data-v-798b97ca data-v-a2651156><p class="title" data-v-a2651156>ç¯å¢ƒ</p><!--[--><!--[--><div class="VPMenuLink" data-v-a2651156 data-v-dc987abe><a class="VPLink link" href="/posts/exps/env/01-blog-env.html" data-v-dc987abe><!--[--><span data-v-dc987abe>ç¯å¢ƒæ­å»º</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-798b97ca data-v-a2651156><p class="title" data-v-a2651156>å¿ƒå¾—</p><!--[--><!--[--><div class="VPMenuLink" data-v-a2651156 data-v-dc987abe><a class="VPLink link" href="/posts/exps/mind.html" data-v-dc987abe><!--[--><span data-v-dc987abe>å¿ƒå¾—ä½“ä¼š</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/posts/archive.html" tabindex="0" data-v-e0cd9371 data-v-4aa19863><!--[--><span data-v-4aa19863>å½’æ¡£</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/posts/me.html" tabindex="0" data-v-e0cd9371 data-v-4aa19863><!--[--><span data-v-4aa19863>å…³äºæˆ‘</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-ce71e4ef data-v-b59ebfac><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-b59ebfac data-v-809b7594 data-v-3591f5e2><span class="check" data-v-3591f5e2><span class="icon" data-v-3591f5e2><!--[--><span class="vpi-sun sun" data-v-809b7594></span><span class="vpi-moon moon" data-v-809b7594></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-ce71e4ef data-v-e0f2db57 data-v-7a4bfff1><!--[--><a class="VPSocialLink no-icon" href="https://github.com/plmsmile" aria-label="github" target="_blank" rel="noopener" data-v-7a4bfff1 data-v-8e5dce54><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-ce71e4ef data-v-8897e953 data-v-ffaaba87><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-ffaaba87><span class="vpi-more-horizontal icon" data-v-ffaaba87></span></button><div class="menu" data-v-ffaaba87><div class="VPMenu" data-v-ffaaba87 data-v-798b97ca><!----><!--[--><!--[--><!----><div class="group" data-v-8897e953><div class="item appearance" data-v-8897e953><p class="label" data-v-8897e953>Appearance</p><div class="appearance-action" data-v-8897e953><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-8897e953 data-v-809b7594 data-v-3591f5e2><span class="check" data-v-3591f5e2><span class="icon" data-v-3591f5e2><!--[--><span class="vpi-sun sun" data-v-809b7594></span><span class="vpi-moon moon" data-v-809b7594></span><!--]--></span></span></button></div></div></div><div class="group" data-v-8897e953><div class="item social-links" data-v-8897e953><div class="VPSocialLinks social-links-list" data-v-8897e953 data-v-7a4bfff1><!--[--><a class="VPSocialLink no-icon" href="https://github.com/plmsmile" aria-label="github" target="_blank" rel="noopener" data-v-7a4bfff1 data-v-8e5dce54><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-ce71e4ef data-v-37e0f734><span class="container" data-v-37e0f734><span class="top" data-v-37e0f734></span><span class="middle" data-v-37e0f734></span><span class="bottom" data-v-37e0f734></span></span></button></div></div></div></div><div class="divider" data-v-ce71e4ef><div class="divider-line" data-v-ce71e4ef></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-cecb633e data-v-1b409c8b><div class="container" data-v-1b409c8b><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-1b409c8b><span class="vpi-align-left menu-icon" data-v-1b409c8b></span><span class="menu-text" data-v-1b409c8b>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-1b409c8b data-v-a203161a><button data-v-a203161a>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-cecb633e data-v-18f7b5ca><div class="curtain" data-v-18f7b5ca></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-18f7b5ca><span class="visually-hidden" id="sidebar-aria-label" data-v-18f7b5ca> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-7f5b9a39><section class="VPSidebarItem level-0 has-active" data-v-7f5b9a39 data-v-a4affe07><div class="item" role="button" tabindex="0" data-v-a4affe07><div class="indicator" data-v-a4affe07></div><h2 class="text" data-v-a4affe07>ğŸ› LLM-åŸºå»ºæ¡†æ¶</h2><!----></div><div class="items" data-v-a4affe07><!--[--><div class="VPSidebarItem level-1 is-link" data-v-a4affe07 data-v-a4affe07><div class="item" data-v-a4affe07><div class="indicator" data-v-a4affe07></div><a class="VPLink link link" href="/posts/llm/infra/04-verl.html" data-v-a4affe07><!--[--><p class="text" data-v-a4affe07>Verl</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4affe07 data-v-a4affe07><div class="item" data-v-a4affe07><div class="indicator" data-v-a4affe07></div><a class="VPLink link link" href="/posts/llm/infra/03-inference-tech.html" data-v-a4affe07><!--[--><p class="text" data-v-a4affe07>æ¨ç†ä¼˜åŒ–æŠ€æœ¯</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4affe07 data-v-a4affe07><div class="item" data-v-a4affe07><div class="indicator" data-v-a4affe07></div><a class="VPLink link link" href="/posts/llm/infra/02-speed-framework.html" data-v-a4affe07><!--[--><p class="text" data-v-a4affe07>åˆ†å¸ƒå¼è®­ç»ƒæ¡†æ¶</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4affe07 data-v-a4affe07><div class="item" data-v-a4affe07><div class="indicator" data-v-a4affe07></div><a class="VPLink link link" href="/posts/llm/infra/01-parrallel.html" data-v-a4affe07><!--[--><p class="text" data-v-a4affe07>åˆ†å¸ƒå¼å¹¶è¡Œç­–ç•¥</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-cecb633e data-v-53a9cb18><div class="VPDoc has-sidebar has-aside" data-v-53a9cb18 data-v-5a64a79a><!--[--><!--]--><div class="container" data-v-5a64a79a><div class="aside" data-v-5a64a79a><div class="aside-curtain" data-v-5a64a79a></div><div class="aside-container" data-v-5a64a79a><div class="aside-content" data-v-5a64a79a><div class="VPDocAside" data-v-5a64a79a data-v-f8ea3c28><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-f8ea3c28 data-v-b94d89ac><div class="content" data-v-b94d89ac><div class="outline-marker" data-v-b94d89ac></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-b94d89ac>å½“å‰é¡µå¤§çº²</div><ul class="VPDocOutlineItem root" data-v-b94d89ac data-v-80b46526><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-f8ea3c28></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-5a64a79a><div class="content-container" data-v-5a64a79a><!--[--><!--[--><!--[--><article class="post-header" data-v-a99fd7c9><h1 class="title" data-v-a99fd7c9>Verl</h1><div class="stats-container" data-v-a99fd7c9><div class="stat-divider" data-v-a99fd7c9></div><div class="stat-item" data-v-a99fd7c9> ğŸ“… å‘è¡¨äº <span class="stat-text" data-v-a99fd7c9>2025/09/04</span></div><div class="stat-item" data-v-a99fd7c9> ğŸ”„ æ›´æ–°äº <span class="stat-text" data-v-a99fd7c9>2025/09/04</span></div><div class="stat-divider" data-v-a99fd7c9></div><div class="stat-item" data-v-a99fd7c9> ğŸ‘ï¸ <span class="stat-text" data-v-a99fd7c9>-- æ¬¡è®¿é—®</span><span id="busuanzi_value_page_pv" style="display:none;" data-page="/posts/llm/infra/04-verl.html" data-v-a99fd7c9></span></div><div class="stat-divider" data-v-a99fd7c9></div><div class="stat-item" data-v-a99fd7c9> ğŸ“ <span class="stat-text" data-v-a99fd7c9>0 å­—</span></div><div class="stat-divider" data-v-a99fd7c9></div><div class="stat-item" data-v-a99fd7c9> â³ <span class="stat-text" data-v-a99fd7c9>0 åˆ†é’Ÿ</span></div><div class="stat-divider" data-v-a99fd7c9></div></div><div class="tag-group" data-v-a99fd7c9><!--[--><div class="category-item" data-v-a99fd7c9>infra</div><!--]--><!--[--><div class="tag-item" data-v-a99fd7c9> #verl</div><div class="tag-item" data-v-a99fd7c9> #ray</div><div class="tag-item" data-v-a99fd7c9> #ray actor</div><div class="tag-item" data-v-a99fd7c9> #ray task</div><div class="tag-item" data-v-a99fd7c9> #hybrid flow</div><div class="tag-item" data-v-a99fd7c9> #æ§åˆ¶æµ</div><div class="tag-item" data-v-a99fd7c9> #è®¡ç®—æµ</div><div class="tag-item" data-v-a99fd7c9> #Single Controller</div><div class="tag-item" data-v-a99fd7c9> #Multi Controller</div><div class="tag-item" data-v-a99fd7c9> #è®­ç»ƒå¼•æ“</div><div class="tag-item" data-v-a99fd7c9> #æ¨ç†å¼•æ“</div><div class="tag-item" data-v-a99fd7c9> #fsdp</div><div class="tag-item" data-v-a99fd7c9> #æ¨¡å‹æ”¾ç½®ç­–ç•¥</div><div class="tag-item" data-v-a99fd7c9> #åˆ†ç»„æ”¾ç½®</div><div class="tag-item" data-v-a99fd7c9> #Hybrid Engine</div><div class="tag-item" data-v-a99fd7c9> #Colocate</div><div class="tag-item" data-v-a99fd7c9> #Worker</div><div class="tag-item" data-v-a99fd7c9> #WorkerDict</div><div class="tag-item" data-v-a99fd7c9> #WorkerGroup</div><div class="tag-item" data-v-a99fd7c9> #main_ppo.py</div><div class="tag-item" data-v-a99fd7c9> #ray_trainer.py</div><div class="tag-item" data-v-a99fd7c9> #core_algos.py</div><div class="tag-item" data-v-a99fd7c9> #fsdp_workers.py</div><div class="tag-item" data-v-a99fd7c9> #ActorRolloutRefWorker</div><div class="tag-item" data-v-a99fd7c9> #update_actor</div><div class="tag-item" data-v-a99fd7c9> #generate_sequences</div><div class="tag-item" data-v-a99fd7c9> #compute_log_prob</div><div class="tag-item" data-v-a99fd7c9> #compute_ref_log_prob</div><div class="tag-item" data-v-a99fd7c9> #CriticWorker</div><div class="tag-item" data-v-a99fd7c9> #compute_values</div><div class="tag-item" data-v-a99fd7c9> #update_critic</div><div class="tag-item" data-v-a99fd7c9> #RewardModelWorker</div><div class="tag-item" data-v-a99fd7c9> #compute_rm_score</div><!--]--></div></article><!--]--><!--]--><!--]--><main class="main" data-v-5a64a79a><div style="position:relative;" class="vp-doc _posts_llm_infra_04-verl" data-v-5a64a79a><div><h2 id="å‚è€ƒæ–‡ç« " tabindex="-1">å‚è€ƒæ–‡ç«  <a class="header-anchor" href="#å‚è€ƒæ–‡ç« " aria-label="Permalink to &quot;å‚è€ƒæ–‡ç« &quot;">â€‹</a></h2><ul><li><a href="https://zhuanlan.zhihu.com/p/27676081245" target="_blank" rel="noreferrer">[AI Infra] VeRL æ¡†æ¶å…¥é—¨&amp;ä»£ç å¸¦è¯»</a></li><li><a href="https://zhuanlan.zhihu.com/p/30876678559" target="_blank" rel="noreferrer">ä»é›¶å¼€å§‹çš„verlæ¡†æ¶è§£æ</a></li><li><a href="https://www.cnblogs.com/AikN/p/18893668" target="_blank" rel="noreferrer">å…¨ç½‘ç¬¬äºŒç»†è‡´çš„Verl GRPOå®ç°æ‹†è§£è®²è§£</a></li><li><a href="https://zhuanlan.zhihu.com/p/1903855264207200959" target="_blank" rel="noreferrer">TinyZeroæœ€è¯¦ç»†å¤ç°ç¬”è®°ï¼ˆäºŒï¼‰ï¼šVeRLæ¡†æ¶ä¸PPOè®­ç»ƒç»†èŠ‚</a></li></ul><h2 id="æ ¸å¿ƒæ¦‚å¿µ" tabindex="-1">æ ¸å¿ƒæ¦‚å¿µ <a class="header-anchor" href="#æ ¸å¿ƒæ¦‚å¿µ" aria-label="Permalink to &quot;æ ¸å¿ƒæ¦‚å¿µ&quot;">â€‹</a></h2><h3 id="é€šç”¨æ¦‚å¿µ" tabindex="-1">é€šç”¨æ¦‚å¿µ <a class="header-anchor" href="#é€šç”¨æ¦‚å¿µ" aria-label="Permalink to &quot;é€šç”¨æ¦‚å¿µ&quot;">â€‹</a></h3><h4 id="rl" tabindex="-1">RL <a class="header-anchor" href="#rl" aria-label="Permalink to &quot;RL&quot;">â€‹</a></h4><div class="custom-block tip"><div class="custom-block-title">RL</div><p><strong>æƒ©ç½šä¿¡å·</strong></p><p><strong>å½“å‰æ¨¡å‹ç”Ÿäº§æ ·æœ¬è®­ç»ƒè‡ªèº«</strong></p></div><h4 id="ray" tabindex="-1">Ray <a class="header-anchor" href="#ray" aria-label="Permalink to &quot;Ray&quot;">â€‹</a></h4><div class="custom-block tip"><div class="custom-block-title">Ray</div><p>åˆ†å¸ƒå¼è®­ç»ƒæ¡†æ¶ï¼Œç®¡ç†å¤æ‚çš„Rolesã€‚</p><p><strong>Ray Actor</strong></p><ul><li><strong>æœ‰çŠ¶æ€çš„</strong><code>è¿œç¨‹è®¡ç®—ä»»åŠ¡</code>ï¼Œè¿›ç¨‹ã€‚</li><li><code>ray.remote</code> è£…é¥°çš„<code>python class</code></li></ul><p><strong>Ray Task</strong></p><ul><li><strong>æ— çŠ¶æ€çš„</strong>è¿œç¨‹<strong>è®¡ç®—ä»»åŠ¡</strong>ï¼Œå±€éƒ¨å˜é‡ä»…å½“å‰å¯è§ï¼Œ<strong>å¯¹ä»»åŠ¡æäº¤è€…ä¸å¯è§</strong>ï¼Œ<code>æ— çŠ¶æ€</code></li><li>ray.remote è£…é¥°çš„python classï¼Œ</li></ul><p><strong>èµ„æºç®¡ç†</strong></p><ul><li>Rayå¯<code>è‡ªåŠ¨ç®¡ç†CPU/GPU/Memçš„åˆ†é…</code>ï¼Œæ¯”å¦‚<strong>æŒ‡å®šactoræ‰€éœ€èµ„æº</strong>ï¼›è®¾è®¡èµ„æºç»„ç­‰ã€‚</li><li>é€šè¿‡Rayå®ç°<strong>å„ç§è§’è‰²</strong>ã€<strong>å¹¶è¡Œç­–ç•¥</strong>çš„<code>èµ„æºåˆ†é…</code>ï¼Œå®ç°<code>Hybrid Engine</code>ç­‰<code>colocateç­–ç•¥</code>ã€‚</li></ul><p><strong>å¼‚æ­¥æ‰§è¡Œ</strong></p><ul><li><strong>ray å¼‚æ­¥è®¡ç®—</strong><ul><li>æ‰§è¡Œä¸€ä¸ªrayè®¡ç®—ä»»åŠ¡åï¼Œç«‹åˆ»è¿”å›ä»»åŠ¡çš„æ‰§è¡Œå¥æŸ„ï¼Œ<code>ç”¨æˆ·ä»£ç ä¸ä¼šé˜»å¡</code></li><li>é€šè¿‡<code>ray.get/ray.wait</code>è¿›è¡Œé˜»å¡å¼/è½®è®­å¼çš„ç»“æœè·å–</li></ul></li><li><strong>RL å¼‚æ­¥</strong><ul><li>æ–¹ä¾¿<strong>actor/critic/generator/rmä¹‹é—´</strong>ï¼Œ<code>overlapä¸€äº›æ—¶é—´</code>ï¼Œ <ul><li>å¦‚ï¼šactoræ›´æ–°ä¸Šä¸€ä¸ªbatchæ—¶ï¼Œgeneratorå·²ç»å¯ç”Ÿæˆä¸‹ä¸€ä¸ªbatchäº†</li></ul></li></ul></li></ul></div><h4 id="å¹¶è¡Œç­–ç•¥" tabindex="-1">å¹¶è¡Œç­–ç•¥ <a class="header-anchor" href="#å¹¶è¡Œç­–ç•¥" aria-label="Permalink to &quot;å¹¶è¡Œç­–ç•¥&quot;">â€‹</a></h4><div class="custom-block tip"><div class="custom-block-title">å¹¶è¡Œç­–ç•¥</div><p><strong>3D å¹¶è¡Œ</strong></p><ul><li><a href="https://plmsmile.github.io/posts/llm/infra/01-parrallel.html#%E6%95%B0%E6%8D%AE%E5%B9%B6%E8%A1%8C" target="_blank" rel="noreferrer">æ•°æ®å¹¶è¡ŒDP</a>ã€<a href="https://plmsmile.github.io/posts/llm/infra/01-parrallel.html#%E6%A8%A1%E5%9E%8B-%E6%B5%81%E6%B0%B4%E7%BA%BF%E5%B9%B6%E8%A1%8C-%E5%B1%82%E9%97%B4%E5%B9%B6%E8%A1%8C" target="_blank" rel="noreferrer">æµæ°´çº¿å¹¶è¡ŒPP</a>ã€<a href="https://plmsmile.github.io/posts/llm/infra/01-parrallel.html#%E6%A8%A1%E5%9E%8B-%E6%B5%81%E6%B0%B4%E7%BA%BF%E5%B9%B6%E8%A1%8C-%E5%B1%82%E9%97%B4%E5%B9%B6%E8%A1%8C" target="_blank" rel="noreferrer">å¼ é‡å¹¶è¡ŒTP</a>ï¼Œ<a href="https://plmsmile.github.io/posts/llm/infra/01-parrallel.html#_3d-%E5%B9%B6%E8%A1%8C-dp-pp-tp" target="_blank" rel="noreferrer">æ··åˆ3Då¹¶è¡Œ</a></li><li><strong>ä¸åŒè§’è‰²</strong>åœ¨<strong>ä¸åŒé˜¶æ®µ</strong>çš„<code>3Då¹¶è¡Œç­–ç•¥ä¼šå˜åŒ–</code><ul><li>hybrid engineåšäº†å¾ˆå¤šä¼˜åŒ–ï¼Œå¦‚<code>é›¶å†—ä½™çš„æ¨¡å‹å‚æ•°re-sharding</code></li></ul></li></ul><p><a href="https://plmsmile.github.io/posts/llm/infra/01-parrallel.html#%E5%AE%8C%E5%85%A8%E5%88%86%E7%89%87%E6%95%B0%E6%8D%AE%E5%B9%B6%E8%A1%8C-pytorch-fsdp" target="_blank" rel="noreferrer">FSDP</a></p><ul><li><p>æŠŠ<strong>æ¨¡å‹å‚æ•°(æƒé‡/ä¼˜åŒ–å™¨çŠ¶æ€ç­‰)</strong> åœ¨GPUä¹‹é—´<code>åˆ†ç‰‡å­˜å‚¨</code></p><ul><li>ä»…å½“æŸä¸ªGPUéœ€è¦å…¶ä»–GPUå‚æ•°æ—¶æ‰è¿›è¡Œé€šä¿¡ã€‚</li></ul></li><li><p>FPSDPï¼Œç®€å•ã€é€»è¾‘æ¸…æ™°ï¼Œresearchå‹å¥½ï¼›Megatronï¼šå¤§æ¨¡å‹æ›´å¥½</p></li><li><p>VerlåŒæ—¶æ”¯æŒmegatronå’ŒFSDP</p></li></ul></div><h3 id="verl-æ¦‚å¿µ" tabindex="-1">Verl æ¦‚å¿µ <a class="header-anchor" href="#verl-æ¦‚å¿µ" aria-label="Permalink to &quot;Verl æ¦‚å¿µ&quot;">â€‹</a></h3><h4 id="hybrid-flow" tabindex="-1">Hybrid Flow <a class="header-anchor" href="#hybrid-flow" aria-label="Permalink to &quot;Hybrid Flow&quot;">â€‹</a></h4><div class="custom-block tip"><div class="custom-block-title">Hybrid Flow</div><p><strong>æ ¸å¿ƒæ€æƒ³</strong></p><ul><li>RLæ¶‰åŠ<strong>å¤šä¸ªæ¨¡å‹äº¤äº’åä½œ</strong>ï¼ŒVerlè®¾è®¡<code>ä¸¤å±‚HybridFlow</code>ï¼Œå¯¹<code>è®­ç»ƒdataflow</code>è¿›è¡Œ<strong>è§£è€¦</strong></li></ul><p><strong>HyBrid Flow</strong></p><ul><li><strong>æ§åˆ¶æµ</strong>ï¼šhigh-levelï¼Œæè¿°<code>å¤šä¸ªè§’è‰²ä¹‹é—´çš„äº¤äº’é€»è¾‘</code><ul><li>å¦‚ï¼š<code>actoré‡‡æ ·</code>ï¼Œ<code>Critic/RM/Refernceå¼€å§‹è®¡ç®—åˆ†æ•°</code>ï¼Œå®Œæˆå<code>è®¡ç®—GAEå’Œloss</code>ç­‰</li></ul></li><li><strong>è®¡ç®—æµ</strong>ï¼šlow-levelï¼Œæè¿°<code>å•ä¸ªè§’è‰²å†…éƒ¨çš„è®¡ç®—æµç¨‹</code>ï¼Œç®¡ç†æ¨¡å‹è®­ç»ƒå’Œæ¨ç†å…·ä½“è¿‡ç¨‹ <ul><li>å¦‚ï¼šå‰å‘ã€åå‘ä¼ æ’­ã€ä¼˜åŒ–å™¨æ›´æ–°ã€è‡ªå›å½’ç”Ÿæˆç­‰ã€‚</li></ul></li></ul></div><h4 id="å•æ§åˆ¶å™¨vså¤šæ§åˆ¶å™¨" tabindex="-1">å•æ§åˆ¶å™¨vså¤šæ§åˆ¶å™¨ <a class="header-anchor" href="#å•æ§åˆ¶å™¨vså¤šæ§åˆ¶å™¨" aria-label="Permalink to &quot;å•æ§åˆ¶å™¨vså¤šæ§åˆ¶å™¨&quot;">â€‹</a></h4><div class="custom-block tip"><div class="custom-block-title">Single Controller vs Multiple Controller ä¸¤ç§è®¾è®¡æ¨¡å¼</div><p><strong>Single Controller</strong></p><ul><li>æ ¸å¿ƒï¼šä½¿ç”¨<strong>1ä¸ªä¸­å¤®æ§åˆ¶å™¨</strong>æ¥<code>ç»Ÿä¸€ç®¡ç†æ‰€æœ‰å­æ¨¡å—</code></li><li>ä¼˜ç‚¹ï¼šæ¶æ„æ¸…æ™°ã€å®¹æ˜“ç†è§£</li><li>VeRLï¼š<code>æ§åˆ¶æµ</code>ï¼Œ <code>Single Controller</code><ul><li>æ˜“äºæ–°ç®—æ³•å¼€å‘</li></ul></li></ul><p><strong>Multiple Controller</strong></p><ul><li>æ ¸å¿ƒï¼šæŠŠæ§åˆ¶é€»è¾‘<code>åˆ†æ•£åˆ°å¤šä¸ªæ§åˆ¶å™¨</code>ï¼Œ<strong>æ¯ä¸ª</strong>æ§åˆ¶å™¨<strong>è´Ÿè´£ç‰¹å®šæ¨¡å—</strong>ï¼›</li><li>ä¼˜ç‚¹ï¼š<code>ç¼“è§£å•ä¸€æ§åˆ¶å™¨é€šä¿¡å¼€é”€è¿‡å¤§çš„é—®é¢˜</code>ï¼›<strong>é›†åˆé€šä¿¡</strong>å®ç°å„è§’è‰²çš„åŒæ­¥æ§åˆ¶</li><li>VeRLï¼š<code>è®¡ç®—æµ</code>, <code>Multi Controller </code><ul><li>é€šè¿‡<strong>å¤šå±‚çº§Worker</strong>æ¥å®ç°è®¡ç®—æµMultiController <ul><li><code>RayWorkerGroup</code> -&gt; <code>WorkerDict</code> -&gt; <code>MOdelWorker</code> -&gt; <code>ParallelWorker</code></li></ul></li></ul></li><li>ä¸šç•Œä¸»æµè®­ç»ƒæ¨ç†å¼•æ“ï¼Œ<strong>å¤šæ˜¯åŸºäºå¤šæ§åˆ¶å™¨</strong>ã€‚ <ul><li>è®­ç»ƒå¼•æ“ï¼šFSDPã€Megatronç­‰</li><li>æ¨ç†å¼•æ“ï¼šä¹Ÿæœ‰è®¡åˆ’é€æ¸é€‚é…è¯¥æ¨¡å¼ï¼Œå¦‚vLLMã€sglangç­‰ã€‚</li></ul></li></ul></div><p>SingleController æ¥å®ç°RLç®—æ³•çš„æ§åˆ¶æµ</p><img src="https://pic4.zhimg.com/v2-de9366509e855360582c1b8c5814334d_1440w.jpg" style="display:block;margin:auto;" width="70%"><h4 id="è®­ç»ƒæ¨ç†-æ¨¡å‹æ”¾ç½®ç­–ç•¥" tabindex="-1">è®­ç»ƒæ¨ç†/æ¨¡å‹æ”¾ç½®ç­–ç•¥ <a class="header-anchor" href="#è®­ç»ƒæ¨ç†-æ¨¡å‹æ”¾ç½®ç­–ç•¥" aria-label="Permalink to &quot;è®­ç»ƒæ¨ç†/æ¨¡å‹æ”¾ç½®ç­–ç•¥&quot;">â€‹</a></h4><div class="custom-block tip"><div class="custom-block-title">è®­ç»ƒå¼•æ“ vs æ¨ç†å¼•æ“</div><p><strong>è®­ç»ƒå¼•æ“</strong></p><ul><li>è®­ç»ƒï¼š<code>Actorã€Criticè®­ç»ƒ</code></li></ul><p><strong>æ¨ç†å¼•æ“</strong></p><ul><li><p>æ¨ç†ï¼š<code>Generatorç”Ÿæˆæ ·æœ¬</code>ï¼›</p></li><li><p>ä»…æ¶‰åŠ<code>å‰å‘è¿‡ç¨‹</code>ï¼Œä¹Ÿä¼šä½¿ç”¨è®­ç»ƒå¼•æ“</p><ul><li><p><code>Critic/RM/Reference</code> æ‰“åˆ†<code>è®¡ç®—ligitså’Œscore</code>ç­‰</p></li><li><p>å› ä¸ºè®­ç»ƒå¼•æ“ä¸€èˆ¬æ¯”æ¨ç†å¼•æ“ç²¾åº¦æ›´é«˜(å› ä¸ºkernal fusionåº•å±‚å› ç´ )</p></li></ul></li></ul></div><div class="custom-block tip"><div class="custom-block-title">æ¨¡å‹æ”¾ç½®ç­–ç•¥</div><p><strong>åˆ†å¼€æ”¾ç½®</strong></p><ul><li>æ€æƒ³ï¼š<code>æ‰€æœ‰è§’è‰²</code>æ”¾åœ¨<code>ä¸åŒè®¾å¤‡</code></li><li>ä¼˜ç‚¹ï¼š<strong>å¼‚æ­¥overlapæ‰§è¡Œæ—¶é—´</strong></li><li>ç¼ºç‚¹ï¼š<strong>GPU</strong>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä¼š<strong>ç©ºé—²</strong></li></ul><p><strong>åˆ†ç»„æ”¾ç½®</strong></p><ul><li>æ€æƒ³ï¼š<code>è§’è‰²åˆ†ç»„</code>ï¼Œ<code>æŒ‰ç»„åˆ†é…</code>åœ¨ç›¸åŒè®¾å¤‡ä¸Š</li><li>ä¼˜ç‚¹ï¼šå¯ä»¥<strong>overlapæ—¶é—´</strong>ï¼Œ<strong>å‡å°‘GPU Idelæ—¶é—´</strong></li><li>å¸¸è§åˆ†ç»„ï¼š <ul><li>åˆ†æ³•1ï¼šActor+Refï¼ŒCritc+RM, Generator å•ç‹¬ä¸€ç»„</li><li><strong>åˆ†æ³•2(Verlä¸»æµ)</strong>ï¼š<code>Actor+Generatorä¸€ç»„</code>ï¼Œ<code>å…¶ä½™å•ç‹¬æ”¾ç½®</code><ul><li>å› ä¸ºActorå’ŒGeneratorå‚æ•°éœ€è¦å®æ—¶åŒæ­¥</li></ul></li></ul></li></ul><p><strong>ä¸€èµ·æ”¾ç½®</strong></p><ul><li>æ€æƒ³ï¼š<code>æ‰€æœ‰è§’è‰²</code>æ”¾åœ¨<code>ç›¸åŒè®¾å¤‡ä¸Š</code></li><li>ä¼˜ç‚¹ï¼šGPUæ—¶é’Ÿè¢«å ç”¨</li><li>ç¼ºç‚¹ï¼šåªèƒ½ä¸²è¡Œæ‰§è¡Œ</li></ul></div><h4 id="hybrid-engine-workerdict-workergroup" tabindex="-1">Hybrid Engine/WorkerDict/WorkerGroup <a class="header-anchor" href="#hybrid-engine-workerdict-workergroup" aria-label="Permalink to &quot;Hybrid Engine/WorkerDict/WorkerGroup&quot;">â€‹</a></h4><div class="custom-block tip"><div class="custom-block-title">VeRL Hybrid Engine</div><p><strong>çµæ´»æ”¯æŒ</strong> <code>å„ç§æ¨¡å‹æ”¾ç½®ç­–ç•¥</code></p><ul><li>é€šè¿‡ResourcePoolæ”¯æŒ</li><li>ä»¥<strong>colocate</strong>ä¸ºä¸»ï¼šæŠŠ<strong>actor</strong>çš„<code>è®­ç»ƒå’Œæ¨ç†å¼•æ“</code> <code>æ”¾ç½®åœ¨ä¸€èµ·</code>ï¼Œ<strong>åŠ¨æ€åˆ‡æ¢è§’è‰²</strong><ul><li>colocate<strong>å…±åŒæ”¾ç½®</strong>ï¼šæŠŠä¸åŒåŠŸèƒ½æ¨¡å—è®¡ç®—å•å…ƒï¼Œ<strong>æ”¾åœ¨ä¸€ä¸ªè®¾å¤‡ä¸Šï¼Œæé«˜æ•ˆç‡</strong></li></ul></li></ul><p><strong>WorkerDict</strong></p><ul><li><p>Workerè¢«å°è£…è¿›<code>WorkerDict</code>ï¼Œå®ç°<code>Workerè§’è‰²çµæ´»åˆ‡æ¢</code></p><ul><li><strong>ä¸åŒè§’è‰²</strong>å¯æ”¾ç½®åœ¨<strong>ç›¸åŒè®¾å¤‡</strong>ä¸Šï¼Œé€šè¿‡rebindè¿›è¡Œè½¬æ¢ï¼Œé€šè¿‡reload/offloadæ¥åˆ‡æ¢å‚æ•°</li></ul></li><li><p><code>æ¯ä¸ªGPU</code>è°ƒåº¦<code>1ä¸ªWorkerDict</code>ï¼Œä¸»è¦æ–¹ä¾¿ray<strong>ç®¡ç†å’Œè§’è‰²åˆ‡æ¢</strong></p></li></ul><p><strong>WorkerGroup</strong></p><ul><li>å½“å‰<strong>colocateçš„RLè§’è‰²</strong>æ‰€å æ®è®¾å¤‡çš„<code>æ‰€æœ‰WorkerDict</code></li><li>WGç®¡ç†ä¸€ç»„è¿œç¨‹è¿è¡Œçš„workersï¼Œ<strong>colocateçš„RLè§’è‰²</strong>ä¾æ‰˜WorkerGroupç®¡ç† <ul><li><strong>ç»Ÿä¸€ç®¡ç†æ•°æ®</strong>reshardingã€<strong>ä»»åŠ¡æ‰§è¡Œ</strong>ç­‰åˆ†å¸ƒå¼é€»è¾‘</li></ul></li><li>WG ä½œä¸º SingleControllerå’Œworkersä¹‹é—´çš„ä¸­ä»‹ï¼ŒæŠŠworkeræ–¹æ³•ç»‘å®šåˆ°WGä¸Šã€‚</li></ul><p><strong>é«˜æ•ˆåˆ‡æ¢ç­–ç•¥ï¼šZero Redundancy Model Resharding</strong></p><ul><li>èƒŒæ™¯ï¼š<strong>workerå¯åŠ¨æ€åˆ‡æ¢è§’è‰²</strong>(<code>actor-&gt;generator</code>)ï¼Œ<code>éœ€ä¸åŒçš„å‚æ•°åˆ‡åˆ†é€»è¾‘</code>ã€‚</li><li>Verlè®¾è®¡äº†é«˜æ•ˆåˆ‡æ¢ç­–ç•¥</li></ul><p><strong>æ•°æ®ä¼ è¾“åè®®</strong></p><ul><li>èƒŒæ™¯ï¼š<strong>workerå¯åŠ¨æ€åˆ‡æ¢è§’è‰²</strong>(<code>actor-&gt;generator</code>)ï¼Œä¸º<strong>é€‚é…ä¸åŒè§’è‰²å’Œæ–¹æ³•æ‰€éœ€çš„æ•°æ®åˆ’åˆ†ç»†èŠ‚</strong><ul><li>å¦‚dpç»´åº¦åˆ‡åˆ†æ•°æ®ã€3dç»´åº¦åˆ‡åˆ†æ•°æ®ç­‰</li></ul></li><li>è®¾è®¡äº†<strong>ä¸€å¥—æ•°æ®ä¼ è¾“åè®®</strong>ï¼Œä¸»è¦åŒ…æ‹¬<code>æ•°æ®åˆ†å‘(Dispatch)</code>å’Œ<code>æ”¶é›†(Collect)</code></li></ul></div><p>HybridFlowæ”¯æŒçš„è®­æ¨å¹¶è¡Œç­–ç•¥ã€æƒé‡è½¬æ¢ç­–ç•¥ã€æ¨¡å‹æ”¾ç½®å’Œæ‰§è¡Œç­–ç•¥</p><img src="https://pica.zhimg.com/v2-89fa35748497c0961088732d169c967c_r.jpg" style="display:block;margin:auto;" width="70%"><h4 id="verl-è®­ç»ƒæ•°æ®æ‰§è¡Œæµç¨‹" tabindex="-1">Verl è®­ç»ƒæ•°æ®æ‰§è¡Œæµç¨‹ <a class="header-anchor" href="#verl-è®­ç»ƒæ•°æ®æ‰§è¡Œæµç¨‹" aria-label="Permalink to &quot;Verl è®­ç»ƒæ•°æ®æ‰§è¡Œæµç¨‹&quot;">â€‹</a></h4><div class="custom-block note"><div class="custom-block-title">è®­ç»ƒæ•°æ®æµç¨‹</div><p><strong>æ¦‚è§ˆ</strong></p><ul><li><p>verl æŠŠ<strong>æ•°æ®ä¼ è¾“+æ–¹æ³•æ‰§è¡Œ</strong>åè®®ï¼Œè®¾è®¡ä¸º<strong>pythonçš„è£…é¥°å™¨</strong></p><ul><li>é€šè¿‡<strong>å®šä¹‰decoratorç»‘å®š</strong>ç»™å„workerç±»çš„å…·ä½“æ–¹æ³•</li></ul></li><li><p>è¿™æ ·æ¯ä¸ª<strong>workergroupè°ƒç”¨workerdict</strong>æ—¶ï¼Œä¾¿å¯çŸ¥å¦‚ä½•åˆ†å‘å’Œæ”¶é›†æ•°æ®</p></li></ul><p><strong>å…·ä½“æµç¨‹</strong></p><ul><li>RayPPOTrainer å‘ RayWorkerGroup å‘èµ·æ–¹æ³•è°ƒç”¨</li><li>RayWorkerGroupå†…éƒ¨ <ul><li>å…ˆæ‰§è¡Œ<strong>æ•°æ®åˆ†å‘é€»è¾‘</strong></li><li>æ‰§è¡Œé€»è¾‘åˆ¤æ–­<strong>å“ªäº›workeréœ€è¦è¿è¡Œä»»åŠ¡</strong></li><li><strong>å¸¦æœ‰æ•°æ®çš„ä»»åŠ¡</strong>è¢«åˆ†å‘ç»™<strong>æŒ‡å®šçš„WorkerDicts</strong></li></ul></li><li>ä»»åŠ¡æ‰§è¡Œ <ul><li>æ¯ä¸ª<strong>WorkDict</strong>é€šè¿‡<strong>è¿œç¨‹æ‰§è¡Œæ¥å—å…¶ä»»åŠ¡</strong></li><li>å®Œæˆä»»åŠ¡åï¼Œ<strong>ç»“æœè¿”å›</strong>ç»™<strong>RayWorkerGroup</strong></li></ul></li><li>ç»“æœå¤„ç† <ul><li>ç»“æœé€šè¿‡<strong>æ”¶é›†é€»è¾‘</strong>è¿›è¡Œå¤„ç† collect protocol</li><li>æœ€ç»ˆï¼Œ<strong>å¤„ç†åçš„ç»“æœ</strong>è¿”å›ç»™<strong>RayPPOTrainer</strong></li></ul></li></ul></div><img src="https://picx.zhimg.com/v2-2032486619ff764030eb18e0b90181eb_r.jpg" style="display:block;margin:auto;" width="70%"><h2 id="ä»£ç æ¶æ„" tabindex="-1">ä»£ç æ¶æ„ <a class="header-anchor" href="#ä»£ç æ¶æ„" aria-label="Permalink to &quot;ä»£ç æ¶æ„&quot;">â€‹</a></h2><h3 id="trainer-ç»„ä»¶" tabindex="-1">Trainer ç»„ä»¶ <a class="header-anchor" href="#trainer-ç»„ä»¶" aria-label="Permalink to &quot;Trainer ç»„ä»¶&quot;">â€‹</a></h3><ul><li><a href="https://verl.readthedocs.io/en/latest/examples/config.html" target="_blank" rel="noreferrer">config explanation</a></li></ul><h4 id="main-ppo-py" tabindex="-1">main_ppo.py <a class="header-anchor" href="#main-ppo-py" aria-label="Permalink to &quot;main_ppo.py&quot;">â€‹</a></h4><div class="custom-block note"><div class="custom-block-title">main.py RL ç®—æ³•ä¸»å…¥å£</div><p><strong>é€‰æ‹©å¥–åŠ±å‡½æ•° (model or rule)</strong></p><ul><li>model-based or rule-based</li><li>RewardManager + ç”¨æˆ·è‡ªå®šä¹‰çš„reward_score</li></ul><p><strong>é€‰æ‹©è®­ç»ƒåç«¯ (FSDP or Megatron)</strong></p><ul><li>FSDPï¼šå­¦æœ¯ç•Œ</li><li>Megatronï¼šå·¥ä¸šç•Œï¼Œå¤§è§„æ¨¡è®­ç»ƒ</li></ul><p><strong>è°ƒç”¨RayPPOTrainer</strong></p><ul><li>è°ƒç”¨trainerçš„init_workersåˆå§‹åŒ–rlå„è§’è‰²çš„workergroup</li><li>è°ƒç”¨fitè¿›è¡Œè®­ç»ƒ</li></ul></div><h4 id="ray-trainer-py" tabindex="-1">ray_trainer.py <a class="header-anchor" href="#ray-trainer-py" aria-label="Permalink to &quot;ray_trainer.py&quot;">â€‹</a></h4><div class="custom-block note"><div class="custom-block-title">ray_trainer.py</div><p><strong>åˆå§‹åŒ–RLä¸­çš„å„ä¸ªRole</strong></p><ul><li>å¤šä¸ªè§’è‰²ï¼šActorã€Criticã€RMã€Refç­‰</li><li>å®šä¹‰å¥½å„æ¨¡å‹çš„è§’è‰²ã€resource_poolçš„å®šä¹‰åˆ†é…ã€workerdictå’Œworkergroupçš„åˆå§‹åŒ–å’Œåˆ†é…</li></ul><p><strong>WorkerGroup æœºåˆ¶å®ç° (æ¯ç±»colocate model group)</strong></p><ul><li><code>actor_rollout_wg</code>ï¼šactor/generatoräº’ç›¸åˆ‡æ¢çš„hybrid engine <ul><li>reload/offload paramsï¼Œreshardç­‰</li></ul></li><li><code>critic_wg</code>ï¼šæ”¯æŒcriticè§’è‰²</li><li><code>ref_policy_wg</code>ï¼šreferenceè§’è‰²ï¼ŒKL éœ€è¦</li><li><code>rm_wg</code>ï¼šRMï¼Œmodel based reward éœ€è¦</li><li>ç”± <code>init_workers</code> <strong>åˆå§‹åŒ–å„worker group</strong></li></ul><p><strong>ResourcePoolManager</strong></p><ul><li>èµ„æºæ± ç®¡ç†ï¼Œå°è£…rayçš„placement_groupï¼ŒæŒ‡å®šè§’è‰²åˆç†åˆ†é…åˆ°è®¾å¤‡ä¸Š</li></ul><p><strong>PPO loss ä¾èµ–çš„å‡½æ•°</strong></p><ul><li><code>apply_kl_penalty</code>ï¼štoken-level kl reward <ul><li><code>kl loss</code>, åœ¨<code>core_algos.py</code></li></ul></li><li><code>compute_advantage</code>ï¼šè®¡ç®—ä¼˜åŠ¿å‡½æ•°ï¼Œæ ¸å¿ƒåœ¨<code>core_algos.py</code></li><li><code>adv_esitmator</code>ï¼šæ”¯æŒPPO/GRPO/Reinforce++/Remaxç­‰ç®—æ³•ï¼ŒåŒºåˆ«ä¸»è¦åœ¨advantagesï¼Œæ ¸å¿ƒä¾ç„¶åœ¨core_algos.py</li></ul><p><strong>Timer/Metricså‡½æ•°ç­‰</strong></p><ul><li>metricè®¡ç®—å‡½æ•° compute_data_metrics, compute_timing_metrics</li><li>save/load æ–­ç‚¹ç»­è®­ã€ckptä¿å­˜ç­‰</li><li>validate é€»è¾‘ã€DPè´Ÿè½½å‡è¡¡é€»è¾‘ç­‰</li></ul><p><strong>Fit/Train loop</strong></p><ul><li><code>fit</code>ï¼šå®ç°RLçš„å®Œæ•´è®­ç»ƒæµç¨‹ï¼Œè°ƒç”¨å„workerè¿›è¡Œå®é™…è®¡ç®—</li></ul></div><h4 id="core-algos-py" tabindex="-1">core_algos.py <a class="header-anchor" href="#core-algos-py" aria-label="Permalink to &quot;core_algos.py&quot;">â€‹</a></h4><div class="custom-block tip"><div class="custom-block-title">core_algos.py</div><p><strong>å„ç§lossè®¡ç®—é€»è¾‘</strong></p><ul><li>policy loss, value loss, entropy loss, kl loss</li></ul><p><strong>å„ç§advantagesè®¡ç®—é€»è¾‘</strong></p><ul><li>å„rlç®—æ³•åŒºåˆ†åœ¨advantages estimator å¦‚ä½•å®ç°ï¼Œ</li></ul></div><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AdvantageEstimator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Enum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):		</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 	GAE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;gae&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    GRPO</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;grpo&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    REINFORCE_PLUS_PLUS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;reinforce_plus_plus&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    REINFORCE_PLUS_PLUS_BASELINE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;reinforce_plus_plus_baseline&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    REMAX</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;remax&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    RLOO</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;rloo&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    OPO</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;opo&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    GRPO_PASSK</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;grpo_passk&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    GPG</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;gpg&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="main-generator-py" tabindex="-1">main_generator.py <a class="header-anchor" href="#main-generator-py" aria-label="Permalink to &quot;main_generator.py&quot;">â€‹</a></h4><h4 id="main-eval-py" tabindex="-1">main_eval.py <a class="header-anchor" href="#main-eval-py" aria-label="Permalink to &quot;main_eval.py&quot;">â€‹</a></h4><h3 id="workers-ç»„ä»¶" tabindex="-1">Workers ç»„ä»¶ <a class="header-anchor" href="#workers-ç»„ä»¶" aria-label="Permalink to &quot;Workers ç»„ä»¶&quot;">â€‹</a></h3><p>workers æ–‡ä»¶å¤¹ å®šä¹‰äº† RLä¸­</p><ul><li>å„è§’è‰²çš„workerï¼Œhigh level, è´Ÿè´£æè¿°é€»è¾‘</li><li>å„è§’è‰²è®¡ç®—æ—¶å®é™…ä¾èµ–çš„workerï¼Œlow-levelï¼Œè´Ÿè´£æè¿°è¿ç®—</li></ul><h4 id="worker-å„è§’è‰²" tabindex="-1">worker å„è§’è‰² <a class="header-anchor" href="#worker-å„è§’è‰²" aria-label="Permalink to &quot;worker å„è§’è‰²&quot;">â€‹</a></h4><img src="https://pica.zhimg.com/v2-76d8a937ac3a2e7eabf7e039aaaad33e_1440w.jpg" style="display:block;margin:auto;" width="70%"><h4 id="fsdp-workers-py" tabindex="-1">fsdp_workers.py <a class="header-anchor" href="#fsdp-workers-py" aria-label="Permalink to &quot;fsdp_workers.py&quot;">â€‹</a></h4><p>å®šä¹‰RLè®­ç»ƒè¿‡ç¨‹ä¸­ç”¨åˆ°çš„ç›¸å…³Workerï¼ŒåŸºäºå®é™…è¿è¡Œçš„workerså°è£…çš„ã€‚</p><div class="custom-block info"><div class="custom-block-title">ActorRolloutRefWorker</div><p><strong>åŠŸèƒ½</strong></p><ul><li>å¯ä»¥<strong>å•ç‹¬</strong>ä½œä¸ºRLä¸­çš„<strong>Actor</strong>ã€<strong>Rollout</strong>ã€<strong>Reference</strong> (è´Ÿè´£æä¾›ref_log_probè®¡ç®—KL)</li><li>å¯ä»¥åŸºäºhybrid engineï¼Œ<strong>åŒæ—¶æ‰®æ¼”å¤šä¸ªè§’è‰²</strong>ï¼Œé€šè¿‡å‚æ•°è¿›è¡Œçµæ´»åˆ‡æ¢</li></ul><p><strong>å…³é”®æ–¹æ³•</strong></p><ul><li><strong>update_actor</strong></li><li><strong>generate_sequences</strong></li><li><strong>compute_log_prob</strong></li><li><strong>compute_ref_log_prob</strong></li></ul></div><p><strong>init_model</strong></p><ul><li>æ ¹æ®configæŒ‡å®šmodelç±»å‹ï¼Œåˆå§‹åŒ–å½“å‰worker</li></ul><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._is_actor:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    actor_cfg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> omega_conf_to_dataclass(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.config.actor)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.actor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DataParallelPPOActor(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">actor_cfg, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">actor_module</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.actor_module_fsdp, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">actor_optimizer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.actor_optimizer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>update_actor</strong></p><ul><li>åŸºäºActorçš„update_policyï¼Œè®¡ç®—losså¹¶æ›´æ–°Policyæ¨¡å‹</li><li>åŸºäºulysses_sharding_manageræ”¯æŒåºåˆ—å¹¶è¡Œçš„æ•°æ®å‰åå¤„ç†ï¼Œå®ç°åºåˆ—å¹¶è¡Œ</li></ul><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ulysses_sharding_manager.preprocess_data(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">metrics </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.actor.update_policy(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DataProto(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">meta_info</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;metrics&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: metrics})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ulysses_sharding_manager.postprocess_data(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">output)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>generate_sequences</strong></p><ul><li>rolloutå¼•æ“ï¼Œinferenceç”Ÿæˆæ•°æ®</li></ul><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.rollout.generate_sequences(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">prompts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">prompts)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>compute_log_prob</strong></p><ul><li>åŸºäºactorè®­ç»ƒå¼•æ“ï¼ŒåŒæ­¥è®¡ç®—old_logprobsï¼Œæ–¹ä¾¿é‡è¦æ€§é‡‡æ ·è®¡ç®—</li></ul><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ulysses_sharding_manager.preprocess_data(data)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># actor è®¡ç®— log probs</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">output, entropys </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.actor.compute_log_prob(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">calculate_entropy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DataProto.from_dict(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  tensors</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;old_log_probs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: output, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;entropys&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: entropys},</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  meta_info</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;temperature&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.config.rollout.temperature},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ulysses_sharding_manager.postprocess_data(output)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># DataParrallelPPOActor.compute_log_prob</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">log_probs_lst </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">entropy_lst </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> micro_batch </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> micro_batches:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model_inputs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">micro_batch.batch, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">micro_batch.non_tensor_batch}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch.no_grad():</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      	# [bs, response_len], [bs, response_len]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        entropy, log_probs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._forward_micro_batch(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            model_inputs, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">temperature</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">temperature, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">calculate_entropy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">calculate_entropy</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    log_probs_lst.append(log_probs)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> calculate_entropy:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        entropy_lst.append(entropy)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">log_probs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch.concat(log_probs_lst, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># DataParrallelPPOActor._forward_micor_batch</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.actor_module(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    input_ids</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">input_ids_rmpad,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    attention_mask</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    position_ids</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">position_ids_rmpad,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    **</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">multi_modal_inputs,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    use_cache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    **</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">extra_args,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># prevent model thinks we are generating</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.use_fused_kernels:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    log_probs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> output.log_probs.squeeze(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># (total_nnz,)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    entropy_rmpad </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> output.entropy.squeeze(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># (total_nnz,)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    logits_rmpad </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> output.logits.squeeze(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># (total_nnz, vocab_size)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    logits_rmpad.div_(temperature)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># only return response part:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> calculate_entropy:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    entropy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> full_entropy.squeeze(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)[:, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">response_length </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># (bsz, response_length)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">log_probs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> full_log_probs.squeeze(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)[:, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">response_length </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># (bsz, response_length)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><strong>compute_ref_log_prob</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ulysses_sharding_manager.preprocess_data(data)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ref policy è®¡ç®— log probs</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">output, _ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ref_policy.compute_log_prob(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">calculate_entropy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DataProto.from_dict(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">tensors</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ref_log_prob&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: output})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ulysses_sharding_manager.postprocess_data(output)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="custom-block info"><div class="custom-block-title">CriticWorker</div><p><strong>æ•´ä½“æ€æƒ³</strong></p><ul><li>æ•´ç†é€»è¾‘å’ŒActorRolloutRefWorkeråŸºæœ¬ä¸€è‡´ï¼Œåªæ˜¯åç«¯æ˜¯DataParallelPPOCritic</li><li>æ— éœ€Rolloutï¼Œä¸”é¢å¤–å¤šäº†compute_valuesæ“ä½œï¼Œé€šè¿‡Value Head è®¡ç®— token-level value</li></ul><p><strong>å…³é”®æ–¹æ³•</strong></p><ul><li><strong>compute_values</strong></li><li><strong>update_critic</strong></li></ul></div><p><strong>compute_values</strong></p><ul><li>è®¡ç®—values</li></ul><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># fsdp_workers.py . CriticWorker</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ulysses_sharding_manager.preprocess_data(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">values </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.critic.compute_values(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DataProto.from_dict(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">tensors</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;values&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: values})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.ulysses_sharding_manager.postprocess_data(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">output)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># DataParallelPPOCritic.compute_values</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">values_lst </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> micro_batch </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> micro_batches:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model_inputs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">micro_batch.batch, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">micro_batch.non_tensor_batch}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch.no_grad():</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        values </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._forward_micro_batch(model_inputs)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    values_lst.append(values)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">values </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch.concat(values_lst, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># DataParallelPPOCritic._forward_micro_batch</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.critic_module(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    input_ids</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">input_ids,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    attention_mask</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">attention_mask,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    position_ids</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">position_ids,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    **</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">multi_modal_inputs,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    use_cache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># prevent model thinks we are generating</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> hasattr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.critic_module, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;v_head&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # For trl.AutoModelForCausalLMWithValueHead</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    values </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> output[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    values </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> output.logits</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">values </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> values[:, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">response_length </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">].squeeze(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>update_critic</strong></p><ul><li>è®¡ç®—critic lossï¼Œæ›´æ–°critic</li></ul><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># CriticWorker.update_critic</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">metrics </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.critic.update_critic(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ•°æ®åˆ‡åˆ†ä¸ºå¤šä¸ªmini-batch</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mini_batches </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data.split(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.config.ppo_mini_batch_size)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.config.ppo_epochs):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  	# æ•°æ®å¯ä½¿ç”¨å¤šè½®ppoæ›´æ–°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> batch_idx, mini_batch </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> enumerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mini_batches):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # è®¡ç®—æ¢¯åº¦ç´¯è®¡æ­¥æ•°</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.gradient_accumulation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.config.ppo_mini_batch_size </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">//</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.config.ppo_micro_batch_size_per_gpu</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # åˆ’åˆ†æˆå›ºå®šå¤§å°çš„micro_batchsï¼Œå¾ªç¯å¤šä¸ªmicro_batchesæ‰è¿›è¡Œ1æ¬¡æ¢¯åº¦æ›´æ–°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        micro_batches </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mini_batch.split(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.config.ppo_micro_batch_size_per_gpu)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.critic_optimizer.zero_grad()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> micro_batch </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> micro_batches:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            micro_batch_metrics </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            model_inputs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">micro_batch.batch, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">micro_batch.non_tensor_batch}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # æ ‡è®°å‡ºå“ªäº›æ˜¯å›å¤å†…å®¹ï¼Œåªå¯¹å›å¤å†…å®¹åšcritic loss</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            response_mask </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> model_inputs[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;response_mask&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # æ—§ä»·å€¼ï¼Œè£å‰ªå‚è€ƒ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            values </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> model_inputs[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;values&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # ç›®æ ‡å›æŠ¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            returns </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> model_inputs[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;returns&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # å½“å‰criticçš„ä»·å€¼é¢„æµ‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            vpreds </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._forward_micro_batch(model_inputs)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # value funtion lossï¼ŒMSE lossï¼Œä»¥åŠæœ‰å¤šå°‘æ¯”ä¾‹çš„æ ·æœ¬è¢«clip</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            vf_loss, vf_clipfrac </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> core_algos.compute_value_loss(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                vpreds</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vpreds,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                values</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">values,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                returns</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">returns,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                response_mask</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">response_mask,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                cliprange_value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.config.cliprange_value,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                loss_agg_mode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.config.loss_agg_mode,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            loss </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vf_loss </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.gradient_accumulation</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            loss.backward()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            micro_batch_metrics.update(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                    &quot;critic/vf_loss&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: vf_loss.detach().item(),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                    &quot;critic/vf_clipfrac&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: vf_clipfrac.detach().item(),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                    &quot;critic/vpred_mean&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: masked_mean(vpreds, response_mask).detach().item(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            append_to_dict(metrics, micro_batch_metrics)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        grad_norm </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._optimizer_step()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        mini_batch_metrics </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;critic/grad_norm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: grad_norm.detach().item()}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        append_to_dict(metrics, mini_batch_metrics)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.critic_optimizer.zero_grad()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> compute_value_loss</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vpreds: torch.Tensor,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    returns: torch.Tensor,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    values: torch.Tensor,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    response_mask: torch.Tensor,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cliprange_value: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    loss_agg_mode: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;token-mean&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  	# åŸºäºæ—§valueså¯¹é¢„æµ‹ä»·å€¼åšclipï¼Œé˜²æ­¢æ›´æ–°å¹…åº¦è¿‡å¤§ï¼Œå’ŒPPO clip ç±»ä¼¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vpredclipped </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> verl_F.clip_by_value(vpreds, values </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cliprange_value, values </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cliprange_value)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # æœªè£å‰ªçš„loss</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vf_losses1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (vpreds </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> returns) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # è£å‰ªåçš„loss</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vf_losses2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (vpredclipped </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> returns) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # å–å¤§å€¼ï¼Œé€‰æ‹©æ›´å¤§çš„æƒ©ç½šï¼Œé¿å…å› ä¸ºè£åˆ‡è€Œæ„å¤–é™ä½loss</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    clipped_vf_losses </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch.max(vf_losses1, vf_losses2)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 0.5 MSEå¸¸è§1/2å› å­ï¼Œä¸æ¢¯åº¦å½¢å¼å¯¹åº”ï¼›åªç»Ÿè®¡response_mask=1çš„ä½ç½®ï¼Œä»…å¯¹å›å¤tokenè®­ç»ƒï¼Œå¿½ç•¥æŒ‡ä»¤éƒ¨åˆ†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vf_loss </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> agg_loss(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">loss_mat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">clipped_vf_losses, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">loss_mask</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">response_mask, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">loss_agg_mode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">loss_agg_mode)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ç»Ÿè®¡è£å‰ªå æ¯”</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vf_clipfrac </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> verl_F.masked_mean(torch.gt(vf_losses2, vf_losses1).float(), response_mask)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vf_loss, vf_clipfrac</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><div class="custom-block info"><div class="custom-block-title">RewardModelWorker</div><p><strong>æ ¸å¿ƒæ€æƒ³</strong></p><ul><li>åŸºäºæ¨¡å‹çš„RMæ‰“åˆ†</li></ul><p><strong>å…³é”®å‡½æ•°</strong></p><ul><li><strong>compute_rm_score</strong></li></ul></div><p><strong>compute_rm_score</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># RewardModelWorker.compute_rm_score</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> micro_batch </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> micro_batches:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    rm_score </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._forward_micro_batch(micro_batch)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    output.append(rm_score)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scores </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch.cat(output, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">dim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># (batch_size)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># RewardModelWorker._forward_micro_batch</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.reward_module(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">input_ids</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">input_ids, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">attention_mask</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">attention_mask, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">position_ids</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">position_ids, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">use_cache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rm_score </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> output.logits  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># (batch_size, seq_len, 1)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rm_score </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rm_score.squeeze(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="custom-block info"><div class="custom-block-title">AsyncActorRolloutRefWorker</div><p><strong>æ ¸å¿ƒåŠŸèƒ½</strong></p><ul><li>è®­ç»ƒæ—¶rolloutï¼Œ</li><li>æ ¸å¿ƒå‡½æ•°ï¼š<strong>generate_sequences</strong></li></ul><p><strong>æ”¯æŒä¸åŒbackend</strong></p><ul><li>åŸç”Ÿrollouté€»è¾‘ï¼šlogits-&gt;softmax-&gt;sampling</li><li>HF TGI rollouté€»è¾‘</li><li>VLLM rollouté€»è¾‘ <ul><li>åŸºäºthird_partyä¿®æ”¹çš„vllm engineè¿›è¡Œæ¨ç†</li><li>repeat æ²¡æœ‰é‡‡ç”¨n_sampleså‚æ•°ï¼Œè€Œæ˜¯ç›´æ¥repeat_interleaveè¾“å…¥ï¼Œå¤šæ¬¡ç”Ÿæˆ</li><li>ä¸ºäº†ä¿è¯é‡è¦æ€§é‡‡æ ·å’ŒKLæ•£åº¦çš„å‡†ç¡®æ€§ï¼Œold_log_probsæ²¡æœ‰ä½¿ç”¨vllmå¼•æ“ç»“æœï¼Œè€Œæ˜¯ç”¨è®­ç»ƒå¼•æ“ä¸€èµ·è®¡ç®—</li></ul></li><li>SGLang rollout é€»è¾‘</li></ul></div><h4 id="megatron-workers-py" tabindex="-1">megatron_workers.py <a class="header-anchor" href="#megatron-workers-py" aria-label="Permalink to &quot;megatron_workers.py&quot;">â€‹</a></h4><div class="custom-block info"><div class="custom-block-title">åŸºäºmegatronåç«¯å®ç°çš„RL workers</div><ol><li>åŸºäºmegatronæ”¯æŒ4Då¹¶è¡Œï¼ŒDPã€TPã€SPã€PPï¼›</li><li>æ ¸å¿ƒé€»è¾‘åŸºæœ¬å’ŒFSDPç‰ˆæœ¬ä¸€è‡´ï¼Œä½†æ˜¯åº•å±‚é€»è¾‘éœ€è¦é€‚é…megatronæ¡†æ¶</li></ol></div><h3 id="single-controller-ç»„ä»¶" tabindex="-1">Single Controller ç»„ä»¶ <a class="header-anchor" href="#single-controller-ç»„ä»¶" aria-label="Permalink to &quot;Single Controller ç»„ä»¶&quot;">â€‹</a></h3><ul><li><a href="https://verl.readthedocs.io/en/latest/hybrid_flow.html#" target="_blank" rel="noreferrer">HybridFlow Programming Guide</a></li></ul><div class="custom-block caution"><div class="custom-block-title">Single Controller</div><p><strong>Worker</strong></p><ul><li>æ–¹ä¾¿ç®¡ç†workerè¿›ç¨‹åœ¨workergroupè¿›ç¨‹ç»„å†…éƒ¨ä¿¡æ¯å’Œèµ„æºåˆ†é…ç­‰</li></ul><p><strong>Resource Pool</strong></p><ul><li>ç®¡ç†èµ„æºæ± ï¼ŒåŒ…æ‹¬æ± å†…èŠ‚ç‚¹å’Œè¿›ç¨‹ä¿¡æ¯</li></ul><p><strong>WorkerGroup</strong></p><ul><li>ç®¡ç†å¤šä¸ªworkeræ‰€ç»„æˆçš„workergroup</li></ul><p><strong>Decortor</strong></p><ul><li>å®šä¹‰å„ç§workeræ•°æ®åˆ†å‘å’Œå‡½æ•°æ‰§è¡Œçš„è£…é¥°å™¨</li></ul><p><strong>Ray</strong></p><ul><li>å»ç®¡ç†worker(WorkerDict)å’Œworkergroup(RayWorkerGroup)</li></ul></div><h3 id="models-ç»„ä»¶" tabindex="-1">Models ç»„ä»¶ <a class="header-anchor" href="#models-ç»„ä»¶" aria-label="Permalink to &quot;Models ç»„ä»¶&quot;">â€‹</a></h3><div class="custom-block caution"><div class="custom-block-title">Modelsç»„ä»¶</div><p>åŒ…å«å¸¸è§æ¨¡å‹ç»“æ„</p><ul><li>transformers</li><li>llama</li><li>Qwen2</li></ul></div><h3 id="utils-ç»„ä»¶" tabindex="-1">Utils ç»„ä»¶ <a class="header-anchor" href="#utils-ç»„ä»¶" aria-label="Permalink to &quot;Utils ç»„ä»¶&quot;">â€‹</a></h3><div class="custom-block caution"><div class="custom-block-title">Utilsç»„ä»¶</div><p><strong>Dataset</strong></p><ul><li>rl, sft, rm æ•°æ®é›†</li><li>å¸¸è§åŠŸèƒ½ <ul><li>å¤„ç†å„æ•°æ®é›†ä¸­çš„key</li><li>å–å‡ºparqueté‡Œçš„promptåºåˆ—</li><li>apply_chat_ml + tokenizeåè®¾ä¸ºinput_ids</li></ul></li><li>verlçš„datasetå’Œdataloaderæ²¡æœ‰å’Œè®­ç»ƒè¿‡ç¨‹å¼ºç»‘å®šï¼Œå¯åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è½»æ¾ä¿®æ”¹dataloader</li></ul><p><strong>reward_score</strong></p><ul><li>Math/code/search r1ç­‰ä¸åŒçš„<strong>rule-grader</strong></li></ul></div></div></div></main><footer class="VPDocFooter" data-v-5a64a79a data-v-54a90a4a><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-54a90a4a><span class="visually-hidden" id="doc-footer-aria-label" data-v-54a90a4a>Pager</span><div class="pager" data-v-54a90a4a><!----></div><div class="pager" data-v-54a90a4a><a class="VPLink link pager-link next" href="/posts/llm/infra/03-inference-tech.html" data-v-54a90a4a><!--[--><span class="desc" data-v-54a90a4a>ä¸‹ä¸€é¡µ</span><span class="title" data-v-54a90a4a>æ¨ç†ä¼˜åŒ–æŠ€æœ¯</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--[--><div class="busuanzi"> æ€»è®¿å®¢æ•°ï¼š <span id="busuanzi_value_site_uv"></span> Â  Â· Â  æ€»è®¿é—®é‡ï¼š <span id="busuanzi_value_site_pv"></span></div><div class="busuanzi"> PLM&#39;s Blog @ 2016 - 2025</div><!--]--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"api-examples.md\":\"Drgk6GHl\",\"index.md\":\"BheGDo0s\",\"markdown-examples.md\":\"CEw-8KIO\",\"posts_archive.md\":\"pZWQT7dp\",\"posts_exps_env_01-blog-env.md\":\"DsD2OukA\",\"posts_exps_env_index.md\":\"BJEZeoT-\",\"posts_exps_mind_index.md\":\"naOB3-Mb\",\"posts_llm_agent_basic_01-lhy-agent-notes.md\":\"BK_CsHNC\",\"posts_llm_agent_basic_02-evaluation-agent.md\":\"Dn02cVtP\",\"posts_llm_agent_basic_03-current-agents.md\":\"C25gmbg8\",\"posts_llm_agent_basic_04-agent-blogs.md\":\"_QbL2Plv\",\"posts_llm_agent_basic_05-comuter-agent.md\":\"D0gJpId6\",\"posts_llm_agent_basic_06-deepresearch-evaluation.md\":\"DdRDcxUJ\",\"posts_llm_agent_basic_index.md\":\"ClGtwUqg\",\"posts_llm_agent_rl_01-agent-rl.md\":\"wOF9bz66\",\"posts_llm_agent_rl_02-agent-tool.md\":\"IB_AqkSe\",\"posts_llm_agent_rl_03-agent-search.md\":\"CoYozBSV\",\"posts_llm_agent_rl_04-agent-env.md\":\"C_O9BVi3\",\"posts_llm_agent_rl_index.md\":\"BudtoDK9\",\"posts_llm_basic_01-lm-define-information-theory.md\":\"CTQZglGX\",\"posts_llm_basic_02-llm-components.md\":\"CK5rj3vH\",\"posts_llm_basic_03-transformer-detail.md\":\"BgLyAVDZ\",\"posts_llm_basic_04-llm-architecture.md\":\"CJ4m4grf\",\"posts_llm_basic_05-llm-basic-info.md\":\"bdnM02bn\",\"posts_llm_basic_index.md\":\"DjX2HRXy\",\"posts_llm_industry_mainllm_01-kimi-series.md\":\"BpSW4UZD\",\"posts_llm_industry_mainllm_02-deepseek-series.md\":\"BSYWoiac\",\"posts_llm_industry_mainllm_03-glm-series.md\":\"DyoRo4ru\",\"posts_llm_infra_01-parrallel.md\":\"4SPd423i\",\"posts_llm_infra_02-speed-framework.md\":\"DR7mq5S5\",\"posts_llm_infra_03-inference-tech.md\":\"BMBxLcEu\",\"posts_llm_infra_04-verl.md\":\"Bq6mdbhL\",\"posts_llm_rl_index.md\":\"iUgEsMU1\",\"posts_llm_rl_theory_01-reinforce-learning.md\":\"BeNW7nu0\",\"posts_llm_rl_theory_01-rl-introduction.md\":\"CCFzgZiP\",\"posts_llm_rl_theory_02-markove-process.md\":\"CNubpTmF\",\"posts_llm_rl_theory_02-value-learning.md\":\"Dhs-VEnc\",\"posts_llm_rl_theory_03-model-based-prediction-control.md\":\"BikDHzpH\",\"posts_llm_rl_theory_03-strategy-learning.md\":\"KKz0IU0B\",\"posts_llm_rl_theory_04-model-free-prediction-control.md\":\"hwhRO1MJ\",\"posts_llm_rl_theory_04-reinforce-conclusion-simple.md\":\"4ZBuW05y\",\"posts_llm_rl_theory_05-dqn.md\":\"DeA0A-4D\",\"posts_llm_rl_theory_06-policy-gradient.md\":\"TsVsN9GC\",\"posts_llm_rl_theory_07-actor-critic.md\":\"DbQuZ45Y\",\"posts_llm_rl_theory_08-deterministic-policy-gradient.md\":\"BPacQxSx\",\"posts_llm_rl_theory_09-policy-trpo-ppo.md\":\"DR2GbRdj\",\"posts_llm_rl_theory_10-ppo-series.md\":\"p1UU9HES\",\"posts_me.md\":\"B9W6CMag\",\"posts_olds_algo_aim2offer.md\":\"Dg9B7Z3I\",\"posts_olds_algo_aim2offer2.md\":\"CnDd98IS\",\"posts_olds_algo_aim2offer3.md\":\"YnkHg59Q\",\"posts_olds_algo_aim2offer4.md\":\"BXurWO8W\",\"posts_olds_algo_algorithm-dfs.md\":\"VxYdFkrt\",\"posts_olds_algo_index.md\":\"CmdF0Gg2\",\"posts_olds_algo_leetcode-01.md\":\"DaoLL5QB\",\"posts_olds_algo_sort-algorithms.md\":\"CGSaXABt\",\"posts_olds_bigdata_16-spark-baserdd.md\":\"nnsc9x1_\",\"posts_olds_bigdata_17-spark-pairrdd.md\":\"DTYLfi_i\",\"posts_olds_bigdata_18-spark-sql.md\":\"BZ3MwzEC\",\"posts_olds_bigdata_19-spark-programming.md\":\"DrAdYxjj\",\"posts_olds_bigdata_20-numpy.md\":\"CN3CN-Cf\",\"posts_olds_bigdata_index.md\":\"CWrZwWPb\",\"posts_olds_dl_23-pytorch-start.md\":\"BHevLby6\",\"posts_olds_dl_35-nerual-network-optim.md\":\"Cp2SpLoE\",\"posts_olds_dl_38-convolution.md\":\"CC_SQ57z\",\"posts_olds_dl_cs224n-assignment-1.md\":\"D0dK0rzN\",\"posts_olds_dl_cs224n-notes3-neural-networks-2.md\":\"TG3qYWqo\",\"posts_olds_dl_cs224n-notes3-neural-networks.md\":\"CDZWc4X6\",\"posts_olds_dl_cs231n-linear-notes.md\":\"DLRyzcwJ\",\"posts_olds_dl_index.md\":\"C1dyLGNS\",\"posts_olds_dl_rnn.md\":\"CwYYWZ7N\",\"posts_olds_env_09-linux-notes.md\":\"DERcUyYf\",\"posts_olds_env_12-ide-envs.md\":\"Bx6h4IWK\",\"posts_olds_env_13-old-blog-problems.md\":\"DsYjJL2J\",\"posts_olds_env_24-hexo-problems.md\":\"BWPoXjZh\",\"posts_olds_env_index.md\":\"DQpgTXVj\",\"posts_olds_ml_10-trees.md\":\"BkNaj6fL\",\"posts_olds_ml_14-em.md\":\"DIufCP0H\",\"posts_olds_ml_21-lr.md\":\"C-1ms511\",\"posts_olds_ml_22-ml-ch03-bayes.md\":\"Dqb846RT\",\"posts_olds_ml_27-svm-notes.md\":\"C96WS6CL\",\"posts_olds_ml_28-ml-interview-notes.md\":\"D-r631Oz\",\"posts_olds_ml_29-desicion-tree.md\":\"CtwmlbWl\",\"posts_olds_ml_crf.md\":\"CEE5oTqd\",\"posts_olds_ml_index.md\":\"BLMEziB1\",\"posts_olds_ml_maxentmodel.md\":\"CSbOumJx\",\"posts_olds_ml_pgm-01.md\":\"BTwybTMD\",\"posts_olds_nlp_11-nlp-labels.md\":\"Cl0Lb8OT\",\"posts_olds_nlp_25-google-nmt.md\":\"BOM-hoYN\",\"posts_olds_nlp_26-wordpieacemodel.md\":\"Q8-L5j15\",\"posts_olds_nlp_30-dynamic-memory-network.md\":\"AB-oqmxo\",\"posts_olds_nlp_31-co-attention-vqa.md\":\"lzwuVKG5\",\"posts_olds_nlp_32-dynamic-coattention-network.md\":\"Bxl4ABWd\",\"posts_olds_nlp_33-attention-summary.md\":\"DT6np0xG\",\"posts_olds_nlp_36-alime-chat.md\":\"Cu2xkcdT\",\"posts_olds_nlp_39-squard-models.md\":\"B1L3iDEv\",\"posts_olds_nlp_45-match-lstm.md\":\"DkpQKM5B\",\"posts_olds_nlp_46-rnet-selfmatch.md\":\"CzGHQ-PZ\",\"posts_olds_nlp_47-bidaf.md\":\"DFJaLh2v\",\"posts_olds_nlp_48-attention-is-all-you-need.md\":\"BY6XvFQ5\",\"posts_olds_nlp_49-qanet.md\":\"BPKWHzTf\",\"posts_olds_nlp_50-elmo.md\":\"WuOt1elN\",\"posts_olds_nlp_51-opengpt.md\":\"B9pQ3h5W\",\"posts_olds_nlp_52-bert.md\":\"5q3t5Qqh\",\"posts_olds_nlp_53-mrc-brief.md\":\"D9CkYrea\",\"posts_olds_nlp_54-mrc-models.md\":\"Ak4bDf1J\",\"posts_olds_nlp_attention-based-nmt.md\":\"DzovOxdG\",\"posts_olds_nlp_attention-model.md\":\"BVcXcWt7\",\"posts_olds_nlp_cs224n-lecture2-word2vec.md\":\"_MmBTADr\",\"posts_olds_nlp_cs224n-notes1-word2vec.md\":\"DXSi5KGh\",\"posts_olds_nlp_index.md\":\"Bfo4Lwn3\",\"posts_olds_nlp_nlp-notes.md\":\"D0Rkl4SF\",\"posts_olds_nlp_nmt.md\":\"DUgy6vHF\",\"posts_olds_nlp_subword-units.md\":\"BUzbRrkD\",\"posts_olds_nlp_word2vec-math.md\":\"agvHiE1x\",\"posts_olds_nlp_word2vec.md\":\"D0EJh12M\",\"posts_olds_other_15-cpp-pointer-object-reference.md\":\"uCLsDJe3\",\"posts_olds_other_index.md\":\"C1T-ubsz\",\"posts_olds_rl_37-reinforce-learning.md\":\"Cf2nny8k\",\"posts_olds_rl_40-value-learning.md\":\"DcnHvvpH\",\"posts_olds_rl_41-strategy-learning.md\":\"CStMrB-q\",\"posts_olds_rl_42-reinforce-conclusion-simple.md\":\"flRZUmJZ\",\"posts_olds_rl_43-intent-detection-slot-filling.md\":\"DcAUbaZU\",\"posts_olds_rl_44-reinforce-nlp.md\":\"Br2ShITL\",\"posts_olds_rl_index.md\":\"CUsxM3zO\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"ğŸ“š plmblog\",\"description\":\"è®°å½•ä¸€äº›å­¦ä¹ ç¬”è®°ã€‚\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"é¦–é¡µ\",\"link\":\"/\"},{\"text\":\"ğŸ²LLM\",\"items\":[{\"text\":\"Basic\",\"items\":[{\"text\":\"ğŸ¦‹åŸºç¡€çŸ¥è¯†\",\"link\":\"/posts/llm/basic/01-lm-define-information-theory\"},{\"text\":\"ğŸ› åŸºå»ºæ¡†æ¶\",\"link\":\"/posts/llm/infra/01-parrallel\"}]},{\"text\":\"å¼ºåŒ–å­¦ä¹ \",\"items\":[{\"text\":\"ğŸ“RLç†è®ºåŸºç¡€\",\"link\":\"/posts/llm/rl/theory/01-reinforce-learning\"},{\"text\":\"ğŸš˜RLHF\",\"link\":\"/posts/llm/rl/rlhf\"},{\"text\":\"ğŸš¢æ¨ç†æ¨¡å‹\",\"link\":\"/posts/llm/rl/o1llm\"},{\"text\":\"ğŸš„Agent-RL\",\"link\":\"/posts/llm/agent/rl/02-agent-tool\"}]},{\"text\":\"Agent\",\"items\":[{\"text\":\"ğŸ¤–æ¦‚å¿µåŠåº”ç”¨\",\"link\":\"/posts/llm/agent/basic\"}]},{\"text\":\"è¡Œä¸šæ–¹å‘\",\"items\":[{\"text\":\"ğŸš€ä¸»æµæ¨¡å‹\",\"link\":\"/posts/llm/industry/mainllm/01-kimi-series\"}]}]},{\"text\":\"ğŸ“™æ—§æ–‡ç« \",\"items\":[{\"text\":\"ğŸ“NLP\",\"items\":[{\"text\":\"è‡ªç„¶è¯­è¨€å¤„ç†\",\"link\":\"/posts/olds/nlp\"}]},{\"text\":\"ğŸ‘åŸºç¡€çŸ¥è¯†\",\"items\":[{\"text\":\"æ·±åº¦å­¦ä¹ \",\"link\":\"/posts/olds/dl\"},{\"text\":\"å¼ºåŒ–å­¦ä¹ \",\"link\":\"/posts/olds/rl\"},{\"text\":\"æœºå™¨å­¦ä¹ \",\"link\":\"/posts/olds/ml\"}]},{\"text\":\"ğŸç®—æ³•\",\"items\":[{\"text\":\"ç®—æ³•é¢˜\",\"link\":\"/posts/olds/algo/\"},{\"text\":\"å¤§æ•°æ®\",\"link\":\"/posts/olds/bigdata/\"}]},{\"text\":\"ğŸ’å…¶ä»–\",\"items\":[{\"text\":\"ç¯å¢ƒæ­å»º\",\"link\":\"/posts/olds/env/\"},{\"text\":\"å…¶ä»–\",\"link\":\"/posts/olds/other/\"}]}]},{\"text\":\"ç»éªŒ\",\"items\":[{\"text\":\"ç¯å¢ƒ\",\"items\":[{\"text\":\"ç¯å¢ƒæ­å»º\",\"link\":\"/posts/exps/env/01-blog-env\"}]},{\"text\":\"å¿ƒå¾—\",\"items\":[{\"text\":\"å¿ƒå¾—ä½“ä¼š\",\"link\":\"/posts/exps/mind\"}]}]},{\"text\":\"å½’æ¡£\",\"link\":\"/posts/archive.md\"},{\"text\":\"å…³äºæˆ‘\",\"link\":\"/posts/me\"}],\"outline\":{\"level\":[1,4],\"label\":\"å½“å‰é¡µå¤§çº²\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/plmsmile\"}],\"search\":{\"provider\":\"local\"},\"docFooter\":{\"prev\":\"ä¸Šä¸€é¡µ\",\"next\":\"ä¸‹ä¸€é¡µ\"},\"sidebar\":{\"/posts/olds/nlp/\":{\"base\":\"/posts/olds/nlp/\",\"items\":[{\"text\":\"NLP\",\"items\":[{\"text\":\"æœºå™¨é˜…è¯»(äºŒ)--æ¨¡å‹(æœªå®Œæˆ)\",\"link\":\"54-mrc-models\"},{\"text\":\"æœºå™¨é˜…è¯»(ä¸€)--æ•´ä½“æ¦‚è¿°\",\"link\":\"53-mrc-brief\"},{\"text\":\"BERT è¯¦è§£\",\"link\":\"52-bert\"},{\"text\":\"OpenAI GPTï¼šImproving Language Understanding by Generative Pre-Training\",\"link\":\"51-opengpt\"},{\"text\":\"ELMoï¼šDeep Contextualized Word Representations\",\"link\":\"50-elmo\"},{\"text\":\"QANet\",\"link\":\"49-qanet\"},{\"text\":\"Transformer\",\"link\":\"48-attention-is-all-you-need\"},{\"text\":\"Bidirectional Attention Flow\",\"link\":\"47-bidaf\"},{\"text\":\"R-Net (Gated Self-Matching Networks)\",\"link\":\"46-rnet-selfmatch\"},{\"text\":\"Match-LSTM and Answer Pointer\",\"link\":\"45-match-lstm\"},{\"text\":\"é˜…è¯»ç†è§£æ¨¡å‹æ€»ç»“\",\"link\":\"39-squard-models\"},{\"text\":\"é˜¿é‡Œå°èœœè®ºæ–‡\",\"link\":\"36-alime-chat\"},{\"text\":\"å„ç§æ³¨æ„åŠ›æ€»ç»“\",\"link\":\"33-attention-summary\"},{\"text\":\"Dynamic Coattention Network (Plus)\",\"link\":\"32-dynamic-coattention-network\"},{\"text\":\"ååŒæ³¨æ„åŠ›ç®€ä»‹\",\"link\":\"31-co-attention-vqa\"},{\"text\":\"ä½¿ç”¨Dynamic Memory Networkå®ç°ä¸€ä¸ªç®€å•QA\",\"link\":\"30-dynamic-memory-network\"},{\"text\":\"è¯æ€§æ ‡æ³¨å’Œå¥æ³•ä¾å­˜çš„è¡¨ç¤ºç¬¦å·\",\"link\":\"11-nlp-labels\"},{\"text\":\"Word2vecä¹‹æ€»ä½“ä»‹ç»\",\"link\":\"cs224n-notes1-word2vec\"},{\"text\":\"Word2vecä¹‹æ•°å­¦æ¨¡å‹\",\"link\":\"word2vec-math\"},{\"text\":\"Word2vecä¹‹å…¬å¼æ¨å¯¼ç¬”è®°\",\"link\":\"cs224n-lecture2-word2vec\"},{\"text\":\"subword-units\",\"link\":\"subword-units\"},{\"text\":\"Wordpieceæ¨¡å‹\",\"link\":\"26-wordpieacemodel\"},{\"text\":\"è°·æ­ŒRNNç¿»è¯‘æ¨¡å‹\",\"link\":\"25-google-nmt\"},{\"text\":\"æœºå™¨ç¿»è¯‘æ³¨æ„åŠ›æœºåˆ¶åŠå…¶PyTorchå®ç°\",\"link\":\"Attention-based-NMT\"},{\"text\":\"å›¾æ–‡ä»‹ç»RNNæ³¨æ„åŠ›æœºåˆ¶\",\"link\":\"attention-model\"},{\"text\":\"æœ€åˆRNNç¥ç»ç¿»è¯‘ç®€ç•¥ç¬”è®°\",\"link\":\"NMT\"},{\"text\":\"è¯­è¨€æ¨¡å‹å’Œå¹³æ»‘æ–¹æ³•\",\"link\":\"nlp-notes\"},{\"text\":\"åˆ©ç”¨tensorflowå®ç°ç®€ç‰ˆword2vec\",\"link\":\"word2vec\"}]}]},\"/posts/olds/dl/\":{\"base\":\"/posts/olds/dl/\",\"items\":[{\"text\":\"DL\",\"items\":[{\"text\":\"å·ç§¯ç¥ç»ç½‘ç»œæ€»ç»“\",\"link\":\"38-convolution\"},{\"text\":\"ç½‘ç»œä¼˜åŒ–\",\"link\":\"35-nerual-network-optim\"},{\"text\":\"cs224nä½œä¸šä¸€\",\"link\":\"cs224n-assignment-1\"},{\"text\":\"cs231nçº¿æ€§åˆ†ç±»å™¨å’ŒæŸå¤±å‡½æ•°\",\"link\":\"cs231n-linear-notes\"},{\"text\":\"ç¥ç»ç½‘ç»œ-è¿‡æ‹Ÿåˆ-é¢„å¤„ç†-BN\",\"link\":\"cs224n-notes3-neural-networks-2\"},{\"text\":\"ç¥ç»ç½‘ç»œåŸºç¡€-åå‘ä¼ æ’­-æ¿€æ´»å‡½æ•°\",\"link\":\"cs224n-notes3-neural-networks\"},{\"text\":\"å¾ªç¯ç¥ç»ç½‘ç»œ\",\"link\":\"rnn\"},{\"text\":\"PyTorchå¿«é€Ÿä¸Šæ‰‹\",\"link\":\"23-pytorch-start\"}]}]},\"/posts/olds/rl/\":{\"base\":\"/posts/olds/rl/\",\"items\":[{\"text\":\"RL\",\"items\":[{\"text\":\"å¼ºåŒ–å­¦ä¹ åœ¨NLPä¸­çš„åº”ç”¨\",\"link\":\"44-reinforce-nlp\"},{\"text\":\"æ„å›¾è¯†åˆ«å’Œæ§½å¡«å……\",\"link\":\"43-intent-detection-slot-filling\"},{\"text\":\"å¼ºåŒ–å­¦ä¹ ç®—æ³•å°ç»“\",\"link\":\"42-reinforce-conclusion-simple\"},{\"text\":\"åŸºäºç­–ç•¥å‡½æ•°çš„å­¦ä¹ æ–¹æ³•\",\"link\":\"41-strategy-learning\"},{\"text\":\"åŸºäºå€¼å‡½æ•°çš„å­¦ä¹ \",\"link\":\"40-value-learning\"},{\"text\":\"å¼ºåŒ–å­¦ä¹ \",\"link\":\"37-reinforce-learning\"}]}]},\"/posts/olds/ml/\":{\"base\":\"/posts/olds/ml/\",\"items\":[{\"text\":\"ML\",\"items\":[{\"text\":\"å†³ç­–æ ‘ç¬”è®°\",\"link\":\"29-desicion-tree\"},{\"text\":\"æœºå™¨å­¦ä¹ çŸ¥è¯†ç‚¹æ±‡æ€»æ•´ç†\",\"link\":\"28-ml-interview-notes\"},{\"text\":\"SVMç¬”è®°\",\"link\":\"27-svm-notes\"},{\"text\":\"æ ‘çš„æ€»ç»“\",\"link\":\"10-trees\"},{\"text\":\"æ¡ä»¶éšæœºåœº\",\"link\":\"crf\"},{\"text\":\"æœ€å¤§ç†µæ¨¡å‹\",\"link\":\"maxentmodel\"},{\"text\":\"çº¿æ€§å›å½’å’Œé€»è¾‘å›å½’\",\"link\":\"21-lr\"},{\"text\":\"æœ€å¤§æœŸæœ›ç®—æ³•\",\"link\":\"14-em\"},{\"text\":\"é©¬å°”å¯å¤«æ¨¡å‹\",\"link\":\"pgm-01\"},{\"text\":\"æœ´ç´ è´å¶æ–¯ç®—æ³•åŠå…¶ä»£ç å®ç°\",\"link\":\"22-ml-ch03-bayes\"}]}]},\"/posts/olds/algo/\":{\"base\":\"/posts/olds/algo/\",\"items\":[{\"text\":\"ALGO\",\"items\":[{\"text\":\"å‰‘æŒ‡offer4(51-64)\",\"link\":\"aim2offer4\"},{\"text\":\"å‰‘æŒ‡offer3(21-40)\",\"link\":\"aim2offer3\"},{\"text\":\"æ•°æ®ç»“æ„ä¹‹æœç´¢ç®—æ³•\",\"link\":\"algorithm-dfs\"},{\"text\":\"leetcode-01\",\"link\":\"leetcode-01\"},{\"text\":\"å‰‘æŒ‡offer(11-20)\",\"link\":\"aim2offer2\"},{\"text\":\"æ’åºç®—æ³•æ€»ç»“\",\"link\":\"sort-algorithms\"},{\"text\":\"å‰‘æŒ‡Offer(1-10)\",\"link\":\"aim2offer\"}]}]},\"/posts/olds/bigdata/\":{\"base\":\"/posts/olds/bigdata/\",\"items\":[{\"text\":\"BIG Data\",\"items\":[{\"text\":\"NumPy\",\"link\":\"20-numpy\"},{\"text\":\"SparkåŸºç¡€ç¼–ç¨‹æ ¸å¿ƒæ€æƒ³ä»‹ç»\",\"link\":\"19-spark-programming\"},{\"text\":\"Spark-SQLçš„ç®€ç•¥ç¬”è®°\",\"link\":\"18-spark-sql\"},{\"text\":\"Sparké”®å€¼å¯¹RDDçš„å¸¸ç”¨API\",\"link\":\"17-spark-pairrdd\"},{\"text\":\"SparkåŸºç¡€RDDçš„å¸¸ç”¨API\",\"link\":\"16-Spark-BaseRDD\"}]}]},\"/posts/olds/env/\":{\"base\":\"/posts/olds/env/\",\"items\":[{\"text\":\"ç¯å¢ƒæ­å»º\",\"items\":[{\"text\":\"IDEé…ç½®\",\"link\":\"12-ide-envs\"},{\"text\":\"Linuxä½¿ç”¨ç¬”è®°\",\"link\":\"09-linux-notes\"},{\"text\":\"åšå®¢æ­å»ºåŠç›¸å…³é—®é¢˜\",\"link\":\"24-hexo-problems\"},{\"text\":\"æ—§ç‰ˆåšå®¢æ­å»ºè¿‡ç¨‹åŠå…¶é—®é¢˜\",\"link\":\"13-old-blog-problems\"}]}]},\"/posts/olds/other/\":{\"base\":\"/posts/olds/other/\",\"items\":[{\"text\":\"å…¶ä»–\",\"items\":[{\"text\":\"C++ç±»å¯¹è±¡å’ŒæŒ‡é’ˆçš„åŒºåˆ«\",\"link\":\"15-cpp-pointer-object-reference\"}]}]},\"/posts/llm/agent/rl/\":{\"base\":\"/posts/llm/agent/rl/\",\"items\":[{\"text\":\"Agent-RL\",\"items\":[{\"text\":\"Agent-Interaction-RL ç¬”è®°\",\"link\":\"04-agent-env\"},{\"text\":\"Agent-Search-RL ç¬”è®°\",\"link\":\"03-agent-search\"},{\"text\":\"Agent-Tool-RL ç¬”è®°\",\"link\":\"02-agent-tool\"},{\"text\":\"Agent-RL ç»¼è¿°å‹ç¬”è®°\",\"link\":\"01-agent-rl\"}]}]},\"/posts/llm/agent/basic/\":{\"base\":\"/posts/llm/agent/basic/\",\"items\":[{\"text\":\"Agent-åŸºç¡€\",\"items\":[{\"text\":\"DeepResearch è¯„ä¼°\",\"link\":\"06-deepresearch-evaluation\"},{\"text\":\"Computer-Agent\",\"link\":\"05-comuter-agent\"},{\"text\":\"Agent æ€è€ƒæ€§æ–‡ç« \",\"link\":\"04-agent-blogs\"},{\"text\":\"ä¸€äº›æµè¡Œçš„Agents\",\"link\":\"03-current-agents\"},{\"text\":\"Agent è¯„ä¼° Benchmarks\",\"link\":\"02-evaluation-agent\"},{\"text\":\"AgentåŸºç¡€æ¦‚å¿µ (æå®æ¯…ç¬”è®°)\",\"link\":\"01-lhy-agent-notes\"}]}]},\"/posts/llm/rl/theory/\":{\"base\":\"/posts/llm/rl/theory/\",\"items\":[{\"text\":\"RL-Theory\",\"items\":[{\"text\":\"PPOæ”¹è¿›ç³»åˆ—\",\"link\":\"10-ppo-series\"},{\"text\":\"ç­–ç•¥æ”¹è¿›æ–¹æ³•ï¼šTRPO+PPO\",\"link\":\"09-policy-trpo-ppo\"},{\"text\":\"ç¡®å®šæ€§ç­–ç•¥æ¢¯åº¦\",\"link\":\"08-deterministic-policy-gradient\"},{\"text\":\"Actor-Critic ç®—æ³•\",\"link\":\"07-actor-critic\"},{\"text\":\"ç­–ç•¥æ¢¯åº¦ç®—æ³•\",\"link\":\"06-policy-gradient\"},{\"text\":\"DQNç®—æ³•åŠè¿›é˜¶\",\"link\":\"05-dqn\"},{\"text\":\"å…æ¨¡å‹é¢„æµ‹å’Œæ§åˆ¶\",\"link\":\"04-model-free-prediction-control\"},{\"text\":\"æœ‰æ¨¡å‹é¢„æµ‹å’Œæ§åˆ¶\",\"link\":\"03-model-based-prediction-control\"},{\"text\":\"é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹\",\"link\":\"02-markove-process\"},{\"text\":\"å¼ºåŒ–å­¦ä¹ åŸºæœ¬æ¦‚å¿µ\",\"link\":\"01-rl-introduction\"},{\"text\":\"(18å¹´ç¬”è®°)å¼ºåŒ–å­¦ä¹ ç®—æ³•å°ç»“\",\"link\":\"04-reinforce-conclusion-simple\"},{\"text\":\"(18å¹´ç¬”è®°)åŸºäºç­–ç•¥å‡½æ•°çš„å­¦ä¹ æ–¹æ³•\",\"link\":\"03-strategy-learning\"},{\"text\":\"(18å¹´ç¬”è®°)åŸºäºå€¼å‡½æ•°çš„å­¦ä¹ \",\"link\":\"02-value-learning\"},{\"text\":\"(18å¹´ç¬”è®°)å¼ºåŒ–å­¦ä¹ åŸºç¡€\",\"link\":\"01-reinforce-learning\"}]}]},\"/posts/llm/rl/rlhf/\":{\"base\":\"/posts/llm/rl/rlhf/\",\"items\":[{\"text\":\"RLHF\",\"items\":[]}]},\"/posts/llm/rl/o1llm/\":{\"base\":\"/posts/llm/rl/o1llm/\",\"items\":[{\"text\":\"æ¨ç†æ¨¡å‹\",\"items\":[]}]},\"/posts/llm/industry/mainllm/\":{\"base\":\"/posts/llm/industry/mainllm/\",\"items\":[{\"text\":\"ğŸš€ä¸»æµæ¨¡å‹\",\"items\":[{\"text\":\"GLM ç³»åˆ—\",\"link\":\"03-glm-series\"},{\"text\":\"DeepSeek ç³»åˆ—\",\"link\":\"02-deepseek-series\"},{\"text\":\"Kimi ç³»åˆ—\",\"link\":\"01-kimi-series\"}]}]},\"/posts/llm/basic/\":{\"base\":\"/posts/llm/basic/\",\"items\":[{\"text\":\"LLM-basic\",\"items\":[{\"text\":\"LLM åŸºç¡€çŸ¥è¯†\",\"link\":\"05-llm-basic-info\"},{\"text\":\"å¤§è¯­è¨€æ¨¡å‹æ¶æ„\",\"link\":\"04-llm-architecture\"},{\"text\":\"Transformerç»†èŠ‚\",\"link\":\"03-transformer-detail\"},{\"text\":\"è¯­è¨€æ¨¡å‹é‡è¦ç»„ä»¶\",\"link\":\"02-llm-components\"},{\"text\":\"è¯­è¨€æ¨¡å‹å®šä¹‰åŠä¿¡æ¯ç†è®º\",\"link\":\"01-lm-define-information-theory\"}]}]},\"/posts/llm/infra/\":{\"base\":\"/posts/llm/infra/\",\"items\":[{\"text\":\"ğŸ› LLM-åŸºå»ºæ¡†æ¶\",\"items\":[{\"text\":\"Verl\",\"link\":\"04-verl\"},{\"text\":\"æ¨ç†ä¼˜åŒ–æŠ€æœ¯\",\"link\":\"03-inference-tech\"},{\"text\":\"åˆ†å¸ƒå¼è®­ç»ƒæ¡†æ¶\",\"link\":\"02-speed-framework\"},{\"text\":\"åˆ†å¸ƒå¼å¹¶è¡Œç­–ç•¥\",\"link\":\"01-parrallel\"}]}]},\"/posts/exps/env/\":{\"base\":\"/posts/exps/env/\",\"items\":[{\"text\":\"ç¯å¢ƒæ­å»º\",\"items\":[{\"text\":\"ç¯å¢ƒæ­å»ºçš„ä¸€äº›å‘\",\"link\":\"01-blog-env\"}]}]},\"/posts/exps/mind/\":{\"base\":\"/posts/exps/mind/\",\"items\":[{\"text\":\"å¿ƒå¾—ä½“ä¼š\",\"items\":[]}]}}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>